<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Remains - Jogo de Ação 2D</title>
    <meta name="description" content="Nova Remains - Jogo de ação 2D com sistema de combate dinâmico e heróis únicos">
    <meta name="keywords" content="jogo, ação, 2d, nova remains, combate, rpg, heróis, aventura">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/visual-design.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Press+Start+2P&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Otimizações de performance */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            background: #0f0f23;
            position: relative;
        }

        /* Fundo de Estrelas Global */
        .global-starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f23 100%);
        }

        .global-starfield-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #gameCanvas {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        /* Loading screen otimizado */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        /* Performance indicators */
        .fps-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            z-index: 1000;
        }
        

        /* Fundo Animado de Estrelas - Dentro da Janela do Jogo */
        .starfield-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f23 100%);
            border-radius: 12px;
            overflow: hidden;
        }

        .starfield-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Aurora Background - Dentro da Janela do Jogo */
        .aurora-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #4f46e5);
            opacity: 0.6;
            z-index: 2;
            animation: auroraShift 10s ease-in-out infinite alternate;
            border-radius: 12px;
        }

        @keyframes auroraShift {
            0% { background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #4f46e5); }
            25% { background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #7c3aed); }
            50% { background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #ec4899); }
            75% { background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #06b6d4); }
            100% { background: radial-gradient(125% 125% at 50% 0%, #0f0f23 50%, #4f46e5); }
        }

        /* Interface Moderna */
        .modern-interface {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .game-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInUp 1s ease-out;
        }

        .game-title {
            font-family: 'Orbitron', monospace;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            background: linear-gradient(135deg, #60a5fa, #a855f7, #ec4899);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(96, 165, 250, 0.5);
        }

        .game-subtitle {
            font-size: 1.25rem;
            color: #94a3b8;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
            width: 100%;
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .menu-card {
            position: relative;
            background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.4) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .menu-card:hover::before {
            transform: translateX(100%);
        }

        .menu-card:hover {
            transform: translateY(-10px) rotateY(5deg);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .menu-card-icon {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }

        .menu-card:hover .menu-card-icon {
            transform: scale(1.1);
        }

        .menu-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }

        .menu-card:hover .menu-card-title {
            color: #fbbf24;
        }

        .menu-card-description {
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.5;
        }

        .status-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 0.5rem;
            height: 0.5rem;
            background: #fbbf24;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Modais Modernos */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: white;
        }

        .close-btn {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.1);
        }

        /* Hero Selection */
        .heroes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .hero-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.5), rgba(15, 23, 42, 0.8));
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .hero-card:hover {
            transform: scale(1.05);
            border-color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(168, 85, 247, 0.2));
        }

        .hero-card.selected {
            border-color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(168, 85, 247, 0.2));
        }

        .hero-avatar {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #ef4444, #f97316);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1rem;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .hero-name {
            font-size: 1.25rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .hero-class {
            text-align: center;
            color: #a855f7;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .hero-stats {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }

        .stat-bar {
            width: 100%;
            height: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-top: 0.25rem;
        }

        .stat-fill {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 0.3s ease;
        }

        .stat-fill.attack { background: linear-gradient(90deg, #ef4444, #f97316); }
        .stat-fill.defense { background: linear-gradient(90deg, #3b82f6, #06b6d4); }
        .stat-fill.speed { background: linear-gradient(90deg, #10b981, #34d399); }

        /* Botões Modernos */
        .btn-modern {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1f2937;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .game-title {
                font-size: 3rem;
            }
            
            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
        }
        
        /* Botões otimizados */
        .menu-btn {
            position: relative;
            overflow: hidden;
        }
        
        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .menu-btn:hover::before {
            left: 100%;
        }
        
        /* Acessibilidade */
        .menu-btn:focus {
            outline: 3px solid #ffd700;
            outline-offset: 2px;
        }
        
        /* Animações suaves */
        .menu-section {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .menu-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Layout centralizado */
        .main-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #4a90e2);
            overflow: hidden;
            position: relative;
        }
        
        .game-window {
            width: 75%;
            height: 85%;
            background: #000;
            position: relative;
            border: 4px solid #8B4513;
            border-radius: 0;
            box-shadow: 
                inset 4px 4px 0px #A0522D,
                inset -4px -4px 0px #654321,
                8px 8px 0px #000;
            image-rendering: pixelated;
            overflow: hidden;
            contain: layout;
            max-width: 1200px;
            max-height: 800px;

        }
        
        /* ========================================
           SISTEMA DE OVERLAYS PARA GAME-WINDOW
           ======================================== */
        
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .game-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .overlay-content {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .game-overlay.active .overlay-content {
            transform: scale(1);
        }
        
        .overlay-title {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .overlay-message {
            color: #87CEEB;
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .overlay-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .overlay-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .overlay-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .overlay-btn.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }
        
        .overlay-btn.secondary:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
        }
        
        .overlay-btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .overlay-btn.danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        /* Overlay específico para Game Over */
        .game-over-overlay .overlay-content {
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .game-over-overlay .overlay-title {
            color: #EF4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        
        /* Overlay específico para Missão Completa */
        .mission-complete-overlay .overlay-content {
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .mission-complete-overlay .overlay-title {
            color: #10B981;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        /* Overlay específico para Confirmação de Saída */
        .exit-confirmation-overlay .overlay-content {
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .exit-confirmation-overlay .overlay-title {
            color: #F59E0B;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }
        
        /* Overlay para Pausa */
        .pause-overlay .overlay-content {
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .pause-overlay .overlay-title {
            color: #8B5CF6;
            text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }
        
        /* Responsividade para overlays */
        @media (max-width: 768px) {
            .overlay-content {
                padding: 20px;
                max-width: 90%;
            }
            
            .overlay-title {
                font-size: 20px;
            }
            
            .overlay-message {
                font-size: 14px;
            }
            
            .overlay-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .overlay-btn {
                width: 100%;
                max-width: 200px;
            }
        }
        
        /* Menu principal adaptado para painel lateral */
        #mainMenu {
            position: relative;
            width: 100%;
            height: auto;
            background: transparent;
            box-shadow: none;
            margin: 0;
            padding: 0;
        }
        
        
        .menu-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 40px;
        }
        
        .menu-section {
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .menu-section h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        
        .menu-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            margin: 8px 0;
            min-width: 200px;
        }
        
        .menu-btn.primary {
            font-size: 1.2em;
            padding: 18px 35px;
            min-width: 220px;
        }
        
        /* Canvas do jogo */
        #gameCanvas {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            border: 3px solid #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        /* UI do jogo posicionada sobre o canvas */
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }
        
        
        /* Responsividade para telas menores */
        @media (max-width: 1200px) {
            .menu-panel {
                width: 35%;
            }
            
            .game-panel {
                width: 65%;
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .menu-panel {
                width: 100%;
                height: 40vh;
            }
            
            .game-panel {
                width: 100%;
                height: 60vh;
            }
            
            .menu-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .character-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 15px;
            }
            
            .character-card {
                padding: 10px;
                min-height: 250px;
            }
            
            .character-preview {
                width: 50px;
                height: 50px;
                margin: 0 auto 8px;
            }
            
            .character-sprite {
                font-size: 25px;
            }
            
            .character-card h3 {
                font-size: 12px;
            }
            
            .character-stats .stat {
                font-size: 9px;
            }
            
            .character-description {
                font-size: 8px;
                min-height: 20px;
            }
            
            .select-character {
                padding: 5px 10px;
                font-size: 9px;
            }
        }
        
        .character-sprite {
            font-size: 30px;
            filter: drop-shadow(2px 2px 0px #000);
        }
        
        /* Grid de personagens lado a lado */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }
        
        .character-card {
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 0;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 
                inset 2px 2px 0px #A0522D,
                inset -2px -2px 0px #654321,
                2px 2px 0px #000;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .character-card:hover {
            background: #A0522D;
            border-color: #FFD700;
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                inset 2px 2px 0px #CD853F,
                inset -2px -2px 0px #8B4513,
                4px 4px 0px #000,
                0 8px 16px rgba(255, 215, 0, 0.3);
        }
        
        .character-card:active {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 
                inset 2px 2px 0px #CD853F,
                inset -2px -2px 0px #8B4513,
                2px 2px 0px #000;
        }
        
        .character-preview {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            border: 3px solid #000;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 
                inset 2px 2px 0px rgba(255, 255, 255, 0.3),
                inset -2px -2px 0px rgba(0, 0, 0, 0.3),
                2px 2px 0px #000;
        }
        
        .character-card:hover .character-preview {
            transform: scale(1.1);
            box-shadow: 
                inset 2px 2px 0px rgba(255, 255, 255, 0.5),
                inset -2px -2px 0px rgba(0, 0, 0, 0.2),
                3px 3px 0px #000,
                0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .character-card h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 8px;
            text-shadow: 1px 1px 0px #000;
            font-weight: bold;
        }
        
        .character-card:hover h3 {
            color: #FFF;
            text-shadow: 2px 2px 0px #000, 0 0 5px rgba(255, 215, 0, 0.8);
        }
        
        .character-stats {
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
        }
        
        .character-card:hover .character-stats {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .character-stats .stat {
            color: #FFF;
            font-size: 10px;
            margin: 3px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Courier New', monospace;
        }
        
        .character-card:hover .character-stats .stat {
            color: #FFD700;
        }
        
        .character-description {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 9px;
            text-align: center;
            margin: 8px 0;
            line-height: 1.2;
            min-height: 25px;
        }
        
        .character-card:hover .character-description {
            color: #FFD700;
        }
        
        .select-character {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 6px 12px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .select-character:hover {
            background: #32CD32;
            transform: translateY(-1px);
            box-shadow: 2px 2px 0px #000;
        }
        
        .select-character:active {
            transform: translateY(0px);
            box-shadow: 1px 1px 0px #000;
        }
        
        .character-card:hover .select-character {
            background: #FFD700;
            color: #000;
            border-color: #FFA500;
        }
        
        .character-card:hover .select-character:hover {
            background: #FFA500;
        }
        
        /* Estilo Pixel Art para UI do Jogo */
        #healthBar, #manaBar {
            width: 220px;
            height: 20px;
            background: #000;
            border: 2px solid #8B4513;
            margin: 5px 0;
            position: relative;
            border-radius: 0;
            box-shadow: 
                inset 2px 2px 0px #654321,
                inset -2px -2px 0px #A0522D,
                2px 2px 0px #000;
            image-rendering: pixelated;
        }
        
        .ui-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }
        
        .level-display, .gold-display, .exp-display {
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            padding: 6px 12px;
            border: 2px solid #8B4513;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            box-shadow: 2px 2px 0px #000;
        }
   E
         
        .exp-display {
            color: #00FF00;
        }
        
        #healthFill {
            height: 100%;
            background: #ff0000;
            border-radius: 0;
            transition: width 0.3s ease;
            box-shadow: inset 1px 1px 0px #ff6666;
        }
        
        #manaFill {
            height: 100%;
            background: #0066ff;
            border-radius: 0;
            transition: width 0.3s ease;
            box-shadow: inset 1px 1px 0px #66aaff;
        }
        
        #healthText, #manaText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFD700;
            font-weight: bold;
            text-shadow: 1px 1px 0px #000;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }
        
        #level, #exp {
            color: #FFD700;
            font-weight: bold;
            text-shadow: 1px 1px 0px #000;
            margin: 3px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        /* Estilo Pixel Art para Mapa Mundo - Tela Cheia */
        .world-map-container {
            display: flex;
            gap: 20px;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            flex: 1;
            overflow: hidden;
        }
        
        .world-map {
            flex: 1;
            position: relative;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(135, 206, 235, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(147, 112, 219, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            border: 4px solid #FFD700;
            border-radius: 0;
            box-shadow: 
                inset 4px 4px 0px #FFA500,
                inset -4px -4px 0px #FF8C00,
                4px 4px 0px #000,
                0 0 20px rgba(255, 215, 0, 0.3);
            image-rendering: pixelated;
            overflow: hidden;
        }
        
        .map-location {
            position: absolute;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            transform: translate(-50%, -50%);
        }
        
        .map-location:hover {
            transform: translate(-50%, -50%) scale(1.05);
            filter: brightness(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .location-icon {
            font-size: 32px;
            margin-bottom: 5px;
            filter: drop-shadow(2px 2px 0px #000);
        }
        
        .location-name {
            background: #8B4513;
            color: #FFD700;
            padding: 4px 8px;
            border: 2px solid #654321;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 
                inset 1px 1px 0px #A0522D,
                inset -1px -1px 0px #654321,
                2px 2px 0px #000;
            white-space: nowrap;
        }
        
        .map-info {
            width: 300px;
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 0;
            padding: 20px;
            box-shadow: 
                inset 3px 3px 0px #A0522D,
                inset -3px -3px 0px #654321,
                3px 3px 0px #000;
        }
        
        .map-info h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 10px;
            text-shadow: 1px 1px 0px #000;
        }
        
        .world-map-actions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .world-map-actions .menu-btn {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            background: #8B4513;
            color: #FFD700;
            border: 2px solid #654321;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s ease;
            box-shadow: 2px 2px 0px #654321;
        }
        
        .world-map-actions .menu-btn:hover {
            background: #A0522D;
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px #654321;
        }
        
        .world-map-actions .menu-btn:active {
            transform: translateY(0px);
            box-shadow: 1px 1px 0px #654321;
        }
npm
        /* Mapa Mundi Moderno */
        .world-map-modern {
            display: flex;
            gap: 20px;
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .map-container {
            flex: 2;
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        
        .sidebar-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-section h3 {
            margin: 0 0 15px 0;
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }
        
        /* Inventário Compacto */
        .inventory-compact {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }
        
        .inventory-slot:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        /* Loja Compacta */
        .shop-compact {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .shop-categories {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .category-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .category-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .shop-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .shop-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 12px;
        }
        
        .item-icon {
            font-size: 16px;
        }
        
        .item-name {
            flex: 1;
            color: #e5e7eb;
        }
        
        .item-price {
            color: #fbbf24;
            font-weight: 600;
        }
        
        /* Ações Rápidas */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn-modern {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-modern:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Inventário Moderno */
        .inventory-modern {
            display: flex;
            gap: 20px;
            height: 100%;
        }
        
        .inventory-main {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .inventory-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .inventory-info h3 {
            margin: 0 0 15px 0;
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }
        
        .equipped-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .equipped-slot {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .equipped-slot label {
            color: #e5e7eb;
            font-weight: 500;
            min-width: 80px;
        }
        
        .equipped-item {
            color: #9ca3af;
            font-style: italic;
        }
        
        .item-details {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gold-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gold-icon {
            font-size: 16px;
        }
        
        #playerGold {
            color: #fbbf24;
            font-weight: 600;
            font-size: 16px;
        }

        /* Loja Moderna */
        .shop-modern {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
        
        .shop-modern .shop-categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .shop-modern .category-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        
        .shop-modern .category-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .shop-modern .category-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .shop-main {
            display: flex;
            gap: 20px;
            flex: 1;
        }
        
        .shop-modern .shop-items {
            flex: 2;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .shop-modern .shop-info {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .shop-modern .shop-info h3 {
            margin: 0 0 15px 0;
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }

        /* Missões Modernas */
        .missions-modern {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }
        
        .missions-modern .missions-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .mission-tab {
            background: rgba(255, 255, 255, 0.1);
            color: #e5e7eb;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        
        .mission-tab.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .mission-tab:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .missions-map {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .location-section {
            margin-bottom: 30px;
        }
        
        .location-section h3 {
            color: #3b82f6;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            font-family: 'Inter', sans-serif;
        }
        
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .mission-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .mission-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .mission-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .mission-info h4 {
            color: #e5e7eb;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            font-family: 'Inter', sans-serif;
        }
        
        .mission-info p {
            color: #9ca3af;
            font-size: 14px;
            margin: 0 0 15px 0;
            line-height: 1.4;
        }
        
        .mission-details {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .mission-details span {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .mission-rewards {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mission-rewards span {
            color: #fbbf24;
            font-size: 12px;
            font-weight: 600;
        }
        
        .mission-select-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            width: 100%;
        }
        
        .mission-select-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .player-level, .player-name, .player-gold {
            color: #e5e7eb;
            font-size: 14px;
            font-weight: 500;
        }
        
        .player-gold {
            color: #fbbf24;
        }
        
        .map-info p {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .location-details {
            background: #000;
            border: 2px solid #654321;
            padding: 15px;
            border-radius: 0;
            min-height: 100px;
        }
        
        .location-details p {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 0;
        }
        
        /* Submenus Modernos com Glassmorphism */
        .submenu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .submenu-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
        }
        
        .submenu-header {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(29, 78, 216, 0.8));
            color: white;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
        }
        
        .submenu-header h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            font-family: 'Inter', sans-serif;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Ajustar posicionamento dos elementos dentro da janela */
        #ui {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 10;
        }
        
        
        /* Canvas responsivo dentro da janela - DESABILITADO */
        #gameCanvas {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            border: 2px solid #8B4513;
            border-radius: 0;
            box-shadow: 
                inset 2px 2px 0px #A0522D,
                inset -2px -2px 0px #654321,
                2px 2px 0px #000;
            display: none; /* Canvas desabilitado por enquanto */
        }
        
        /* Menu Principal - Dentro da Janela */
        #mainMenu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }
        
        #mainMenu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #eee, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: twinkle 4s ease-in-out infinite alternate;
            pointer-events: none;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        /* Ajustar tamanho dos botões para a janela menor */
        .menu-btn {
            padding: 12px 25px;
            font-size: 1em;
            margin: 6px 0;
            min-width: 180px;
        }
        
        .menu-btn.primary {
            font-size: 1.1em;
            padding: 15px 30px;
            min-width: 200px;
        }
        
        
        @keyframes starShimmer {
            0% { 
                color: #87CEEB;
                text-shadow: 0 0 10px rgba(135, 206, 235, 0.8);
            }
            100% { 
                color: #FFD700;
                text-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
            }
        }
        
        /* Janela de Chat */
        .chat-window {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 200px;
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 0;
            box-shadow: 
                inset 3px 3px 0px #A0522D,
                inset -3px -3px 0px #654321,
                3px 3px 0px #000;
            image-rendering: pixelated;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: #654321;
            color: #FFD700;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #8B4513;
        }
        
        .chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background: #000;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: #FFF;
            line-height: 1.3;
        }
        
        .chat-input-container {
            display: flex;
            border-top: 2px solid #654321;
        }
        
        .chat-input {
            flex: 1;
            background: #000;
            color: #FFF;
            border: none;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            outline: none;
        }
        
        .chat-send {
            background: #654321;
            color: #FFD700;
            border: none;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            border-left: 2px solid #8B4513;
        }
        
        .chat-send:hover {
            background: #8B4513;
        }
        
        .chat-message {
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .chat-message.system {
            color: #FFD700;
            font-style: italic;
        }
        
        .chat-message.player {
            color: #87CEEB;
        }
        
        .chat-message.npc {
            color: #98FB98;
        }
        
        /* Sistema de Loja e Inventário */
        .gold-display {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
        }
        
        .gold-icon {
            font-size: 16px;
        }
        
        .inventory-main {
            display: flex;
            gap: 20px;
            height: 100%;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 300px;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #000;
            border: 2px solid #654321;
            border-radius: 0;
        }
        
        .inventory-slot {
            width: 50px;
            height: 50px;
            background: #696969;
            border: 2px solid #8B4513;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .inventory-slot:hover {
            background: #A0522D;
            border-color: #FFD700;
        }
        
        .inventory-slot.equipped {
            background: #FFD700;
            border-color: #FFA500;
        }
        
        .inventory-slot .item-icon {
            width: 40px;
            height: 40px;
            image-rendering: pixelated;
        }
        
        .inventory-slot .item-quantity {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background: #000;
            color: #FFF;
            font-size: 10px;
            padding: 1px 3px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
        }
        
        .equipped-items {
            margin-bottom: 20px;
        }
        
        .equipped-slot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: #000;
            border: 1px solid #654321;
            border-radius: 0;
        }
        
        .equipped-slot label {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .equipped-item {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }
        
        .shop-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            flex: 1;
            overflow: hidden;
        }
        
        .shop-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            background: #654321;
            color: #FFD700;
            border: 2px solid #8B4513;
            padding: 8px 15px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .category-btn:hover {
            background: #8B4513;
        }
        
        .category-btn.active {
            background: #FFD700;
            color: #000;
            border-color: #FFA500;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #000;
            border: 2px solid #654321;
            border-radius: 0;
        }
        
        .shop-item {
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .shop-item:hover {
            background: #A0522D;
            border-color: #FFD700;
        }
        
        .shop-item .item-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 8px;
            image-rendering: pixelated;
        }
        
        .shop-item .item-name {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .shop-item .item-price {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }
        
        .shop-item .item-quantity {
            color: #90EE90;
            font-family: 'Courier New', monospace;
            font-size: 9px;
            margin-top: 3px;
        }
        
        .shop-info {
            width: 300px;
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 15px;
        }
        
        .shop-info h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .item-details {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .item-details h4 {
            color: #FFD700;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .item-details .item-stats {
            margin: 8px 0;
        }
        
        .item-details .item-stats span {
            display: block;
            margin: 2px 0;
        }
        
        .buy-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 6px 12px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        
        .buy-btn:hover {
            background: #32CD32;
        }
        
        .buy-btn:disabled {
            background: #696969;
            border-color: #808080;
            cursor: not-allowed;
        }
        
        /* Sistema de Missões */
        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .missions-content {
            flex: 1;
            overflow: hidden;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
        }
        
        .missions-map {
            padding: 20px;
            display: block;
            position: relative;
            z-index: 1;
        }
        
        #missionsContainer {
            display: block !important;
            position: relative;
            z-index: 1;
        }
        
        #roomsContainer {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        #createRoomContainer {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        #roomLobbyContainer {
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .location-section {
            margin-bottom: 30px;
        }
        
        .location-section h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .mission-card {
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 0;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .mission-card:hover {
            background: #A0522D;
            border-color: #FFD700;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .mission-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin: 0 auto 10px;
            border: 3px solid #000;
        }
        
        .mission-info h4 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .mission-info p {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin-bottom: 10px;
            text-align: center;
            line-height: 1.3;
        }
        
        .mission-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .mission-details span {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            background: #000;
            padding: 2px 6px;
            border-radius: 0;
        }
        
        .mission-rewards {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        
        .mission-rewards span {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
        }
        
        .mission-select-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 8px 15px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }
        
        .mission-select-btn:hover {
            background: #32CD32;
            transform: translateY(1px);
        }
        
        /* Sistema de Salas */
        .rooms-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #654321;
            border-bottom: 3px solid #8B4513;
        }
        
        .rooms-header h2 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 16px;
        }
        
        .create-room-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 8px 15px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .create-room-btn:hover {
            background: #32CD32;
        }
        
        .rooms-list {
            padding: 20px;
        }
        
        .no-rooms {
            text-align: center;
            padding: 40px;
            color: #FFF;
            font-family: 'Courier New', monospace;
        }
        
        .no-rooms p {
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .room-card {
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .room-card:hover {
            background: #A0522D;
            border-color: #FFD700;
        }
        
        .room-info h4 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .room-details {
            display: flex;
            gap: 10px;
        }
        
        .room-details span {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            background: #000;
            padding: 2px 6px;
            border-radius: 0;
        }
        
        .room-players {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .player-avatar {
            width: 30px;
            height: 30px;
            background: #654321;
            border: 1px solid #8B4513;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            position: relative;
        }
        
        .player-avatar.ready {
            background: #228B22;
            border-color: #32CD32;
        }
        
        .player-avatar .character-icon {
            font-size: 14px;
        }
        
        .room-actions {
            display: flex;
            gap: 10px;
        }
        
        .join-room-btn, .leave-room-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 6px 12px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .join-room-btn:hover, .leave-room-btn:hover {
            background: #32CD32;
        }
        
        .leave-room-btn {
            background: #DC143C;
            border-color: #FF6347;
        }
        
        .leave-room-btn:hover {
            background: #FF6347;
        }
        
        /* Formulário de Criação de Sala */
        .create-room-form {
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            background: #000;
            color: #FFF;
            border: 2px solid #654321;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #FFD700;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .create-room-confirm-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 10px 20px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .create-room-confirm-btn:hover {
            background: #32CD32;
        }
        
        .cancel-btn {
            background: #DC143C;
            color: #FFF;
            border: 2px solid #FF6347;
            padding: 10px 20px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .cancel-btn:hover {
            background: #FF6347;
        }
        
        /* Lobby da Sala */
        .room-lobby-content {
            padding: 20px;
        }
        
        .mission-info {
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .mission-info h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .mission-info p {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .mission-details {
            display: flex;
            gap: 10px;
        }
        
        .mission-details span {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            background: #000;
            padding: 2px 6px;
            border-radius: 0;
        }
        
        .players-list h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .player-card {
            background: #654321;
            border: 2px solid #8B4513;
            border-radius: 0;
            padding: 10px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .player-card.ready {
            background: #228B22;
            border-color: #32CD32;
        }
        
        .player-card.current-player {
            border-color: #FFD700;
            background: #8B4513;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            background: #000;
            border: 2px solid #8B4513;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-size: 16px;
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .player-name {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
        }
        
        .player-level {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }
        
        .player-status {
            color: #90EE90;
            font-family: 'Courier New', monospace;
            font-size: 9px;
        }
        
        .lobby-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .ready-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 10px 20px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .ready-btn:hover {
            background: #32CD32;
        }
        
        .ready-btn.ready {
            background: #DC143C;
            border-color: #FF6347;
        }
        
        .ready-btn.ready:hover {
            background: #FF6347;
        }
        
        .start-mission-btn {
            background: #FFD700;
            color: #000;
            border: 2px solid #FFA500;
            padding: 10px 20px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .start-mission-btn:hover {
            background: #FFA500;
        }
        
        .start-mission-btn.disabled {
            background: #696969;
            border-color: #808080;
            cursor: not-allowed;
        }
        
        /* Sistema de Habilidades */
        .skill-points-display {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
        }
        
        .skill-points-icon {
            font-size: 16px;
        }
        
        .skills-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .skill-tree {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .skill-tree h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .skill-category {
            margin-bottom: 30px;
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 20px;
        }
        
        .skill-category h4 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #654321;
            padding-bottom: 5px;
        }
        
        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #000;
            border: 1px solid #654321;
            border-radius: 0;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }
        
        .skill-item:hover {
            background: #1a1a1a;
            border-color: #FFD700;
        }
        
        .skill-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }
        
        .skill-name {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
        }
        
        .skill-description {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            opacity: 0.8;
        }
        
        .skill-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 8px 15px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }
        
        .skill-btn:hover:not(:disabled) {
            background: #32CD32;
            transform: translateY(-1px);
        }
        
        .skill-btn:disabled {
            background: #696969;
            border-color: #808080;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .skill-btn.available {
            background: #FFD700;
            color: #000;
            border-color: #FFA500;
        }
        
        .skill-btn.available:hover {
            background: #FFA500;
        }
        
        /* Sistema de Abas de Missões */
        .missions-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .mission-tab {
            background: #654321;
            color: #FFD700;
            border: 2px solid #8B4513;
            padding: 10px 20px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mission-tab:hover {
            background: #8B4513;
            transform: translateY(-1px);
        }
        
        .mission-tab.active {
            background: #FFD700;
            color: #000;
            border-color: #FFA500;
        }
        
        .mission-tab.active:hover {
            background: #FFA500;
        }
        
        /* Sistema de Configurações */
        .settings-content {
            flex: 1;
            overflow: hidden;
            padding: 20px;
            align-content: start;
        }
        
        .settings-section {
            background: #8B4513;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .settings-section h3 {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #654321;
            padding-bottom: 5px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #000;
            border: 1px solid #654321;
            border-radius: 0;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }
        
        .setting-item:hover {
            background: #1a1a1a;
            border-color: #FFD700;
        }
        
        .setting-item label {
            color: #FFD700;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            flex: 1;
        }
        
        .setting-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-control input[type="range"] {
            width: 150px;
            height: 5px;
            background: #654321;
            border-radius: 0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .setting-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #FFD700;
            border-radius: 0;
            cursor: pointer;
        }
        
        .setting-control input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #FFD700;
        }
        
        .setting-control select {
            background: #000;
            color: #FFD700;
            border: 2px solid #654321;
            border-radius: 0;
            padding: 5px 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .setting-control span {
            color: #FFF;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            min-width: 50px;
            text-align: right;
        }
        
        .settings-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .settings-btn {
            background: #228B22;
            color: #FFF;
            border: 2px solid #32CD32;
            padding: 12px 25px;
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .settings-btn:hover {
            background: #32CD32;
            transform: translateY(-1px);
        }
        
        .settings-btn.reset {
            background: #8B4513;
            border-color: #A0522D;
        }
        
        .settings-btn.reset:hover {
            background: #A0522D;
        }
        
        .settings-btn.save {
            background: #FFD700;
            color: #000;
            border-color: #FFA500;
        }
        
        .settings-btn.save:hover {
            background: #FFA500;
        }

        /* Interface de Missão Ativa */
        .mission-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 350px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            z-index: 1000;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #374151;
        }

        .mission-header h3 {
            color: #3b82f6;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .close-mission-btn {
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-mission-btn:hover {
            background: #374151;
            color: #ef4444;
        }

        .mission-objectives {
            margin-bottom: 20px;
        }

        .objective-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #374151;
            transition: all 0.2s ease;
        }

        .objective-item:last-child {
            border-bottom: none;
        }

        .objective-item.completed {
            opacity: 0.7;
        }

        .objective-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 14px;
            font-weight: bold;
        }

        .objective-item:not(.completed) .objective-icon {
            color: #6b7280;
        }

        .objective-item.completed .objective-icon {
            color: #10b981;
        }

        .objective-text {
            flex: 1;
            color: #e5e7eb;
            font-size: 14px;
            line-height: 1.4;
        }

        .objective-progress {
            color: #3b82f6;
            font-size: 12px;
            font-weight: 600;
            background: rgba(59, 130, 246, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
        }

        .mission-progress {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .mission-progress span {
            color: #3b82f6;
            font-size: 12px;
            font-weight: 600;
            min-width: 35px;
        }

        /* Estilos para botões de missão */
        .mission-select-btn.disabled {
            background: #6b7280 !important;
            border-color: #9ca3af !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        .mission-select-btn.completed {
            background: #10b981 !important;
            border-color: #059669 !important;
        }

        .mission-select-btn.active {
            background: #f59e0b !important;
            border-color: #d97706 !important;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mission Notifications */
        .mission-notification {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            z-index: 10000;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease-out;
        }

        .mission-notification.success {
            border-left-color: #10b981;
        }

        .mission-notification.warning {
            border-left-color: #f59e0b;
        }

        .mission-notification.error {
            border-left-color: #ef4444;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Editor de Jogo */
        .game-editor {
            position: absolute;
            left: -350px;
            top: 0;
            width: 350px;
            height: 100%;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
            border-right: 3px solid #3b82f6;
            z-index: 1000;
            overflow-y: auto;
            font-family: 'Inter', sans-serif;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
            transition: left 0.3s ease;
        }
        
        .game-editor.open {
            left: 0;
        }

        .editor-header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            padding: 20px;
            color: white;
            text-align: center;
            border-bottom: 2px solid #1d4ed8;
        }

        .editor-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .editor-header p {
            margin: 5px 0 0 0;
            font-size: 12px;
            opacity: 0.8;
        }

        .editor-toggle {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: #3b82f6;
            color: white;
            border: none;
            padding: 15px 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            z-index: 1001;
            font-size: 16px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .editor-toggle:hover {
            background: #1d4ed8;
            transform: translateY(-50%) translateX(5px);
        }

        .editor-sections {
            padding: 20px;
        }

        .editor-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background: rgba(59, 130, 246, 0.2);
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .section-header:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .section-header h3 {
            margin: 0;
            color: #3b82f6;
            font-size: 14px;
            font-weight: 600;
        }

        .section-toggle {
            color: #3b82f6;
            font-size: 18px;
            transition: transform 0.2s ease;
        }

        .section-toggle.expanded {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 15px;
            display: none;
        }

        .section-content.expanded {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #e5e7eb;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #e5e7eb;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-row {
            display: flex;
            gap: 10px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .color-picker {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px dashed #3b82f6;
            border-radius: 6px;
            color: #3b82f6;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload-label:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .btn-editor {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn-editor:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-editor.secondary {
            background: #6b7280;
        }

        .btn-editor.secondary:hover {
            background: #4b5563;
        }

        .btn-editor.success {
            background: #10b981;
        }

        .btn-editor.success:hover {
            background: #059669;
        }

        .btn-editor.danger {
            background: #ef4444;
        }

        .btn-editor.danger:hover {
            background: #dc2626;
        }

        .preview-image {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item label {
            font-size: 10px;
            color: #9ca3af;
            margin-bottom: 3px;
        }

        .stat-item input {
            font-size: 11px;
            padding: 4px 8px;
        }

        .editor-actions {
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .notification {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            z-index: 10000;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.warning {
            background: #f59e0b;
        }

        /* Ajustar layout principal quando editor estiver aberto */
        body.editor-open .main-container {
            margin-left: 350px;
        }

        body.editor-open .game-window {
            margin-left: 0;
        }

        /* ========================================
           ESTILOS PARA HEADER DO MAPA DO MUNDO
           ======================================== */
        
        .world-map-actions {
            display: flex;
            gap: 10px;
            margin-left: auto;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(29, 78, 216, 0.8));
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 1), rgba(29, 78, 216, 1));
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        /* Ajustar header do mapa para acomodar os botões */
        .submenu-header {
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .submenu-header h2 {
            flex: 1;
            min-width: 200px;
        }

        /* ========================================
           ESTILOS PARA NOVA ESTRUTURA DO MAPA
           ======================================== */
        
        /* Header do mapa do mundo */
        .world-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 100;
        }

        .world-map-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(29, 78, 216, 0.8));
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 50px;
            text-align: center;
            position: relative;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 1), rgba(29, 78, 216, 1));
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .nav-btn:active {
            transform: translateY(0px);
        }

        /* Título sobreposto */
        .map-title {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            color: #FFD700;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 50;
        }

        /* Conteúdo do mapa */
        .submenu-content {
            position: relative;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        /* Container do mapa */
        .map-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Hover melhorado para ícones */
        .map-location:hover {
            transform: translate(-50%, -50%) scale(1.05) !important;
            filter: brightness(1.2) !important;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6) !important;
            transition: all 0.3s ease !important;
        }

        /* Responsividade para o header */
        @media (max-width: 768px) {
            .world-map-header {
                padding: 10px 15px;
            }
            
            .world-map-nav {
                gap: 5px;
            }
            
            .nav-btn {
                padding: 8px 12px;
                font-size: 14px;
                min-width: 40px;
            }
            
            .map-title {
                font-size: 16px;
                padding: 8px 15px;
                top: 15px;
                left: 15px;
            }
        }
        
        /* ========================================
           FUNDO DE ESTRELAS PARA O MAPA DO MUNDO
           ======================================== */
        
        /* Fundo de Estrelas para o Mapa do Mundo */
        .world-map-starfield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f23 100%);
        }
        
        .world-map-starfield-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* Ajustar z-index dos elementos do mapa */
        .world-map-header {
            position: relative;
            z-index: 100 !important;
        }
        
        .map-title {
            position: relative;
            z-index: 50 !important;
        }
        
        .map-container {
            position: relative;
            z-index: 10 !important;
        }
        
        .world-map-modern {
            position: relative;
            z-index: 10 !important;
        }
        
        /* ========================================
           ESTILOS PARA MENUS MELHORADOS
           ======================================== */
        
        /* Layout do Inventário */
        .inventory-layout {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            height: 100%;
            padding: 20px;
        }
        
        .inventory-section, .equipment-section, .item-details-section {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .inventory-section h3, .equipment-section h3, .item-details-section h3 {
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .inventory-slot {
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(29, 78, 216, 0.3));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .inventory-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            border-color: #3b82f6;
        }
        
        .inventory-slot.empty {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.2), rgba(75, 85, 99, 0.2));
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        .inventory-slot.empty:hover {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.3), rgba(75, 85, 99, 0.3));
        }
        
        .item-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .item-name {
            font-size: 10px;
            color: #fff;
            text-align: center;
            line-height: 1.2;
        }
        
        .item-quantity {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }
        
        /* Grid de Equipamentos */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .equipment-slot {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.3), rgba(124, 58, 237, 0.3));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .equipment-slot:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }
        
        .slot-label {
            color: #FFD700;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .equipped-item {
            color: #fff;
            font-size: 14px;
        }
        
        /* Detalhes do Item */
        .item-details-section {
            overflow-y: auto;
        }
        
        .item-preview {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .item-icon-large {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .item-name-large {
            color: #FFD700;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .item-rarity {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .item-rarity.common { background: #6b7280; color: white; }
        .item-rarity.uncommon { background: #10b981; color: white; }
        .item-rarity.rare { background: #3b82f6; color: white; }
        .item-rarity.epic { background: #8b5cf6; color: white; }
        .item-rarity.legendary { background: #f59e0b; color: white; }
        
        .item-stats {
            margin-bottom: 15px;
        }
        
        .stat-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .stat-name {
            color: #94a3b8;
        }
        
        .stat-value {
            color: #10b981;
            font-weight: bold;
        }
        
        .item-description {
            color: #d1d5db;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .action-btn.equip {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .action-btn.sell {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Layout da Loja */
        .shop-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: 100%;
            padding: 20px;
        }
        
        .shop-categories, .shop-items-section, .shop-details-section {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9));
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .category-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .category-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(29, 78, 216, 0.3));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .shop-item {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(29, 78, 216, 0.2));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .shop-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .shop-item.special-offer {
            border: 2px solid #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
        }
        
        .special-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f59e0b;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        
        .buy-btn {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .buy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        .purchase-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .action-btn.buy {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .action-btn.compare {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }
        
        /* Player Resources */
        .player-resources {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .player-resources > div {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .shop-special {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .mission-progress {
            color: #10b981 !important;
        }
        
        /* ========================================
           REDUÇÃO GERAL DE TAMANHOS - COMPACTO
           ======================================== */
        
        /* Reduzir fontes globais */
        .submenu-header h2, .menu-card-title, .mission-tab, .category-btn, .control-section h3, .settings-section h3, .game-info h3 {
            font-size: 14px !important;
        }
        
        /* Reduzir padding e margins */
        .submenu-header, .menu-content, .submenu-content {
            padding: 8px 12px !important;
        }
        
        /* Reduzir tamanho dos botões */
        .back-btn, .nav-btn, .action-btn, .category-btn, .mission-tab, .settings-btn {
            padding: 6px 10px !important;
            font-size: 12px !important;
        }
        
        /* Reduzir padding dos grids (mantendo layout original) */
        .inventory-grid, .shop-items {
            padding: 8px !important;
        }
        
        /* Manter tamanho original dos slots de itens */
        
        /* Reduzir altura máxima dos containers */
        .inventory-modern, .shop-modern, .missions-modern {
            max-height: 300px !important;
            padding: 10px !important;
        }
        
        /* Ajustar containers específicos da loja */
        .shop-layout {
            display: grid;
            grid-template-columns: 180px 1fr !important;
            gap: 8px !important;
            height: auto !important;
            max-height: 250px !important;
        }
        
        .shop-categories {
            padding: 6px !important;
            max-height: 200px !important;
            overflow-y: auto !important;
        }
        
        .shop-main {
            padding: 6px !important;
            overflow-y: auto !important;
            max-height: 200px !important;
        }
        
        .shop-info {
            max-height: 150px !important;
            overflow-y: auto !important;
            padding: 6px !important;
        }
        
        .category-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px !important;
        }
        
        .category-btn {
            padding: 4px 8px !important;
            font-size: 11px !important;
        }
        
        /* Reduzir tamanho dos inputs e selects */
        input, select, textarea {
            font-size: 12px !important;
            padding: 4px 6px !important;
        }
        
        /* Reduzir espaçamento entre elementos */
        .setting-item, .control-item, .mission-item {
            margin: 4px 0 !important;
            padding: 4px !important;
        }
        
        /* ========================================
           ÍCONES DE MISSÕES NO MAPA DO MUNDO
           ======================================== */
        
        .mission-icons-container {
            position: absolute;
            top: 45%; /* Ligeiramente acima do centro vertical */
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 15px 25px;
            z-index: 60;
            pointer-events: none; /* Permitir clique através do container */
            width: 85%; /* Largura do container */
            max-width: 750px; /* Largura máxima */
            gap: 15px; /* Espaçamento entre ícones */
        }
        
        .mission-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 15px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: auto; /* Permitir clique no ícone */
            backdrop-filter: blur(15px);
            min-width: 90px;
            max-width: 110px;
            text-align: center;
            flex: 1; /* Distribuir uniformemente */
        }
        
        .mission-icon:hover {
            transform: translateY(-5px) scale(1.1);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(29, 78, 216, 0.9));
            border-color: rgba(255, 215, 0, 0.8);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .mission-icon-symbol {
            font-size: 28px;
            margin-bottom: 6px;
        }
        
        .mission-icon-name {
            font-size: 12px;
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .mission-icon-level {
            font-size: 10px;
            color: #87CEEB;
            background: rgba(0, 0, 0, 0.4);
            padding: 3px 6px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Estados dos ícones */
        .mission-icon.available {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
        }
        
        .mission-icon.locked {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #6b7280;
        }
        
        .mission-icon.completed {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
        }
        
        /* ========================================
           SISTEMA DE COMBATE PARA MISSÕES (GRAND CHASE STYLE)
           ======================================== */
        
        .mission-combat-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f23 100%);
            z-index: 1000;
            display: none;
        }
        
        .mission-combat-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(26, 26, 46, 0.9);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .mission-info {
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
        }
        
        .mission-progress {
            color: #87CEEB;
            font-size: 12px;
        }
        
        .mission-controls {
            display: flex;
            gap: 10px;
        }
        
        .mission-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .mission-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
        }
        
        .mission-canvas {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            background: rgba(15, 15, 35, 0.8);
            max-width: 95vw;
            max-height: 70vh;
        }
        
        .mission-controls-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .controls-title {
            color: #FFD700;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #87CEEB;
            font-size: 12px;
        }
        
        .control-key {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Editor de Jogo -->
    <button class="editor-toggle" id="editorToggle" title="Abrir Editor de Jogo">
        ⚙️
    </button>

    <div class="game-editor" id="gameEditor">
        <div class="editor-header">
            <h2>Editor de Jogo</h2>
            <p>Nova Remains - Edição Intuitiva</p>
        </div>

        <div class="editor-sections">
            <!-- Seção de Personagens -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('characters')">
                    <h3>👥 Personagens</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="characters">
                    <div class="form-group">
                        <label>Selecionar Personagem</label>
                        <select id="characterSelect">
                            <option value="juno">Juno - Caçadora de Estrelas</option>
                            <option value="atlas">Atlas - Guardião Cósmico</option>
                            <option value="vega">Vega - Exploradora Espacial</option>
                            <option value="kai">Kai - Guerreiro Estelar</option>
                        </select>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <label>Vida</label>
                            <input type="number" id="charHealth" value="100" min="1" max="1000">
                        </div>
                        <div class="stat-item">
                            <label>Dano</label>
                            <input type="number" id="charDamage" value="25" min="1" max="200">
                        </div>
                        <div class="stat-item">
                            <label>Velocidade</label>
                            <input type="number" id="charSpeed" value="5" min="1" max="20">
                        </div>
                        <div class="stat-item">
                            <label>Defesa</label>
                            <input type="number" id="charDefense" value="10" min="0" max="100">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Descrição do Personagem</label>
                        <textarea id="charDescription" placeholder="Descreva o personagem...">Caçador de estrelas experiente com habilidades únicas.</textarea>
                    </div>

                    <div class="form-group">
                        <label>Habilidade Especial</label>
                        <input type="text" id="charSpecial" placeholder="Nome da habilidade" value="Ataque Estelar">
                    </div>

                    <button class="btn-editor success" onclick="saveCharacter()">💾 Salvar Personagem</button>
                </div>
            </div>

            <!-- Seção de Assets -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('assets')">
                    <h3>🎨 Assets & Imagens</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="assets">
                    <div class="form-group">
                        <label>Tipo de Asset</label>
                        <select id="assetType">
                            <option value="character">Personagem</option>
                            <option value="enemy">Inimigo</option>
                            <option value="item">Item</option>
                            <option value="background">Fundo</option>
                            <option value="effect">Efeito</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Upload de Imagem</label>
                        <div class="file-upload">
                            <input type="file" id="assetUpload" accept="image/*" onchange="previewAsset(this)">
                            <label for="assetUpload" class="file-upload-label">
                                📁 Clique para selecionar imagem
                            </label>
                        </div>
                        <img id="assetPreview" class="preview-image" style="display: none;">
                    </div>

                    <div class="form-group">
                        <label>Nome do Asset</label>
                        <input type="text" id="assetName" placeholder="Nome único do asset">
                    </div>

                    <div class="form-group">
                        <label>Dimensões (Largura x Altura)</label>
                        <div class="form-row">
                            <input type="number" id="assetWidth" placeholder="Largura" value="64">
                            <input type="number" id="assetHeight" placeholder="Altura" value="64">
                        </div>
                    </div>

                    <button class="btn-editor" onclick="uploadAsset()">📤 Upload Asset</button>
                    <button class="btn-editor secondary" onclick="previewAllAssets()">👁️ Visualizar Assets</button>
                </div>
            </div>

            <!-- Seção de Economia -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('economy')">
                    <h3>💰 Economia & Preços</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="economy">
                    <div class="form-group">
                        <label>Moeda Inicial do Jogador</label>
                        <input type="number" id="startingGold" value="1000" min="0" max="100000">
                    </div>

                    <div class="form-group">
                        <label>Taxa de Ganho de Ouro (por inimigo)</label>
                        <input type="number" id="goldPerEnemy" value="10" min="1" max="1000">
                    </div>

                    <h4 style="color: #3b82f6; margin: 15px 0 10px 0;">Preços de Itens</h4>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <label>Poção de Vida</label>
                            <input type="number" id="priceHealthPotion" value="50" min="1" max="1000">
                        </div>
                        <div class="stat-item">
                            <label>Poção de Mana</label>
                            <input type="number" id="priceManaPotion" value="75" min="1" max="1000">
                        </div>
                        <div class="stat-item">
                            <label>Arma Básica</label>
                            <input type="number" id="priceBasicWeapon" value="200" min="1" max="5000">
                        </div>
                        <div class="stat-item">
                            <label>Armadura Básica</label>
                            <input type="number" id="priceBasicArmor" value="300" min="1" max="5000">
                        </div>
                    </div>

                    <button class="btn-editor success" onclick="saveEconomy()">💾 Salvar Economia</button>
                </div>
            </div>

            <!-- Seção de Inimigos -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('enemies')">
                    <h3>👾 Inimigos</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="enemies">
                    <div class="form-group">
                        <label>Selecionar Inimigo</label>
                        <select id="enemySelect">
                            <option value="goblin">Goblin</option>
                            <option value="orc">Orc</option>
                            <option value="dragon">Dragão</option>
                            <option value="boss">Chefe</option>
                        </select>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <label>Vida</label>
                            <input type="number" id="enemyHealth" value="50" min="1" max="1000">
                        </div>
                        <div class="stat-item">
                            <label>Dano</label>
                            <input type="number" id="enemyDamage" value="15" min="1" max="200">
                        </div>
                        <div class="stat-item">
                            <label>Velocidade</label>
                            <input type="number" id="enemySpeed" value="2" min="1" max="20">
                        </div>
                        <div class="stat-item">
                            <label>Recompensa (Ouro)</label>
                            <input type="number" id="enemyReward" value="25" min="0" max="1000">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Descrição do Inimigo</label>
                        <textarea id="enemyDescription" placeholder="Descreva o inimigo...">Inimigo básico com ataques simples.</textarea>
                    </div>

                    <button class="btn-editor success" onclick="saveEnemy()">💾 Salvar Inimigo</button>
                </div>
            </div>

            <!-- Seção de Missões -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('missions')">
                    <h3>🎯 Missões</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="missions">
                    <div class="form-group">
                        <label>Selecionar Missão</label>
                        <select id="missionSelect">
                            <option value="tutorial">Tutorial Inicial</option>
                            <option value="first_quest">Primeira Missão</option>
                            <option value="custom">Nova Missão</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Nome da Missão</label>
                        <input type="text" id="missionName" value="Tutorial Inicial">
                    </div>

                    <div class="form-group">
                        <label>Descrição da Missão</label>
                        <textarea id="missionDescription" placeholder="Descreva a missão...">Aprenda os controles básicos do jogo.</textarea>
                    </div>

                    <div class="form-group">
                        <label>Dificuldade</label>
                        <select id="missionDifficulty">
                            <option value="Fácil">Fácil</option>
                            <option value="Médio">Médio</option>
                            <option value="Difícil">Difícil</option>
                            <option value="Extremo">Extremo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Recompensas</label>
                        <div class="form-row">
                            <input type="number" id="missionGold" placeholder="Ouro" value="100">
                            <input type="number" id="missionExp" placeholder="EXP" value="50">
                        </div>
                    </div>

                    <button class="btn-editor success" onclick="saveMission()">💾 Salvar Missão</button>
                </div>
            </div>

            <!-- Seção de Configurações Gerais -->
            <div class="editor-section">
                <div class="section-header" onclick="toggleSection('settings')">
                    <h3>⚙️ Configurações Gerais</h3>
                    <span class="section-toggle">▼</span>
                </div>
                <div class="section-content" id="settings">
                    <div class="form-group">
                        <label>Nome do Jogo</label>
                        <input type="text" id="gameName" value="Nova Remains">
                    </div>

                    <div class="form-group">
                        <label>Versão</label>
                        <input type="text" id="gameVersion" value="1.0.0">
                    </div>

                    <div class="form-group">
                        <label>Cor Principal</label>
                        <input type="color" id="primaryColor" value="#3b82f6" class="color-picker">
                    </div>

                    <div class="form-group">
                        <label>Cor Secundária</label>
                        <input type="color" id="secondaryColor" value="#1d4ed8" class="color-picker">
                    </div>

                    <div class="form-group">
                        <label>FPS do Jogo</label>
                        <input type="number" id="gameFPS" value="60" min="30" max="120">
                    </div>

                    <div class="form-group">
                        <label>Dificuldade Global</label>
                        <select id="globalDifficulty">
                            <option value="easy">Fácil</option>
                            <option value="normal" selected>Normal</option>
                            <option value="hard">Difícil</option>
                        </select>
                    </div>

                    <button class="btn-editor success" onclick="saveSettings()">💾 Salvar Configurações</button>
                </div>
            </div>
        </div>

        <div class="editor-actions">
            <button class="btn-editor success" onclick="saveAll()">💾 Salvar Tudo</button>
            <button class="btn-editor secondary" onclick="loadConfig()">📁 Carregar Config</button>
            <button class="btn-editor danger" onclick="resetAll()">🔄 Resetar Tudo</button>
            <button class="btn-editor" onclick="exportConfig()">📤 Exportar</button>
        </div>
    </div>

    <!-- Fundo de Estrelas Global -->
    <div class="global-starfield">
        <canvas class="global-starfield-canvas" id="globalStarfieldCanvas"></canvas>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando Nova Remains...</div>
    </div>
    
    <!-- FPS Counter -->
    <div id="fpsCounter" class="fps-counter" style="display: none;">FPS: 60</div>
    
    <div class="main-container">
        <!-- Janela Centralizada do Jogo -->
        <div class="game-window">
            <!-- Menu Principal -->
            <div id="mainMenu" style="display: block;" role="main" aria-label="Menu Principal do Jogo">
                <div class="menu-content">
                    <div class="menu-section">
                        <button id="startBtn" class="menu-btn primary">🎮 Iniciar Jogo</button>
                        <button id="settingsBtn" class="menu-btn">⚙️ Configurações</button>
                        <button id="aboutBtn" class="menu-btn">ℹ️ Sobre</button>
                    </div>
                </div>
            </div>

            <!-- Interface Moderna Alternativa -->
            <div id="modernInterface" class="modern-interface" style="display: none;">
                <!-- Header do Jogo -->
                <div class="game-header">
                    <h1 class="game-title">NOVA REMAINS</h1>
                    <p class="game-subtitle">Star Hunters • Galactic Warfare • Cosmic Adventure</p>
                </div>

                <!-- Grid de Menu -->
                <div class="menu-grid">
                    <!-- Star Hunters -->
                    <div class="menu-card" onclick="openModal('heroModal')">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #ef4444, #f97316);">
                            ⚔️
                        </div>
                        <h3 class="menu-card-title">Star Hunters</h3>
                        <p class="menu-card-description">Selecione seu caçador de estrelas e prepare-se para a batalha</p>
                    </div>

                    <!-- Galactic Map -->
                    <div class="menu-card" onclick="openModal('missionModal')">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                            🗺️
                        </div>
                        <h3 class="menu-card-title">Galactic Map</h3>
                        <p class="menu-card-description">Explore missões épicas através da galáxia</p>
                    </div>

                    <!-- Arsenal -->
                    <div class="menu-card" onclick="openModal('shopModal')">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            🛒
                        </div>
                        <h3 class="menu-card-title">Arsenal</h3>
                        <p class="menu-card-description">Equipe-se com as melhores armas e equipamentos</p>
                    </div>

                    <!-- Inventory -->
                    <div class="menu-card" onclick="openModal('inventoryModal')">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #a855f7, #7c3aed);">
                            🎒
                        </div>
                        <h3 class="menu-card-title">Inventory</h3>
                        <p class="menu-card-description">Gerencie seus itens e equipamentos</p>
                    </div>

                    <!-- Settings -->
                    <div class="menu-card" onclick="openModal('settingsModal')">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #6b7280, #4b5563);">
                            ⚙️
                        </div>
                        <h3 class="menu-card-title">Settings</h3>
                        <p class="menu-card-description">Configure suas preferências de jogo</p>
                    </div>

                    <!-- Combat Mode -->
                    <div class="menu-card" onclick="startCombat()">
                        <div class="status-indicator"></div>
                        <div class="menu-card-icon" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);">
                            🎯
                        </div>
                        <h3 class="menu-card-title">Combat Mode</h3>
                        <p class="menu-card-description">Entre em combate e teste suas habilidades</p>
                    </div>
                </div>
            </div>
            
            <!-- Container do Jogo com Fundo de Estrelas -->
            <div id="gameContainer" class="game-container" style="display: none; position: relative; width: 100%; height: 100%; margin: 0 auto; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
                <!-- Fundo de Estrelas -->
                <div class="starfield-container">
                    <canvas class="starfield-canvas" id="starfieldCanvas"></canvas>
                </div>
                
                <!-- Aurora Background -->
                <div class="aurora-bg"></div>
                
                <!-- Canvas do Jogo -->
                <canvas id="gameCanvas" 
                        width="1200" 
                        height="600" 
                        style="position: relative; z-index: 3; width: 100%; height: 100%; object-fit: contain;"
                        tabindex="0"
                        aria-label="Jogo Nova Remains">
                </canvas>
            </div>
            
            
            
            <!-- Mapa Mundo -->
            <div id="worldMap" class="submenu" style="display: block;">
            <!-- Fundo de Estrelas para o Mapa -->
            <div class="world-map-starfield">
                <canvas class="world-map-starfield-canvas" id="worldMapStarfieldCanvas"></canvas>
            </div>
            
            <!-- Header com barra horizontal -->
            <div class="world-map-header">
                <button id="backFromWorldMapBtn" class="back-btn">← Voltar</button>
                <div class="world-map-nav">
                    <button id="inventoryFromWorldMapBtn" class="nav-btn" title="Inventário">🎒</button>
                    <button id="shopFromWorldMapBtn" class="nav-btn" title="Loja">🏪</button>
                    <button id="missionsFromWorldMapBtn" class="nav-btn" title="Missões">🎯</button>
                    <button id="characterFromWorldMapBtn" class="nav-btn" title="Heróis">⚔️</button>
                    <button id="skillsFromWorldMapBtn" class="nav-btn" title="Habilidades">⚡</button>
                    <button id="settingsFromWorldMapBtn" class="nav-btn" title="Configurações">⚙️</button>
                </div>
            </div>
            
            <div class="submenu-content">
                <!-- Título sobreposto -->
                <div class="map-title">🗺️ Mapa do Mundo</div>
                
                <!-- Ícones de Missões dentro do canvas do jogo -->
                <div class="mission-icons-container">
                    <div class="mission-icon available" data-mission="tutorial" title="Tutorial Inicial - Aprenda os controles básicos">
                        <div class="mission-icon-symbol">🎓</div>
                        <div class="mission-icon-name">Tutorial</div>
                        <div class="mission-icon-level">Nível 1</div>
                    </div>
                    
                    <div class="mission-icon available" data-mission="sanctuary" title="Santuário das Estrelas - Primeira missão épica">
                        <div class="mission-icon-symbol">🏛️</div>
                        <div class="mission-icon-name">Santuário</div>
                        <div class="mission-icon-level">Nível 1-5</div>
                    </div>
                    
                    <div class="mission-icon locked" data-mission="void" title="Vazio Cósmico - Complete o Santuário primeiro">
                        <div class="mission-icon-symbol">🌌</div>
                        <div class="mission-icon-name">Vazio</div>
                        <div class="mission-icon-level">Nível 6-10</div>
                    </div>
                    
                    <div class="mission-icon locked" data-mission="ruins" title="Ruínas Celestiais - Desbloqueie o Vazio Cósmico">
                        <div class="mission-icon-symbol">🏚️</div>
                        <div class="mission-icon-name">Ruínas</div>
                        <div class="mission-icon-level">Nível 11-15</div>
                    </div>
                    
                    <div class="mission-icon locked" data-mission="temple" title="Templo dos Fragmentos - Desbloqueie as Ruínas">
                        <div class="mission-icon-symbol">⛩️</div>
                        <div class="mission-icon-name">Templo</div>
                        <div class="mission-icon-level">Nível 16-20</div>
                    </div>
                    
                    <div class="mission-icon locked" data-mission="comet" title="Núcleo do Cometa - Missão final épica">
                        <div class="mission-icon-symbol">☄️</div>
                        <div class="mission-icon-name">Cometa</div>
                        <div class="mission-icon-level">Nível 21-25</div>
                    </div>
                </div>
                
                <div class="world-map-modern">
                    <!-- Mapa Principal -->
                    <div class="map-container">
                        <div class="world-map map-background">
                        <div class="map-location location-3d" data-location="sanctuary" style="top: 60%; left: 30%;">
                            <div class="location-icon location-icon-3d">🏛️</div>
                            <div class="location-name location-name-3d">Santuário das Estrelas</div>
                            <div class="location-level" style="background: linear-gradient(135deg, #32CD32, #00FF7F); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-top: 4px;">Nível 1-5</div>
                        </div>
                            <div class="map-location location-3d" data-location="void" style="top: 40%; left: 50%;">
                                <div class="location-icon location-icon-3d">🌌</div>
                                <div class="location-name location-name-3d">Vazio Cósmico</div>
                                <div class="location-level" style="background: linear-gradient(135deg, #DC143C, #FF6347); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-top: 4px;">Nível 6-10</div>
                            </div>
                            <div class="map-location location-3d" data-location="ruins" style="top: 70%; left: 60%;">
                                <div class="location-icon location-icon-3d">🏚️</div>
                                <div class="location-name location-name-3d">Ruínas Celestiais</div>
                                <div class="location-level" style="background: linear-gradient(135deg, #8A2BE2, #4169E1); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-top: 4px;">Nível 11-15</div>
                            </div>
                            <div class="map-location location-3d" data-location="temple" style="top: 20%; left: 70%;">
                                <div class="location-icon location-icon-3d">⛩️</div>
                                <div class="location-name location-name-3d">Templo dos Fragmentos</div>
                                <div class="location-level" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #1a1a2e; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-top: 4px;">Nível 16-20</div>
                            </div>
                            <div class="map-location location-3d" data-location="comet" style="top: 50%; left: 80%;">
                                <div class="location-icon location-icon-3d">☄️</div>
                                <div class="location-name location-name-3d">Núcleo do Cometa</div>
                                <div class="location-level" style="background: linear-gradient(135deg, #FF1493, #FF69B4); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-top: 4px;">Nível 21+</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
            <!-- Submenu de Personagens -->
            <div id="characterMenu" class="submenu" style="display: none;">
            <div class="submenu-header">
                <button id="backFromCharacterBtn" class="back-btn">← Voltar</button>
                <h2>⚔️ Seleção de Herói</h2>
            </div>
            <div class="submenu-content">
                <div class="character-grid">
                <div class="character-card hero-card-3d">
                    <div class="character-preview hero-preview-3d" id="character1" style="background: linear-gradient(135deg, #FFD700, #FFA500, #FF8C00);">
                        <div class="character-sprite-fallback" style="display: flex; align-items: center; justify-content: center; font-size: 48px; width: 100%; height: 100%;">⚔️</div>
                    </div>
                    <h3 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">Juno</h3>
                    <p class="character-description" style="color: #FFA500;">Nobre cavaleira cuja armadura reflete a luz das estrelas. Protetora do grupo com coragem inabalável.</p>
                    <div class="character-stats" style="background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <div class="stat" style="color: #FF6B6B;">❤️ Vida: 120</div>
                        <div class="stat" style="color: #4ECDC4;">⚡ Mana: 60</div>
                        <div class="stat" style="color: #45B7D1;">⚔️ Dano: 30</div>
                        <div class="stat" style="color: #96CEB4;">🏃 Velocidade: 4</div>
                    </div>
                    <div class="character-skills" style="margin: 10px 0;">
                        <span class="skill-tag" style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Corte Devastador</span>
                        <span class="skill-tag" style="background: linear-gradient(135deg, #4ECDC4, #6EDDD6); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Escudo Protetor</span>
                    </div>
                    <button class="select-character btn-3d" data-character="juno">Selecionar</button>
                </div>
                <div class="character-card hero-card-3d">
                    <div class="character-preview hero-preview-3d" id="character2" style="background: linear-gradient(135deg, #87CEEB, #4682B4, #1E90FF);">
                        <div class="character-sprite-fallback" style="display: flex; align-items: center; justify-content: center; font-size: 48px; width: 100%; height: 100%;">🏹</div>
                    </div>
                    <h3 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">Atlas</h3>
                    <p class="character-description" style="color: #87CEEB;">Arqueiro cuja mira é tão precisa quanto a trajetória de um planeta. Flechas que rasgam o céu.</p>
                    <div class="character-stats" style="background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <div class="stat" style="color: #FF6B6B;">❤️ Vida: 80</div>
                        <div class="stat" style="color: #4ECDC4;">⚡ Mana: 100</div>
                        <div class="stat" style="color: #45B7D1;">⚔️ Dano: 25</div>
                        <div class="stat" style="color: #96CEB4;">🏃 Velocidade: 8</div>
                    </div>
                    <div class="character-skills" style="margin: 10px 0;">
                        <span class="skill-tag" style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Flecha Perfurante</span>
                        <span class="skill-tag" style="background: linear-gradient(135deg, #4ECDC4, #6EDDD6); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Chuva de Flechas</span>
                    </div>
                    <button class="select-character btn-3d" data-character="atlas">Selecionar</button>
                </div>
                <div class="character-card hero-card-3d">
                    <div class="character-preview hero-preview-3d" id="character3" style="background: linear-gradient(135deg, #9370DB, #8A2BE2, #4B0082);">
                        <div class="character-sprite-fallback" style="display: flex; align-items: center; justify-content: center; font-size: 48px; width: 100%; height: 100%;">🔮</div>
                    </div>
                    <h3 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">Vega</h3>
                    <p class="character-description" style="color: #9370DB;">Mago sábio e enigmático que manipula a magia cósmica para destruir inimigos e desvendar segredos.</p>
                    <div class="character-stats" style="background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <div class="stat" style="color: #FF6B6B;">❤️ Vida: 70</div>
                        <div class="stat" style="color: #4ECDC4;">⚡ Mana: 150</div>
                        <div class="stat" style="color: #45B7D1;">⚔️ Dano: 35</div>
                        <div class="stat" style="color: #96CEB4;">🏃 Velocidade: 3</div>
                    </div>
                    <div class="character-skills" style="margin: 10px 0;">
                        <span class="skill-tag" style="background: linear-gradient(135deg, #9370DB, #8A2BE2); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Bola de Fogo</span>
                        <span class="skill-tag" style="background: linear-gradient(135deg, #4ECDC4, #6EDDD6); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Escudo Mágico</span>
                    </div>
                    <button class="select-character btn-3d" data-character="vega">Selecionar</button>
                </div>
                <div class="character-card hero-card-3d">
                    <div class="character-preview hero-preview-3d" id="character4" style="background: linear-gradient(135deg, #2F4F4F, #708090, #A9A9A9);">
                        <div class="character-sprite-fallback" style="display: flex; align-items: center; justify-content: center; font-size: 48px; width: 100%; height: 100%;">🥷</div>
                    </div>
                    <h3 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">Kai</h3>
                    <p class="character-description" style="color: #708090;">Ágil ninja caçador furtivo que se move como uma sombra, atacando com a velocidade de um cometa.</p>
                    <div class="character-stats" style="background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <div class="stat" style="color: #FF6B6B;">❤️ Vida: 90</div>
                        <div class="stat" style="color: #4ECDC4;">⚡ Mana: 80</div>
                        <div class="stat" style="color: #45B7D1;">⚔️ Dano: 28</div>
                        <div class="stat" style="color: #96CEB4;">🏃 Velocidade: 9</div>
                    </div>
                    <div class="character-skills" style="margin: 10px 0;">
                        <span class="skill-tag" style="background: linear-gradient(135deg, #2F4F4F, #708090); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Ataque Furtivo</span>
                        <span class="skill-tag" style="background: linear-gradient(135deg, #4ECDC4, #6EDDD6); color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; margin: 2px; display: inline-block;">Teletransporte</span>
                    </div>
                    <button class="select-character btn-3d" data-character="kai">Selecionar</button>
                </div>
                </div>
            </div>
        </div>
        
            <!-- Submenu de Habilidades -->
            <div id="skillsMenu" class="submenu" style="display: none;">
            <div class="submenu-header">
                <button id="backFromSkillsBtn" class="back-btn">← Voltar</button>
                <h2>⚡ Sistema de Habilidades</h2>
                <div class="skill-points-display">
                    <span class="skill-points-icon">⭐</span>
                    <span id="skillPoints">5</span> Pontos
                </div>
            </div>
            <div class="skills-content">
                <div class="skill-tree">
                    <h3>Árvore de Habilidades</h3>
                    <div class="skill-category">
                        <h4>Combate Básico</h4>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Golpe Poderoso</span>
                                <span class="skill-description">Aumenta o dano do ataque básico</span>
                            </div>
                            <button class="skill-btn" data-skill="power_strike" disabled>Nível 1/5</button>
                        </div>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Defesa Aprimorada</span>
                                <span class="skill-description">Reduz dano recebido</span>
                            </div>
                            <button class="skill-btn" data-skill="defense_boost" disabled>Nível 0/5</button>
                        </div>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Velocidade de Ataque</span>
                                <span class="skill-description">Aumenta velocidade de ataque</span>
                            </div>
                            <button class="skill-btn" data-skill="attack_speed" disabled>Nível 0/5</button>
                        </div>
                    </div>
                    <div class="skill-category">
                        <h4>Magia Cósmica</h4>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Bola de Fogo Estelar</span>
                                <span class="skill-description">Projétil de fogo que queima inimigos</span>
                            </div>
                            <button class="skill-btn" data-skill="fireball" disabled>Nível 1/3</button>
                        </div>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Cura Cósmica</span>
                                <span class="skill-description">Restaura vida usando energia estelar</span>
                            </div>
                            <button class="skill-btn" data-skill="heal" disabled>Nível 1/3</button>
                        </div>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Escudo Estelar</span>
                                <span class="skill-description">Cria barreira protetora</span>
                            </div>
                            <button class="skill-btn" data-skill="shield" disabled>Nível 0/3</button>
                        </div>
                    </div>
                    <div class="skill-category">
                        <h4>Habilidades Especiais</h4>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Dash Cósmico</span>
                                <span class="skill-description">Movimento rápido em qualquer direção</span>
                            </div>
                            <button class="skill-btn" data-skill="dash" disabled>Nível 0/2</button>
                        </div>
                        <div class="skill-item">
                            <div class="skill-info">
                                <span class="skill-name">Explosão Estelar</span>
                                <span class="skill-description">Ataque em área com grande dano</span>
                            </div>
                            <button class="skill-btn" data-skill="explosion" disabled>Nível 0/1</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
            <!-- Submenu de Inventário -->
            <div id="inventoryMenu" class="submenu" style="display: none;">
                <!-- Header com navegação -->
                <div class="submenu-header">
                    <button id="backFromInventoryBtn" class="back-btn">← Voltar ao Mapa</button>
                    <h2>🎒 Inventário do Herói</h2>
                    <div class="player-resources">
                        <div class="gold-display">
                            <span class="gold-icon">💰</span>
                            <span id="playerGold">1000</span>
                        </div>
                        <div class="level-display">
                            <span class="level-icon">⭐</span>
                            <span id="playerLevel">Nível 1</span>
                        </div>
                    </div>
                </div>
                
                <div class="submenu-content">
                    <div class="inventory-layout">
                        <!-- Grid de Inventário -->
                        <div class="inventory-section">
                            <h3>🎒 Itens no Inventário</h3>
                            <div class="inventory-grid" id="inventoryGrid">
                                <!-- Slots serão gerados dinamicamente -->
                                <div class="inventory-slot" data-slot="0">
                                    <div class="item-icon">⚔️</div>
                                    <div class="item-name">Espada Básica</div>
                                    <div class="item-quantity">1</div>
                                </div>
                                <div class="inventory-slot" data-slot="1">
                                    <div class="item-icon">🛡️</div>
                                    <div class="item-name">Escudo de Madeira</div>
                                    <div class="item-quantity">1</div>
                                </div>
                                <div class="inventory-slot" data-slot="2">
                                    <div class="item-icon">🧪</div>
                                    <div class="item-name">Poção de Cura</div>
                                    <div class="item-quantity">3</div>
                                </div>
                                <div class="inventory-slot" data-slot="3">
                                    <div class="item-icon">💎</div>
                                    <div class="item-name">Cristal de Poder</div>
                                    <div class="item-quantity">1</div>
                                </div>
                                <!-- Slots vazios -->
                                <div class="inventory-slot empty" data-slot="4"></div>
                                <div class="inventory-slot empty" data-slot="5"></div>
                                <div class="inventory-slot empty" data-slot="6"></div>
                                <div class="inventory-slot empty" data-slot="7"></div>
                                <div class="inventory-slot empty" data-slot="8"></div>
                                <div class="inventory-slot empty" data-slot="9"></div>
                                <div class="inventory-slot empty" data-slot="10"></div>
                                <div class="inventory-slot empty" data-slot="11"></div>
                            </div>
                        </div>
                        
                        <!-- Equipamentos -->
                        <div class="equipment-section">
                            <h3>⚔️ Equipamentos</h3>
                            <div class="equipment-grid">
                                <div class="equipment-slot helmet" data-type="helmet">
                                    <div class="slot-label">Capacete</div>
                                    <div class="equipped-item" id="equippedHelmet">Nenhum</div>
                                </div>
                                <div class="equipment-slot weapon" data-type="weapon">
                                    <div class="slot-label">Arma</div>
                                    <div class="equipped-item" id="equippedWeapon">Espada Básica</div>
                                </div>
                                <div class="equipment-slot armor" data-type="armor">
                                    <div class="slot-label">Armadura</div>
                                    <div class="equipped-item" id="equippedArmor">Túnica Básica</div>
                                </div>
                                <div class="equipment-slot shield" data-type="shield">
                                    <div class="slot-label">Escudo</div>
                                    <div class="equipped-item" id="equippedShield">Escudo de Madeira</div>
                                </div>
                                <div class="equipment-slot accessory1" data-type="accessory1">
                                    <div class="slot-label">Acessório 1</div>
                                    <div class="equipped-item" id="equippedAccessory1">Nenhum</div>
                                </div>
                                <div class="equipment-slot accessory2" data-type="accessory2">
                                    <div class="slot-label">Acessório 2</div>
                                    <div class="equipped-item" id="equippedAccessory2">Nenhum</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detalhes do Item -->
                        <div class="item-details-section">
                            <h3>📋 Detalhes do Item</h3>
                            <div class="item-details" id="itemDetails">
                                <div class="item-preview">
                                    <div class="item-icon-large">⚔️</div>
                                    <div class="item-name-large">Espada Básica</div>
                                    <div class="item-rarity common">Comum</div>
                                </div>
                                <div class="item-stats">
                                    <div class="stat-line">
                                        <span class="stat-name">Dano:</span>
                                        <span class="stat-value">+15</span>
                                    </div>
                                    <div class="stat-line">
                                        <span class="stat-name">Velocidade:</span>
                                        <span class="stat-value">+2</span>
                                    </div>
                                </div>
                                <div class="item-description">
                                    Uma espada simples, mas confiável para iniciantes.
                                </div>
                                <div class="item-actions">
                                    <button class="action-btn equip">Equipar</button>
                                    <button class="action-btn sell">Vender</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- Submenu de Loja -->
            <div id="shopMenu" class="submenu" style="display: none;">
                <div class="submenu-header">
                    <button id="backFromShopBtn" class="back-btn">← Voltar ao Mapa</button>
                    <h2>🏪 Loja do Mercador</h2>
                    <div class="player-resources">
                        <div class="gold-display">
                            <span class="gold-icon">💰</span>
                            <span id="shopPlayerGold">1000</span>
                        </div>
                        <div class="shop-special">
                            <span class="special-icon">⭐</span>
                            <span>Ofertas Especiais!</span>
                        </div>
                    </div>
                </div>
                
                <div class="submenu-content">
                    <div class="shop-layout">
                    <!-- Categorias -->
                    <div class="shop-categories">
                        <h3>🏷️ Categorias</h3>
                        <div class="category-buttons">
                            <button class="category-btn active" data-category="all">
                                <span class="category-icon">🛍️</span>
                                <span>Todos</span>
                            </button>
                            <button class="category-btn" data-category="weapon">
                                <span class="category-icon">⚔️</span>
                                <span>Armas</span>
                            </button>
                            <button class="category-btn" data-category="armor">
                                <span class="category-icon">🛡️</span>
                                <span>Armaduras</span>
                            </button>
                            <button class="category-btn" data-category="consumable">
                                <span class="category-icon">🧪</span>
                                <span>Poções</span>
                            </button>
                            <button class="category-btn" data-category="gem">
                                <span class="category-icon">💎</span>
                                <span>Gemas</span>
                            </button>
                            <button class="category-btn" data-category="special">
                                <span class="category-icon">✨</span>
                                <span>Especiais</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Itens da Loja -->
                    <div class="shop-items-section">
                        <h3>🛒 Itens Disponíveis</h3>
                        <div class="shop-items" id="shopItems">
                            <!-- Armas -->
                            <div class="shop-item" data-category="weapon" data-price="500">
                                <div class="item-icon">⚔️</div>
                                <div class="item-name">Espada de Aço</div>
                                <div class="item-price">💰 500</div>
                                <div class="item-rarity uncommon">Incomum</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <div class="shop-item" data-category="weapon" data-price="800">
                                <div class="item-icon">🗡️</div>
                                <div class="item-name">Espada Flamejante</div>
                                <div class="item-price">💰 800</div>
                                <div class="item-rarity rare">Raro</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <!-- Armaduras -->
                            <div class="shop-item" data-category="armor" data-price="400">
                                <div class="item-icon">🛡️</div>
                                <div class="item-name">Armadura de Couro</div>
                                <div class="item-price">💰 400</div>
                                <div class="item-rarity common">Comum</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <div class="shop-item" data-category="armor" data-price="1200">
                                <div class="item-icon">👑</div>
                                <div class="item-name">Armadura Real</div>
                                <div class="item-price">💰 1200</div>
                                <div class="item-rarity epic">Épico</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <!-- Poções -->
                            <div class="shop-item" data-category="consumable" data-price="50">
                                <div class="item-icon">🧪</div>
                                <div class="item-name">Poção de Cura</div>
                                <div class="item-price">💰 50</div>
                                <div class="item-rarity common">Comum</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <div class="shop-item" data-category="consumable" data-price="100">
                                <div class="item-icon">💙</div>
                                <div class="item-name">Poção de Mana</div>
                                <div class="item-price">💰 100</div>
                                <div class="item-rarity common">Comum</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <!-- Gemas -->
                            <div class="shop-item" data-category="gem" data-price="300">
                                <div class="item-icon">💎</div>
                                <div class="item-name">Cristal de Poder</div>
                                <div class="item-price">💰 300</div>
                                <div class="item-rarity rare">Raro</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                            
                            <!-- Especiais -->
                            <div class="shop-item special-offer" data-category="special" data-price="2000">
                                <div class="item-icon">✨</div>
                                <div class="item-name">Anel da Estrela</div>
                                <div class="item-price">💰 2000</div>
                                <div class="item-rarity legendary">Lendário</div>
                                <div class="special-badge">OFERTA!</div>
                                <button class="buy-btn">Comprar</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalhes do Item -->
                    <div class="shop-details-section">
                        <h3>📋 Informações do Item</h3>
                        <div class="item-details" id="shopItemDetails">
                            <div class="item-preview">
                                <div class="item-icon-large">⚔️</div>
                                <div class="item-name-large">Espada de Aço</div>
                                <div class="item-rarity-large uncommon">Incomum</div>
                            </div>
                            <div class="item-stats">
                                <div class="stat-line">
                                    <span class="stat-name">Dano:</span>
                                    <span class="stat-value">+25</span>
                                </div>
                                <div class="stat-line">
                                    <span class="stat-name">Velocidade:</span>
                                    <span class="stat-value">+3</span>
                                </div>
                                <div class="stat-line">
                                    <span class="stat-name">Crítico:</span>
                                    <span class="stat-value">+5%</span>
                                </div>
                            </div>
                            <div class="item-description">
                                Uma espada forjada com aço de qualidade superior, oferecendo maior dano e precisão.
                            </div>
                            <div class="purchase-actions">
                                <button class="action-btn buy">Comprar por 💰 500</button>
                                <button class="action-btn compare">Comparar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        
            <!-- Submenu de Missões -->
            <div id="missionsMenu" class="submenu" style="display: none;">
                <div class="submenu-header">
                    <button id="backFromMissionsBtn" class="back-btn">← Voltar ao Mapa</button>
                    <h2>🎯 Missões e Aventuras</h2>
                    <div class="player-info">
                        <div class="player-level">
                            <span class="level-icon">⭐</span>
                            <span>Nível 1</span>
                        </div>
                        <div class="player-gold">
                            <span class="gold-icon">💰</span>
                            <span>1000</span>
                        </div>
                        <div class="mission-progress">
                            <span class="progress-icon">📊</span>
                            <span>Progresso: 15%</span>
                        </div>
                    </div>
                </div>
                <div class="submenu-content">
                    <div class="missions-modern">
                    <div class="missions-tabs">
                        <button class="mission-tab active" data-tab="story">📖 História</button>
                        <button class="mission-tab" data-tab="daily">📅 Diárias</button>
                        <button class="mission-tab" data-tab="weekly">📆 Semanais</button>
                        <button class="mission-tab" data-tab="events">🎉 Eventos</button>
                    </div>
                    <div class="missions-map">
                        <div class="location-section">
                            <h3>🌌 Santuário das Estrelas</h3>
                            <div class="missions-grid">
                                <div class="mission-card" data-mission="tutorial">
                                    <div class="mission-icon" style="background: linear-gradient(135deg, #FFD700, #FFA500);">⭐</div>
                                    <div class="mission-info">
                                        <h4>Tutorial Inicial</h4>
                                        <p>Aprenda os controles básicos do jogo</p>
                                        <div class="mission-details">
                                            <span>Nível 1</span>
                                            <span>Fácil</span>
                                        </div>
                                        <div class="mission-rewards">
                                            <span>💰 100</span>
                                            <span>⭐ 50 EXP</span>
                                        </div>
                                        <button class="mission-select-btn" data-mission="tutorial">Iniciar</button>
                                    </div>
                                </div>
                                <div class="mission-card" data-mission="first_quest">
                                    <div class="mission-icon" style="background: linear-gradient(135deg, #87CEEB, #4682B4);">🔍</div>
                                    <div class="mission-info">
                                        <h4>Primeira Busca</h4>
                                        <p>Encontre Fragmentos de Estrela perdidos</p>
                                        <div class="mission-details">
                                            <span>Nível 1-3</span>
                                            <span>Fácil</span>
                                        </div>
                                        <div class="mission-rewards">
                                            <span>💰 200</span>
                                            <span>⭐ 100 EXP</span>
                                        </div>
                                        <button class="mission-select-btn" data-mission="first_quest">Iniciar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="location-section">
                            <h3>🌌 Vazio Cósmico</h3>
                            <div class="missions-grid">
                                <div class="mission-card" data-mission="void_exploration">
                                    <div class="mission-icon" style="background: linear-gradient(135deg, #9370DB, #8A2BE2);">🌌</div>
                                    <div class="mission-info">
                                        <h4>Exploração do Vazio</h4>
                                        <p>Derrote Filhos do Vazio e colete fragmentos</p>
                                        <div class="mission-details">
                                            <span>Nível 3-5</span>
                                            <span>Médio</span>
                                        </div>
                                        <div class="mission-rewards">
                                            <span>💰 500</span>
                                            <span>⭐ 250 EXP</span>
                                        </div>
                                        <button class="mission-select-btn" data-mission="void_exploration">Iniciar</button>
                                    </div>
                                </div>
                                <div class="mission-card" data-mission="void_boss">
                                    <div class="mission-icon" style="background: linear-gradient(135deg, #2F4F4F, #708090);">👹</div>
                                    <div class="mission-info">
                                        <h4>Chefe do Vazio</h4>
                                        <p>Enfrente o Guardião das Sombras</p>
                                        <div class="mission-details">
                                            <span>Nível 5-7</span>
                                            <span>Difícil</span>
                                        </div>
                                        <div class="mission-rewards">
                                            <span>💰 1000</span>
                                            <span>⭐ 500 EXP</span>
                                            <span>🏆 Item Raro</span>
                                        </div>
                                        <button class="mission-select-btn" data-mission="void_boss">Iniciar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Sistema de Combate de Missão -->
                <div id="missionGameContainer" style="display: none;">
                    <div class="mission-game-header" style="background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9)); padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #444444;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="color: #FFD700; margin-bottom: 10px;">🎮 Missão em Andamento</h3>
                                <div style="display: flex; gap: 20px;">
                                    <div class="bar-container" style="width: 150px; height: 15px; background-color: #4a5568; border: 2px solid #a0aec0; border-radius: 5px;">
                                        <div id="player-health-bar" class="health-bar" style="height: 100%; background-color: #48bb78; transition: width 0.2s linear;"></div>
                                    </div>
                                    <div class="bar-container" style="width: 150px; height: 15px; background-color: #4a5568; border: 2px solid #a0aec0; border-radius: 5px;">
                                        <div id="player-mana-bar" class="mana-bar" style="height: 100%; background-color: #63b3ed; transition: width 0.2s linear;"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="mission-status" style="color: #FFD700; font-size: 18px; font-weight: bold;">
                                Pressione "Iniciar" para começar
                            </div>
                            <div style="text-align: right;">
                                <h4 style="color: #87CEEB; margin-bottom: 5px;">Controles</h4>
                                <p style="font-size: 12px; color: #87CEEB;">← →: Mover | ↑: Pular | ↓: Descer Plataforma</p>
                                <p style="font-size: 12px; color: #87CEEB;">Z: Atacar | Z (Segurar): Carregar Habilidade</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mundo do Jogo -->
                    <div id="game-world" style="background: linear-gradient(135deg, #2d3748, #4a5568); width: 100%; height: 400px; border: 4px solid #718096; position: relative; overflow: hidden; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);">
                        <div id="player" class="player" style="background-color: #4299e1; position: absolute; border: 2px solid #2b6cb0; border-radius: 4px; box-shadow: 0 0 10px #4299e1; transition: opacity 0.2s;"></div>
                    </div>
                    
                    <!-- Tela de Fim de Jogo/Vitória -->
                    <div id="game-over-screen" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.75); flex-direction: column; align-items: center; justify-content: center; z-index: 1000;">
                        <h1 id="end-game-title" style="font-size: 3rem; font-weight: bold; margin-bottom: 1rem; color: #FFD700;">Game Over</h1>
                        <p id="end-game-subtitle" style="font-size: 1.25rem; margin-bottom: 2rem; color: #87CEEB;">Tente novamente!</p>
                        <button id="restart-button" class="btn-3d" style="padding: 1rem 2rem; font-size: 1.25rem;">Reiniciar Missão</button>
                    </div>
                    
                    <!-- Tela Inicial da Missão -->
                    <div id="start-screen" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.75); flex-direction: column; align-items: center; justify-content: center; z-index: 1000;">
                        <h1 style="font-size: 3rem; font-weight: bold; margin-bottom: 1rem; color: #FFD700;">Missão Selecionada</h1>
                        <p id="mission-description" style="font-size: 1.25rem; margin-bottom: 2rem; color: #87CEEB;">Derrote todos os inimigos para vencer!</p>
                        <button id="start-button" class="btn-3d" style="padding: 1rem 2rem; font-size: 1.25rem;">Iniciar Missão</button>
                        <button id="back-to-missions" class="btn-3d" style="padding: 0.5rem 1rem; font-size: 1rem; margin-top: 1rem;">Voltar às Missões</button>
                    </div>
                </div>
                
                <div id="roomsContainer" style="display: none;">
                    <!-- Lista de salas será gerada dinamicamente -->
                </div>
                <div id="createRoomContainer" style="display: none;">
                    <!-- Formulário de criação de sala será gerado dinamicamente -->
                </div>
                <div id="roomLobbyContainer" style="display: none;">
                    <!-- Lobby da sala será gerado dinamicamente -->
                </div>
            </div>
            </div>
        
            <!-- Submenu de Controles -->
            <div id="controlsMenu" class="submenu" style="display: none;">
                <div class="submenu-header">
                    <button id="backFromControlsBtn" class="back-btn">← Voltar</button>
                    <h2>🎮 Controles</h2>
                </div>
                <div class="controls-content">
                    <div class="control-section">
                    <h3>Movimento</h3>
                    <div class="control-item">
                        <span>⬅️ Seta Esquerda</span>
                        <span>Mover para a esquerda</span>
                    </div>
                    <div class="control-item">
                        <span>➡️ Seta Direita</span>
                        <span>Mover para a direita</span>
                    </div>
                    <div class="control-item">
                        <span>⬆️ Seta para Cima</span>
                        <span>Pular</span>
                    </div>
                    <div class="control-item">
                        <span>⬇️ Seta para Baixo</span>
                        <span>Agachar</span>
                    </div>
                </div>
                <div class="control-section">
                    <h3>Combate</h3>
                    <div class="control-item">
                        <span>Z</span>
                        <span>Atacar</span>
                    </div>
                    <div class="control-item">
                        <span>X</span>
                        <span>Defender</span>
                    </div>
                    <div class="control-item">
                        <span>C</span>
                        <span>Agarrar/Arremessar</span>
                    </div>
                </div>
                <div class="control-section">
                    <h3>Habilidades</h3>
                    <div class="control-item">
                        <span>K</span>
                        <span>Bola de Fogo</span>
                    </div>
                    <div class="control-item">
                        <span>L</span>
                        <span>Curar</span>
                    </div>
                </div>
            </div>
            </div>
        
            <!-- Submenu Sobre -->
            <div id="aboutMenu" class="submenu" style="display: none;">
                <div class="submenu-header">
                    <button id="backFromAboutBtn" class="back-btn">← Voltar</button>
                    <h2>ℹ️ Sobre o Jogo</h2>
                </div>
                <div class="about-content">
                    <div class="game-info">
                    <h3>Grand Chase Web</h3>
                    <p>Versão: 1.0.0</p>
                    <p>Desenvolvido com HTML5, CSS3 e JavaScript</p>
                </div>
                <div class="game-description">
                    <h4>Descrição</h4>
                    <p>Um jogo de ação 2D inspirado no clássico Grand Chase. Explore dungeons, derrote inimigos e evolua seu personagem em uma aventura épica!</p>
                </div>
                <div class="features">
                    <h4>Características</h4>
                    <ul>
                        <li>✅ Sistema de combate dinâmico</li>
                        <li>✅ Múltiplos personagens</li>
                        <li>✅ Sistema de habilidades</li>
                        <li>✅ Inventário de itens</li>
                        <li>✅ Efeitos visuais</li>
                        <li>✅ Sistema de progressão</li>
                    </ul>
                </div>
            </div>
            </div>
        
            <!-- Menu de Pausa -->
            <div id="pauseMenu" style="display: none;">
            <h2>Jogo Pausado</h2>
            <button id="resumeBtn">Continuar</button>
            <button id="restartBtn">Reiniciar</button>
            <button id="mainMenuBtn">Menu Principal</button>
            <button id="settingsBtn2">Configurações</button>
        </div>
        
            <!-- Menu de Configurações -->
            <div id="settingsMenu" class="submenu" style="display: none;">
                <div class="submenu-header">
                    <button id="backFromSettingsBtn" class="back-btn">← Voltar</button>
                    <h2>⚙️ Configurações</h2>
                </div>
                <div class="settings-content">
                    <div class="settings-section">
                    <h3>🔊 Áudio</h3>
                    <div class="setting-item">
                        <label>Volume Geral:</label>
                        <div class="setting-control">
                            <input type="range" id="masterVolume" min="0" max="100" value="50">
                            <span id="masterVolumeValue">50%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Volume de Efeitos:</label>
                        <div class="setting-control">
                            <input type="range" id="sfxVolume" min="0" max="100" value="50">
                            <span id="sfxVolumeValue">50%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Volume de Música:</label>
                        <div class="setting-control">
                            <input type="range" id="musicVolume" min="0" max="100" value="50">
                            <span id="musicVolumeValue">50%</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>🎮 Controles</h3>
                    <div class="setting-item">
                        <label>Inverter Eixo Y:</label>
                        <div class="setting-control">
                            <input type="checkbox" id="invertY">
                            <span>Desabilitado</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Sensibilidade do Mouse:</label>
                        <div class="setting-control">
                            <input type="range" id="mouseSensitivity" min="1" max="10" value="5">
                            <span id="mouseSensitivityValue">5</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>🎨 Gráficos</h3>
                    <div class="setting-item">
                        <label>Qualidade dos Gráficos:</label>
                        <div class="setting-control">
                            <select id="graphicsQuality">
                                <option value="low">Baixa</option>
                                <option value="medium" selected>Média</option>
                                <option value="high">Alta</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Efeitos de Partículas:</label>
                        <div class="setting-control">
                            <input type="checkbox" id="particleEffects" checked>
                            <span>Habilitado</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>FPS Máximo:</label>
                        <div class="setting-control">
                            <select id="maxFPS">
                                <option value="30">30 FPS</option>
                                <option value="60" selected>60 FPS</option>
                                <option value="120">120 FPS</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>🎯 Jogabilidade</h3>
                    <div class="setting-item">
                        <label>Dificuldade:</label>
                        <div class="setting-control">
                            <select id="difficulty">
                                <option value="easy">Fácil</option>
                                <option value="normal" selected>Normal</option>
                                <option value="hard">Difícil</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label>Auto-save:</label>
                        <div class="setting-control">
                            <input type="checkbox" id="autoSave" checked>
                            <span>Habilitado</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="resetSettingsBtn" class="settings-btn reset">🔄 Resetar</button>
                    <button id="saveSettingsBtn" class="settings-btn save">💾 Salvar</button>
                </div>
                </div>
            </div>
        </div>
        
    <!-- Scripts otimizados com carregamento assíncrono -->
    <script src="js/shop-system.js"></script>
    <script src="js/inventory-system.js"></script>
    <script src="js/mission-system.js"></script>
    <script src="js/lobby-system.js"></script>
            <script src="js/level-design-system.js"></script>
    <script src="js/overlay-system.js"></script>
    <script src="js/map-assets-system.js"></script>
    <script src="js/enhanced-platform-system.js"></script>
    <script src="js/enhanced-physics-system.js"></script>
    
    <script>
        // Método initializeUI que estava faltando
        function initializeUI() {
            // Inicializar elementos de UI se necessário
            const healthBar = document.getElementById('healthFill');
            const manaBar = document.getElementById('manaFill');
            const levelValue = document.getElementById('levelValue');
            const expValue = document.getElementById('expValue');
            
            if (healthBar) healthBar.style.width = '100%';
            if (manaBar) manaBar.style.width = '100%';
            if (levelValue) levelValue.textContent = '1';
            if (expValue) expValue.textContent = '0/100';
        }
        
        // Sistema de carregamento otimizado
        class GameLoader {
            constructor() {
                this.scripts = [
                    'js/sprite-manager.js',
                    'js/particles.js',
                    'js/enemy.js',
                    'js/player.js',
                    'js/combat-simple.js',
                    'js/ui.js',
                    'js/game.js',
                    'js/main.js'
                ];
                this.loadedCount = 0;
                this.startTime = performance.now();
            }
            
            async loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.async = true;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            async loadAllScripts() {
                try {
                    for (const script of this.scripts) {
                        await this.loadScript(script);
                        this.loadedCount++;
                        this.updateProgress();
                    }
                    this.onComplete();
                } catch (error) {
                    console.error('Erro ao carregar scripts:', error);
                    this.onError(error);
                }
            }
            
            updateProgress() {
                const progress = (this.loadedCount / this.scripts.length) * 100;
                const loadingText = document.querySelector('.loading-text');
                if (loadingText) {
                    loadingText.textContent = `Carregando... ${Math.round(progress)}%`;
                }
            }
            
            onComplete() {
                const loadTime = performance.now() - this.startTime;
                console.log(`🎮 Grand Chase Web carregado em ${loadTime.toFixed(2)}ms`);
                
                // Patch para corrigir método initializeUI
                if (window.Game && !window.Game.prototype.initializeUI) {
                    window.Game.prototype.initializeUI = initializeUI;
                }
                
                // Esconder loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
                
                // Mostrar FPS counter em modo debug
                if (window.location.search.includes('debug=true')) {
                    document.getElementById('fpsCounter').style.display = 'block';
                }
            }
            
            onError(error) {
                const loadingText = document.querySelector('.loading-text');
                if (loadingText) {
                    loadingText.textContent = 'Erro ao carregar o jogo. Recarregue a página.';
                    loadingText.style.color = '#ff6b6b';
                }
            }
        }
        
        // Sistema de fallback para classes
        function ensureClassesLoaded() {
            const requiredClasses = ['Game', 'Player', 'Enemy', 'Particle', 'Projectile'];
            const missingClasses = requiredClasses.filter(cls => typeof window[cls] === 'undefined');
            
            if (missingClasses.length > 0) {
                console.warn('⚠️ Classes faltando:', missingClasses);
                // Tentar recarregar as classes faltantes
                return false;
            }
            return true;
        }
        
        // Inicializar carregamento
        const loader = new GameLoader();
        loader.loadAllScripts();
        
        // Gerenciar carregamento de imagens dos heróis
        function setupHeroImageFallbacks() {
            const heroImages = ['juno', 'atlas', 'vega', 'kai'];
            
            heroImages.forEach(hero => {
                const img = document.getElementById(`${hero}-preview`);
                const fallback = img.nextElementSibling;
                
                if (img) {
                    img.onerror = () => {
                        console.warn(`⚠️ Erro ao carregar imagem do ${hero}, usando fallback`);
                        img.style.display = 'none';
                        if (fallback) fallback.style.display = 'block';
                    };
                    
                    img.onload = () => {
                        console.log(`✅ Imagem do ${hero} carregada com sucesso`);
                        if (fallback) fallback.style.display = 'none';
                    };
                }
            });
        }
        
        // Configurar fallbacks quando a página carregar
        document.addEventListener('DOMContentLoaded', setupHeroImageFallbacks);
        
        // Verificação adicional após carregamento
        setTimeout(() => {
            if (!ensureClassesLoaded()) {
                console.log('🔄 Tentando recarregar classes faltantes...');
                // Recarregar página se necessário
                if (window.location.search.includes('auto-reload=true')) {
                    window.location.reload();
                }
            }
        }, 1000);
        
        // Sistema de performance monitoring
        class PerformanceMonitor {
            constructor() {
                this.fps = 0;
                this.frameCount = 0;
                this.lastTime = performance.now();
                this.fpsElement = document.getElementById('fpsCounter');
            }
            
            update() {
                this.frameCount++;
                const currentTime = performance.now();
                
                if (currentTime - this.lastTime >= 1000) {
                    this.fps = Math.round((this.frameCount * 1000) / (currentTime - this.lastTime));
                    this.frameCount = 0;
                    this.lastTime = currentTime;
                    
                    if (this.fpsElement && this.fpsElement.style.display !== 'none') {
                        this.fpsElement.textContent = `FPS: ${this.fps}`;
                        this.fpsElement.style.color = this.fps >= 55 ? '#00ff00' : this.fps >= 30 ? '#ffaa00' : '#ff0000';
                    }
                }
            }
        }
        
        // Inicializar monitor de performance
        const perfMonitor = new PerformanceMonitor();
        
        // Hook no game loop para monitoramento
        const originalRequestAnimationFrame = window.requestAnimationFrame;
        window.requestAnimationFrame = function(callback) {
            return originalRequestAnimationFrame(function(time) {
                perfMonitor.update();
                callback(time);
            });
        };
        
        // Prevenção de context menu no canvas
        document.addEventListener('contextmenu', (e) => {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        });
        
        // Prevenção de drag no canvas
        document.addEventListener('dragstart', (e) => {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        });
        
        // Sistema de debug melhorado
        window.debugGame = function() {
            console.log('🎮 Debug Info:');
            console.log('- Game State:', window.game?.gameState);
            console.log('- Player:', window.game?.player);
            console.log('- Enemies:', window.game?.enemies?.length);
            console.log('- Particles:', window.game?.particles?.length);
            console.log('- Performance:', perfMonitor.fps + ' FPS');
            console.log('- Classes carregadas:');
            console.log('  - Game:', typeof window.Game);
            console.log('  - Player:', typeof window.Player);
            console.log('  - Enemy:', typeof window.Enemy);
            console.log('  - Particle:', typeof window.Particle);
            console.log('  - Projectile:', typeof window.Projectile);
            console.log('  - SpriteManager:', typeof window.SpriteManager);
            console.log('  - CombatSystem:', typeof window.CombatSystem);
            console.log('  - UIManager:', typeof window.UIManager);
        };
        
        // Função para forçar recarregamento
        window.reloadGame = function() {
            console.log('🔄 Recarregando jogo...');
            window.location.reload();
        };
        
        // Função para verificar status
        window.checkStatus = function() {
            const status = {
                classes: {
                    Game: typeof window.Game,
                    Player: typeof window.Player,
                    Enemy: typeof window.Enemy,
                    Particle: typeof window.Particle,
                    Projectile: typeof window.Projectile
                },
                game: {
                    exists: !!window.game,
                    state: window.game?.gameState,
                    player: !!window.game?.player
                },
                performance: {
                    fps: perfMonitor.fps,
                    loadTime: performance.now() - loader.startTime
                }
            };
            console.table(status);
            return status;
        };
        
        // Atalhos de teclado para debug
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey) {
                switch(e.key) {
                    case 'D':
                        e.preventDefault();
                        window.debugGame();
                        break;
                    case 'F':
                        e.preventDefault();
                        const fpsCounter = document.getElementById('fpsCounter');
                        fpsCounter.style.display = fpsCounter.style.display === 'none' ? 'block' : 'none';
                        break;
                    case 'S':
                        e.preventDefault();
                        window.checkStatus();
                        break;
                    case 'R':
                        e.preventDefault();
                        window.reloadGame();
                        break;
                }
            }
        });
        
        // Instruções de debug no console
        console.log('🔧 Comandos de debug disponíveis:');
        console.log('  - debugGame() - Mostrar estado do jogo');
        console.log('  - checkStatus() - Verificar status das classes');
        console.log('  - reloadGame() - Recarregar o jogo');
        console.log('  - Ctrl+Shift+D - Debug rápido');
        console.log('  - Ctrl+Shift+F - Toggle FPS counter');
        console.log('  - Ctrl+Shift+S - Status das classes');
        console.log('  - Ctrl+Shift+R - Recarregar jogo');
    </script>

    <!-- Sistema de Missões Funcional -->
    <script>
        // Verificar se MissionSystem já existe antes de declarar
        if (typeof MissionSystem === 'undefined') {
            // Sistema de Missões
            class MissionSystem {
                constructor() {
                    this.currentMission = null;
                    this.missionProgress = {};
                    this.missionObjectives = {};
                    this.missionRewards = {};
                    this.completedMissions = [];
                    this.activeObjectives = [];
                    
                    this.initializeMissions();
                    this.setupMissionEventListeners();
                }

                initializeMissions() {
                    // Missão Tutorial Completa
                    this.missionData = {
                        tutorial: {
                            id: 'tutorial',
                            name: 'Tutorial Inicial',
                            description: 'Aprenda os controles básicos e mecânicas do jogo',
                            difficulty: 'Fácil',
                            level: 1,
                            objectives: [
                                { id: 'move_tutorial', text: 'Mova-se com WASD ou setas', completed: false, type: 'movement' },
                                { id: 'jump_tutorial', text: 'Pule com ESPAÇO', completed: false, type: 'jump' },
                                { id: 'attack_tutorial', text: 'Ataque com CLIQUE ESQUERDO', completed: false, type: 'attack' },
                                { id: 'skill_tutorial', text: 'Use habilidade com CLIQUE DIREITO', completed: false, type: 'skill' },
                                { id: 'defeat_enemy', text: 'Derrote 3 inimigos', completed: false, type: 'combat', target: 3, current: 0 }
                            ],
                            rewards: {
                                gold: 100,
                                exp: 50,
                                items: ['health_potion']
                            },
                            status: 'available' // available, active, completed
                        },
                        first_quest: {
                            id: 'first_quest',
                            name: 'Primeira Missão',
                            description: 'Explore o Santuário das Estrelas e colete cristais de energia',
                            difficulty: 'Fácil',
                            level: 2,
                            objectives: [
                                { id: 'explore_area', text: 'Explore 5 áreas diferentes', completed: false, type: 'exploration', target: 5, current: 0 },
                                { id: 'collect_crystals', text: 'Colete 10 cristais de energia', completed: false, type: 'collection', target: 10, current: 0 },
                                { id: 'defeat_goblins', text: 'Derrote 5 goblins', completed: false, type: 'combat', target: 5, current: 0 }
                            ],
                            rewards: {
                                gold: 250,
                                exp: 100,
                                items: ['energy_crystal', 'health_potion']
                            },
                            status: 'locked' // locked, available, active, completed
                        }
                    };
                }

                setupMissionEventListeners() {
                    // Event listeners para botões de missão
                    document.addEventListener('click', (e) => {
                        if (e.target.classList.contains('mission-select-btn')) {
                            const missionId = e.target.getAttribute('data-mission');
                            this.startMission(missionId);
                        }
                    });

                    // Event listeners para progresso da missão
                    document.addEventListener('keydown', (e) => {
                        this.handleMissionProgress(e);
                    });

                    // Event listeners para combate
                    document.addEventListener('enemyDefeated', (e) => {
                        this.updateCombatProgress(e.detail.enemyType);
                    });

                    // Event listeners para coleta de itens
                    document.addEventListener('itemCollected', (e) => {
                        this.updateCollectionProgress(e.detail.itemType);
                    });
                }

                startMission(missionId) {
                    if (!this.missionData[missionId]) return;

                    const mission = this.missionData[missionId];
                    
                    if (mission.status === 'locked') {
                        this.showMessage('Missão bloqueada! Complete a missão anterior primeiro.', 'warning');
                        return;
                    }

                    if (mission.status === 'completed') {
                        this.showMessage('Missão já completada!', 'info');
                        return;
                    }

                    // Iniciar missão
                    this.currentMission = mission;
                    mission.status = 'active';
                    this.activeObjectives = [...mission.objectives];
                    
                    // Mostrar interface de missão
                    this.showMissionInterface();
                    
                    // Iniciar jogo se não estiver rodando
                    if (typeof game !== 'undefined' && game.state === 'menu') {
                        game.startGame();
                    }

                    this.showMessage(`Missão iniciada: ${mission.name}`, 'success');
                    this.updateMissionUI();
                }

                showMissionInterface() {
                    // Criar interface de missão se não existir
                    let missionUI = document.getElementById('missionUI');
                    if (!missionUI) {
                        missionUI = document.createElement('div');
                        missionUI.id = 'missionUI';
                        missionUI.className = 'mission-ui';
                        missionUI.innerHTML = `
                            <div class="mission-header">
                                <h3 id="missionTitle">Missão Ativa</h3>
                                <button id="closeMissionBtn" class="close-mission-btn">×</button>
                            </div>
                            <div class="mission-objectives" id="missionObjectives">
                                <!-- Objetivos serão inseridos aqui -->
                            </div>
                            <div class="mission-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="missionProgressBar"></div>
                                </div>
                                <span id="missionProgressText">0%</span>
                            </div>
                        `;
                        document.body.appendChild(missionUI);

                        // Event listener para fechar
                        document.getElementById('closeMissionBtn').addEventListener('click', () => {
                            this.hideMissionInterface();
                        });
                    }

                    this.updateMissionInterface();
                }

                updateMissionInterface() {
                    if (!this.currentMission) return;

                    const title = document.getElementById('missionTitle');
                    const objectives = document.getElementById('missionObjectives');
                    const progressBar = document.getElementById('missionProgressBar');
                    const progressText = document.getElementById('missionProgressText');

                    if (title) title.textContent = this.currentMission.name;
                    
                    if (objectives) {
                        objectives.innerHTML = this.activeObjectives.map(obj => `
                            <div class="objective-item ${obj.completed ? 'completed' : ''}">
                                <span class="objective-icon">${obj.completed ? '✓' : '○'}</span>
                                <span class="objective-text">${obj.text}</span>
                                ${obj.target ? `<span class="objective-progress">${obj.current}/${obj.target}</span>` : ''}
                            </div>
                        `).join('');
                    }

                    // Atualizar progresso
                    const completedCount = this.activeObjectives.filter(obj => obj.completed).length;
                    const totalCount = this.activeObjectives.length;
                    const progress = (completedCount / totalCount) * 100;

                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    if (progressText) {
                        progressText.textContent = `${Math.round(progress)}%`;
                    }
                }

                hideMissionInterface() {
                    const missionUI = document.getElementById('missionUI');
                    if (missionUI) {
                        missionUI.style.display = 'none';
                    }
                }

                handleMissionProgress(event) {
                    if (!this.currentMission) return;

                    const key = event.key.toLowerCase();
                    
                    // Verificar objetivos de movimento
                    if (['w', 'a', 's', 'd', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(key)) {
                        this.completeObjective('move_tutorial');
                    }
                    
                    // Verificar objetivo de pulo
                    if (key === ' ') {
                        this.completeObjective('jump_tutorial');
                    }
                    
                    // Verificar objetivo de ataque
                    if (event.button === 0) { // Clique esquerdo
                        this.completeObjective('attack_tutorial');
                    }
                    
                    // Verificar objetivo de habilidade
                    if (event.button === 2) { // Clique direito
                        this.completeObjective('skill_tutorial');
                    }
                }

                completeObjective(objectiveId) {
                    const objective = this.activeObjectives.find(obj => obj.id === objectiveId);
                    if (objective && !objective.completed) {
                        objective.completed = true;
                        this.updateMissionInterface();
                        this.checkMissionCompletion();
                    }
                }

                updateCombatProgress(enemyType) {
                    if (!this.currentMission) return;

                    // Atualizar objetivos de combate
                    this.activeObjectives.forEach(obj => {
                        if (obj.type === 'combat' && !obj.completed) {
                            obj.current = (obj.current || 0) + 1;
                            if (obj.current >= obj.target) {
                                obj.completed = true;
                            }
                        }
                    });

                    this.updateMissionInterface();
                    this.checkMissionCompletion();
                }

                updateCollectionProgress(itemType) {
                    if (!this.currentMission) return;

                    // Atualizar objetivos de coleta
                    this.activeObjectives.forEach(obj => {
                        if (obj.type === 'collection' && !obj.completed) {
                            obj.current = (obj.current || 0) + 1;
                            if (obj.current >= obj.target) {
                                obj.completed = true;
                            }
                        }
                    });

                    this.updateMissionInterface();
                    this.checkMissionCompletion();
                }

                checkMissionCompletion() {
                    if (!this.currentMission) return;

                    const allCompleted = this.activeObjectives.every(obj => obj.completed);
                    
                    if (allCompleted) {
                        this.completeMission();
                    }
                }

                completeMission() {
                    if (!this.currentMission) return;

                    // Marcar missão como completada
                    this.currentMission.status = 'completed';
                    this.completedMissions.push(this.currentMission.id);
                    
                    // Dar recompensas
                    this.giveRewards(this.currentMission.rewards);
                    
                    // Mostrar mensagem de conclusão
                    this.showMessage(`Missão completada: ${this.currentMission.name}`, 'success');
                    
                    // Desbloquear próxima missão
                    this.unlockNextMission();
                    
                    // Esconder interface de missão
                    this.hideMissionInterface();
                    
                    // Limpar missão atual
                    this.currentMission = null;
                    this.activeObjectives = [];
                    
                    this.updateMissionUI();
                }

                giveRewards(rewards) {
                    // Implementar sistema de recompensas
                    if (rewards.gold) {
                        // Adicionar ouro ao jogador
                        console.log(`Recompensa: ${rewards.gold} ouro`);
                    }
                    
                    if (rewards.exp) {
                        // Adicionar experiência
                        console.log(`Recompensa: ${rewards.exp} EXP`);
                    }
                    
                    if (rewards.items) {
                        // Adicionar itens ao inventário
                        console.log(`Recompensas: ${rewards.items.join(', ')}`);
                    }
                }

                unlockNextMission() {
                    // Desbloquear próxima missão na sequência
                    if (this.missionData.first_quest.status === 'locked') {
                        this.missionData.first_quest.status = 'available';
                    }
                }

                updateMissionUI() {
                    // Atualizar interface de missões
                    const missionCards = document.querySelectorAll('.mission-card');
                    missionCards.forEach(card => {
                        const missionId = card.getAttribute('data-mission');
                        const mission = this.missionData[missionId];
                        
                        if (mission) {
                            const btn = card.querySelector('.mission-select-btn');
                            if (mission.status === 'locked') {
                                btn.textContent = 'Bloqueada';
                                btn.disabled = true;
                                btn.classList.add('disabled');
                            } else if (mission.status === 'completed') {
                                btn.textContent = 'Completada';
                                btn.disabled = true;
                                btn.classList.add('completed');
                            } else if (mission.status === 'active') {
                                btn.textContent = 'Em Andamento';
                                btn.disabled = true;
                                btn.classList.add('active');
                            } else {
                                btn.textContent = 'Iniciar';
                                btn.disabled = false;
                                btn.classList.remove('disabled', 'completed', 'active');
                            }
                        }
                    });
                }

                showMessage(text, type = 'info') {
                    // Criar notificação
                    const notification = document.createElement('div');
                    notification.className = `mission-notification ${type}`;
                    notification.textContent = text;
                    
                    document.body.appendChild(notification);
                    
                    // Remover após 3 segundos
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 3000);
                }
            }
        }

        // Inicializar sistema de missões apenas se não existir
        if (typeof missionSystem === 'undefined') {
            const missionSystem = new MissionSystem();
        }

            // Sistema de Editor de Jogo
            class GameEditor {
                constructor() {
                    this.isOpen = false;
                    this.gameData = this.loadGameData();
                    this.setupEventListeners();
                }

                setupEventListeners() {
                    // Toggle do editor
                    document.getElementById('editorToggle').addEventListener('click', () => {
                        this.toggleEditor();
                    });

                    // Carregar dados quando selecionar personagem
                    document.getElementById('characterSelect').addEventListener('change', (e) => {
                        this.loadCharacterData(e.target.value);
                    });

                    // Carregar dados quando selecionar inimigo
                    document.getElementById('enemySelect').addEventListener('change', (e) => {
                        this.loadEnemyData(e.target.value);
                    });

                    // Carregar dados quando selecionar missão
                    document.getElementById('missionSelect').addEventListener('change', (e) => {
                        this.loadMissionData(e.target.value);
                    });
                }

                toggleEditor() {
                    this.isOpen = !this.isOpen;
                    const editor = document.getElementById('gameEditor');
                    const body = document.body;
                    
                    if (this.isOpen) {
                        editor.classList.add('open');
                        body.classList.add('editor-open');
                    } else {
                        editor.classList.remove('open');
                        body.classList.remove('editor-open');
                    }
                }

                loadGameData() {
                    // Carregar dados salvos ou usar padrões
                    const defaultData = {
                        characters: {
                            juno: { health: 100, damage: 25, speed: 5, defense: 10, description: 'Caçadora de estrelas experiente', special: 'Ataque Estelar' },
                            atlas: { health: 120, damage: 20, speed: 4, defense: 15, description: 'Guardião cósmico poderoso', special: 'Escudo Cósmico' },
                            vega: { health: 80, damage: 30, speed: 7, defense: 8, description: 'Exploradora espacial ágil', special: 'Salto Dimensional' },
                            kai: { health: 110, damage: 28, speed: 6, defense: 12, description: 'Guerreiro estelar equilibrado', special: 'Fúria Estelar' }
                        },
                        enemies: {
                            goblin: { health: 50, damage: 15, speed: 2, reward: 25, description: 'Inimigo básico com ataques simples' },
                            orc: { health: 80, damage: 25, speed: 1, reward: 50, description: 'Inimigo médio mais resistente' },
                            dragon: { health: 200, damage: 40, speed: 3, reward: 150, description: 'Inimigo forte com ataques poderosos' },
                            boss: { health: 500, damage: 60, speed: 2, reward: 500, description: 'Chefe final extremamente poderoso' }
                        },
                        economy: {
                            startingGold: 1000,
                            goldPerEnemy: 10,
                            prices: {
                                healthPotion: 50,
                                manaPotion: 75,
                                basicWeapon: 200,
                                basicArmor: 300
                            }
                        },
                        missions: {
                            tutorial: { name: 'Tutorial Inicial', description: 'Aprenda os controles básicos do jogo', difficulty: 'Fácil', gold: 100, exp: 50 },
                            first_quest: { name: 'Primeira Missão', description: 'Explore o Santuário das Estrelas', difficulty: 'Fácil', gold: 250, exp: 100 }
                        },
                        settings: {
                            gameName: 'Nova Remains',
                            version: '1.0.0',
                            primaryColor: '#3b82f6',
                            secondaryColor: '#1d4ed8',
                            fps: 60,
                            difficulty: 'normal'
                        }
                    };

                    const saved = localStorage.getItem('novaRemainsEditorData');
                    return saved ? { ...defaultData, ...JSON.parse(saved) } : defaultData;
                }

                saveGameData() {
                    localStorage.setItem('novaRemainsEditorData', JSON.stringify(this.gameData));
                    this.showNotification('Dados salvos com sucesso!', 'success');
                }

                loadCharacterData(characterId) {
                    const char = this.gameData.characters[characterId];
                    if (char) {
                        document.getElementById('charHealth').value = char.health;
                        document.getElementById('charDamage').value = char.damage;
                        document.getElementById('charSpeed').value = char.speed;
                        document.getElementById('charDefense').value = char.defense;
                        document.getElementById('charDescription').value = char.description;
                        document.getElementById('charSpecial').value = char.special;
                    }
                }

                loadEnemyData(enemyId) {
                    const enemy = this.gameData.enemies[enemyId];
                    if (enemy) {
                        document.getElementById('enemyHealth').value = enemy.health;
                        document.getElementById('enemyDamage').value = enemy.damage;
                        document.getElementById('enemySpeed').value = enemy.speed;
                        document.getElementById('enemyReward').value = enemy.reward;
                        document.getElementById('enemyDescription').value = enemy.description;
                    }
                }

                loadMissionData(missionId) {
                    const mission = this.gameData.missions[missionId];
                    if (mission) {
                        document.getElementById('missionName').value = mission.name;
                        document.getElementById('missionDescription').value = mission.description;
                        document.getElementById('missionDifficulty').value = mission.difficulty;
                        document.getElementById('missionGold').value = mission.gold;
                        document.getElementById('missionExp').value = mission.exp;
                    }
                }

                showNotification(message, type = 'success') {
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => notification.classList.add('show'), 100);
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            }

            // Funções globais para o editor
            function toggleSection(sectionId) {
                const content = document.getElementById(sectionId);
                const toggle = content.previousElementSibling.querySelector('.section-toggle');
                
                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    toggle.classList.remove('expanded');
                } else {
                    content.classList.add('expanded');
                    toggle.classList.add('expanded');
                }
            }

            function saveCharacter() {
                const characterId = document.getElementById('characterSelect').value;
                const charData = {
                    health: parseInt(document.getElementById('charHealth').value),
                    damage: parseInt(document.getElementById('charDamage').value),
                    speed: parseInt(document.getElementById('charSpeed').value),
                    defense: parseInt(document.getElementById('charDefense').value),
                    description: document.getElementById('charDescription').value,
                    special: document.getElementById('charSpecial').value
                };
                
                gameEditor.gameData.characters[characterId] = charData;
                gameEditor.saveGameData();
            }

            function saveEnemy() {
                const enemyId = document.getElementById('enemySelect').value;
                const enemyData = {
                    health: parseInt(document.getElementById('enemyHealth').value),
                    damage: parseInt(document.getElementById('enemyDamage').value),
                    speed: parseInt(document.getElementById('enemySpeed').value),
                    reward: parseInt(document.getElementById('enemyReward').value),
                    description: document.getElementById('enemyDescription').value
                };
                
                gameEditor.gameData.enemies[enemyId] = enemyData;
                gameEditor.saveGameData();
            }

            function saveEconomy() {
                const economyData = {
                    startingGold: parseInt(document.getElementById('startingGold').value),
                    goldPerEnemy: parseInt(document.getElementById('goldPerEnemy').value),
                    prices: {
                        healthPotion: parseInt(document.getElementById('priceHealthPotion').value),
                        manaPotion: parseInt(document.getElementById('priceManaPotion').value),
                        basicWeapon: parseInt(document.getElementById('priceBasicWeapon').value),
                        basicArmor: parseInt(document.getElementById('priceBasicArmor').value)
                    }
                };
                
                gameEditor.gameData.economy = economyData;
                gameEditor.saveGameData();
            }

            function saveMission() {
                const missionId = document.getElementById('missionSelect').value;
                const missionData = {
                    name: document.getElementById('missionName').value,
                    description: document.getElementById('missionDescription').value,
                    difficulty: document.getElementById('missionDifficulty').value,
                    gold: parseInt(document.getElementById('missionGold').value),
                    exp: parseInt(document.getElementById('missionExp').value)
                };
                
                gameEditor.gameData.missions[missionId] = missionData;
                gameEditor.saveGameData();
            }

            function saveSettings() {
                const settingsData = {
                    gameName: document.getElementById('gameName').value,
                    version: document.getElementById('gameVersion').value,
                    primaryColor: document.getElementById('primaryColor').value,
                    secondaryColor: document.getElementById('secondaryColor').value,
                    fps: parseInt(document.getElementById('gameFPS').value),
                    difficulty: document.getElementById('globalDifficulty').value
                };
                
                gameEditor.gameData.settings = settingsData;
                gameEditor.saveGameData();
                
                // Aplicar mudanças visuais
                applySettingsChanges(settingsData);
            }

            function applySettingsChanges(settings) {
                // Atualizar título do jogo
                const gameTitle = document.getElementById('gameTitle');
                if (gameTitle) gameTitle.textContent = settings.gameName;
                
                // Aplicar cores
                document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
                document.documentElement.style.setProperty('--secondary-color', settings.secondaryColor);
            }

            function previewAsset(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('assetPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function uploadAsset() {
                const fileInput = document.getElementById('assetUpload');
                const assetName = document.getElementById('assetName').value;
                const assetType = document.getElementById('assetType').value;
                
                if (!fileInput.files[0] || !assetName) {
                    gameEditor.showNotification('Selecione um arquivo e digite um nome!', 'error');
                    return;
                }
                
                // Aqui você implementaria o upload real
                gameEditor.showNotification(`Asset "${assetName}" carregado como ${assetType}!`, 'success');
            }

            function previewAllAssets() {
                gameEditor.showNotification('Visualização de assets em desenvolvimento!', 'warning');
            }

            function saveAll() {
                saveCharacter();
                saveEnemy();
                saveEconomy();
                saveMission();
                saveSettings();
                gameEditor.showNotification('Todas as configurações foram salvas!', 'success');
            }

            function loadConfig() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const data = JSON.parse(e.target.result);
                                gameEditor.gameData = { ...gameEditor.gameData, ...data };
                                gameEditor.saveGameData();
                                gameEditor.showNotification('Configuração carregada com sucesso!', 'success');
                            } catch (error) {
                                gameEditor.showNotification('Erro ao carregar arquivo!', 'error');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            }

            function resetAll() {
                if (confirm('Tem certeza que deseja resetar todas as configurações?')) {
                    localStorage.removeItem('novaRemainsEditorData');
                    location.reload();
                }
            }

            function exportConfig() {
                const dataStr = JSON.stringify(gameEditor.gameData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'nova-remains-config.json';
                link.click();
                URL.revokeObjectURL(url);
                gameEditor.showNotification('Configuração exportada!', 'success');
            }

            // Inicializar editor
            const gameEditor = new GameEditor();

            // Integração com sistema de combate existente
            function dispatchEnemyDefeated(enemyType) {
                const event = new CustomEvent('enemyDefeated', {
                    detail: { enemyType: enemyType }
                });
                document.dispatchEvent(event);
            }

            function dispatchItemCollected(itemType) {
                const event = new CustomEvent('itemCollected', {
                    detail: { itemType: itemType }
                });
                document.dispatchEvent(event);
            }

            // Interceptar derrota de inimigos no sistema existente
            const originalEnemyUpdate = Enemy.prototype.update;
            Enemy.prototype.update = function(deltaTime) {
                const result = originalEnemyUpdate.call(this, deltaTime);
                
                // Verificar se inimigo foi derrotado
                if (this.health <= 0 && !this.defeated) {
                    this.defeated = true;
                    dispatchEnemyDefeated(this.type || 'enemy');
                }
                
                return result;
            };

            // Interceptar coleta de itens (se existir)
            if (typeof Item !== 'undefined') {
                const originalItemCollect = Item.prototype.collect;
                Item.prototype.collect = function() {
                    const result = originalItemCollect.call(this);
                    dispatchItemCollected(this.type || 'item');
                    return result;
                };
            }
    </script>

    <!-- Modais Modernos -->
    <!-- Modal de Seleção de Heróis -->
    <div class="modal-overlay" id="heroModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select Your Star Hunter</h2>
                <button class="close-btn" onclick="closeModal('heroModal')">×</button>
            </div>
            
            <div class="heroes-grid">
                <div class="hero-card" onclick="selectHero(this, 'nova-striker')">
                    <div class="hero-avatar">🌟</div>
                    <h3 class="hero-name">Nova Striker</h3>
                    <p class="hero-class">Assault • Plasma</p>
                    <div class="hero-stats">
                        <div class="stat-row">
                            <span>Attack</span>
                            <span>95</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill attack" style="width: 95%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Defense</span>
                            <span>70</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill defense" style="width: 70%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Speed</span>
                            <span>85</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill speed" style="width: 85%"></div>
                        </div>
                    </div>
                </div>

                <div class="hero-card" onclick="selectHero(this, 'void-guardian')">
                    <div class="hero-avatar">🌑</div>
                    <h3 class="hero-name">Void Guardian</h3>
                    <p class="hero-class">Tank • Dark Matter</p>
                    <div class="hero-stats">
                        <div class="stat-row">
                            <span>Attack</span>
                            <span>70</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill attack" style="width: 70%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Defense</span>
                            <span>95</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill defense" style="width: 95%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Speed</span>
                            <span>60</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill speed" style="width: 60%"></div>
                        </div>
                    </div>
                </div>

                <div class="hero-card" onclick="selectHero(this, 'star-weaver')">
                    <div class="hero-avatar">✨</div>
                    <h3 class="hero-name">Star Weaver</h3>
                    <p class="hero-class">Mage • Cosmic</p>
                    <div class="hero-stats">
                        <div class="stat-row">
                            <span>Attack</span>
                            <span>90</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill attack" style="width: 90%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Defense</span>
                            <span>65</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill defense" style="width: 65%"></div>
                        </div>
                        <div class="stat-row">
                            <span>Speed</span>
                            <span>80</span>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill speed" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn-modern btn-primary" onclick="deployHero()">Deploy Hunter</button>
            </div>
        </div>
    </div>

    <!-- Modal de Missões -->
    <div class="modal-overlay" id="missionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Galactic Mission Map</h2>
                <button class="close-btn" onclick="closeModal('missionModal')">×</button>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <h3 style="color: #60a5fa; margin-bottom: 1rem;">Sistema de Missões</h3>
                <p style="color: #94a3b8;">Em desenvolvimento...</p>
            </div>
        </div>
    </div>

    <!-- Modal da Loja -->
    <div class="modal-overlay" id="shopModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Galactic Arsenal</h2>
                <button class="close-btn" onclick="closeModal('shopModal')">×</button>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <h3 style="color: #10b981; margin-bottom: 1rem;">Sistema de Loja</h3>
                <p style="color: #94a3b8;">Em desenvolvimento...</p>
            </div>
        </div>
    </div>

    <!-- Modal de Inventário -->
    <div class="modal-overlay" id="inventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Inventory</h2>
                <button class="close-btn" onclick="closeModal('inventoryModal')">×</button>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <h3 style="color: #a855f7; margin-bottom: 1rem;">Sistema de Inventário</h3>
                <p style="color: #94a3b8;">Em desenvolvimento...</p>
            </div>
        </div>
    </div>

    <!-- Modal de Configurações -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Game Settings</h2>
                <button class="close-btn" onclick="closeModal('settingsModal')">×</button>
            </div>
            <div style="text-align: center; padding: 2rem;">
                <h3 style="color: #6b7280; margin-bottom: 1rem;">Configurações</h3>
                <p style="color: #94a3b8;">Em desenvolvimento...</p>
            </div>
        </div>
    </div>

    <!-- JavaScript para Interface Moderna -->
    <script>
        // Sistema de Estrelas Animadas Global
        class GlobalStarfield {
            constructor() {
                this.canvas = document.getElementById('globalStarfieldCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.numStars = 600;
                this.speed = 0.3;
                
                this.resize();
                this.createStars();
                this.animate();
                
                window.addEventListener('resize', () => this.resize());
            }
            
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            createStars() {
                for (let i = 0; i < this.numStars; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width - this.canvas.width / 2,
                        y: Math.random() * this.canvas.height - this.canvas.height / 2,
                        z: Math.random() * 1000,
                        prevX: 0,
                        prevY: 0,
                        size: Math.random() * 2 + 0.5
                    });
                }
            }
            
            animate() {
                this.ctx.fillStyle = 'rgba(15, 15, 35, 0.05)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                this.stars.forEach(star => {
                    star.prevX = star.x / star.z * 100 + centerX;
                    star.prevY = star.y / star.z * 100 + centerY;
                    
                    star.z -= this.speed;
                    
                    if (star.z <= 0) {
                        star.x = Math.random() * this.canvas.width - this.canvas.width / 2;
                        star.y = Math.random() * this.canvas.height - this.canvas.height / 2;
                        star.z = 1000;
                    }
                    
                    const x = star.x / star.z * 100 + centerX;
                    const y = star.y / star.z * 100 + centerY;
                    
                    const opacity = 1 - star.z / 1000;
                    const size = star.size * (1 - star.z / 1000);
                    
                    // Desenhar estrela como círculo
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.8})`;
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Adicionar brilho
                    if (opacity > 0.5) {
                        this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.3})`;
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, size * 2, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                requestAnimationFrame(() => this.animate());
            }
        }

        // Sistema de Estrelas para o Jogo
        class GameStarfield {
            constructor() {
                this.canvas = document.getElementById('starfieldCanvas');
                if (!this.canvas) return;
                
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.numStars = 400;
                this.speed = 0.5;
                
                this.resize();
                this.createStars();
                this.animate();
                
                window.addEventListener('resize', () => this.resize());
            }
            
            resize() {
                if (!this.canvas) return;
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
            }
            
            createStars() {
                for (let i = 0; i < this.numStars; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width - this.canvas.width / 2,
                        y: Math.random() * this.canvas.height - this.canvas.height / 2,
                        z: Math.random() * 1000,
                        prevX: 0,
                        prevY: 0
                    });
                }
            }
            
            animate() {
                if (!this.canvas) return;
                
                this.ctx.fillStyle = 'rgba(15, 15, 35, 0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                this.stars.forEach(star => {
                    star.prevX = star.x / star.z * 100 + centerX;
                    star.prevY = star.y / star.z * 100 + centerY;
                    
                    star.z -= this.speed;
                    
                    if (star.z <= 0) {
                        star.x = Math.random() * this.canvas.width - this.canvas.width / 2;
                        star.y = Math.random() * this.canvas.height - this.canvas.height / 2;
                        star.z = 1000;
                    }
                    
                    const x = star.x / star.z * 100 + centerX;
                    const y = star.y / star.z * 100 + centerY;
                    
                    this.ctx.strokeStyle = `rgba(255, 255, 255, ${1 - star.z / 1000})`;
                    this.ctx.lineWidth = 2;
                    this.ctx.beginPath();
                    this.ctx.moveTo(star.prevX, star.prevY);
                    this.ctx.lineTo(x, y);
                    this.ctx.stroke();
                });
                
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Inicializar sistemas de estrelas
        new GlobalStarfield();
        new GameStarfield();
        
        // Sistema de Estrelas para o Mapa do Mundo
        class WorldMapStarfield {
            constructor() {
                this.canvas = document.getElementById('worldMapStarfieldCanvas');
                if (!this.canvas) return;
                
                this.ctx = this.canvas.getContext('2d');
                this.stars = [];
                this.numStars = 500;
                this.speed = 0.4;
                
                this.resize();
                this.createStars();
                this.animate();
                
                window.addEventListener('resize', () => this.resize());
            }
            
            resize() {
                if (!this.canvas) return;
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
            }
            
            createStars() {
                for (let i = 0; i < this.numStars; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width - this.canvas.width / 2,
                        y: Math.random() * this.canvas.height - this.canvas.height / 2,
                        z: Math.random() * 1000,
                        prevX: 0,
                        prevY: 0,
                        size: Math.random() * 2 + 0.5
                    });
                }
            }
            
            animate() {
                if (!this.canvas) return;
                
                this.ctx.fillStyle = 'rgba(15, 15, 35, 0.05)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                this.stars.forEach(star => {
                    star.prevX = star.x / star.z * 100 + centerX;
                    star.prevY = star.y / star.z * 100 + centerY;
                    
                    star.z -= this.speed;
                    
                    if (star.z <= 0) {
                        star.x = Math.random() * this.canvas.width - this.canvas.width / 2;
                        star.y = Math.random() * this.canvas.height - this.canvas.height / 2;
                        star.z = 1000;
                    }
                    
                    const x = star.x / star.z * 100 + centerX;
                    const y = star.y / star.z * 100 + centerY;
                    
                    const opacity = 1 - star.z / 1000;
                    const size = star.size * (1 - star.z / 1000);
                    
                    // Desenhar estrela como círculo
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.8})`;
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Adicionar brilho
                    if (opacity > 0.5) {
                        this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity * 0.3})`;
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, size * 2, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Função para inicializar estrelas do mapa
        function initializeWorldMapStarfield() {
            const starfield = new WorldMapStarfield();
            return starfield;
        }
        
        // Inicializar estrelas quando o mapa for mostrado
        let worldMapStarfield = null;
        
        // Modificar a função showSubmenu para inicializar estrelas
        const originalShowSubmenu = window.showSubmenu;
        window.showSubmenu = function(menuId) {
            originalShowSubmenu(menuId);
            
            // Inicializar estrelas se for o mapa do mundo
            if (menuId === 'worldMap' && !worldMapStarfield) {
                setTimeout(() => {
                    worldMapStarfield = initializeWorldMapStarfield();
                }, 100);
            }
        };
        
        // Sistema de Modais
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Fechar modal clicando fora
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
            }
        });
        
        // Sistema de Seleção de Heróis
        let selectedHero = null;
        
        function selectHero(card, heroId) {
            // Remover seleção anterior
            document.querySelectorAll('.hero-card').forEach(c => c.classList.remove('selected'));
            
            // Selecionar novo herói
            card.classList.add('selected');
            selectedHero = heroId;
        }
        
        function deployHero() {
            if (selectedHero) {
                alert(`Deploying ${selectedHero}...`);
                closeModal('heroModal');
            } else {
                alert('Please select a hero first!');
            }
        }
        
        // Sistema de Combate
        function startCombat() {
            alert('Starting Combat Mode...');
        }
        
        // ========================================
        // SISTEMA DE MISSÕES - JAVASCRIPT
        // ========================================
        
        let missionGameState = {
            player: {
                x: 50, y: 350,
                vx: 0, vy: 0,
                width: 40, height: 50,
                hp: 100, maxHp: 100,
                mp: 100, maxMp: 100,
                speed: 0.55, jumpPower: 15,
                lastMoveDirection: 'right',
                isJumping: false,
                isAttacking: false,
                attackCooldown: false,
                isDashing: false,
                dashCooldown: false,
                skillCooldown: false,
                isInvincible: false,
            },
            enemies: [],
            keys: {},
            gravity: 0.8,
            mission: {
                currentWave: 0,
                totalWaves: 2,
                isBossWave: false,
                status: 'pending',
                currentMission: null
            },
            gameLoopId: null,
        };
        
        // Configurações de missões
        const missionConfigs = {
            tutorial: {
                name: "Tutorial Inicial",
                description: "Aprenda os controles básicos do jogo",
                waves: 1,
                enemiesPerWave: 2,
                hasBoss: false,
                rewards: { gold: 100, exp: 50 }
            },
            first_quest: {
                name: "Primeira Busca",
                description: "Encontre Fragmentos de Estrela perdidos",
                waves: 2,
                enemiesPerWave: 3,
                hasBoss: false,
                rewards: { gold: 200, exp: 100 }
            },
            void_exploration: {
                name: "Exploração do Vazio",
                description: "Derrote Filhos do Vazio e colete fragmentos",
                waves: 3,
                enemiesPerWave: 4,
                hasBoss: false,
                rewards: { gold: 500, exp: 250 }
            },
            void_boss: {
                name: "Chefe do Vazio",
                description: "Enfrente o Guardião das Sombras",
                waves: 2,
                enemiesPerWave: 3,
                hasBoss: true,
                rewards: { gold: 1000, exp: 500, item: "Item Raro" }
            }
        };
        
        // Event listeners para missões
        document.addEventListener('DOMContentLoaded', () => {
            // Botões de missão
            const missionButtons = document.querySelectorAll('.mission-select-btn');
            console.log('🔍 Botões de missão encontrados:', missionButtons.length);
            
            missionButtons.forEach(btn => {
                console.log('🔍 Adicionando event listener para:', btn.getAttribute('data-mission'));
                btn.addEventListener('click', (e) => {
                    const missionId = e.target.getAttribute('data-mission');
                    console.log('🎯 Clique em missão detectado:', missionId);
                    startMission(missionId);
                });
            });
            
            // Botões do jogo de missão
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const backToMissions = document.getElementById('back-to-missions');
            
            if (startButton) startButton.addEventListener('click', startMissionGame);
            if (restartButton) restartButton.addEventListener('click', startMissionGame);
            if (backToMissions) backToMissions.addEventListener('click', backToMissionsList);
            
            // Controles do jogo
            document.addEventListener('keydown', (e) => {
                if (missionGameState.mission.status !== 'playing') return;
                
                missionGameState.keys[e.key.toLowerCase()] = true;
                
                if (e.key === 'ArrowUp' && !missionGameState.player.isJumping) {
                    missionGameState.player.vy = -missionGameState.player.jumpPower;
                    missionGameState.player.isJumping = true;
                }
                if (e.key.toLowerCase() === 'z' && !missionGameState.player.attackCooldown) {
                    playerAttack();
                }
                if (e.key.toLowerCase() === 'a' && !missionGameState.player.skillCooldown) {
                    playerSpecialAttack();
                }
                if (e.key === 'Shift' && !missionGameState.player.dashCooldown) {
                    playerDash();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                missionGameState.keys[e.key.toLowerCase()] = false;
            });
        });
        
        function startMission(missionId) {
            const config = missionConfigs[missionId];
            if (!config) return;
            
            missionGameState.mission.currentMission = missionId;
            missionGameState.mission.totalWaves = config.waves;
            missionGameState.mission.isBossWave = config.hasBoss;
            
            // Mostrar tela de missão
            document.getElementById('missionsMenu').style.display = 'none';
            document.getElementById('missionGameContainer').style.display = 'block';
            
            // Atualizar descrição
            const description = document.getElementById('mission-description');
            if (description) {
                description.textContent = config.description;
            }
        }
        
        function startMissionGame() {
            const config = missionConfigs[missionGameState.mission.currentMission];
            if (!config) return;
            
            // Reset do jogador
            missionGameState.player.hp = missionGameState.player.maxHp;
            missionGameState.player.mp = missionGameState.player.maxMp;
            missionGameState.player.x = 50;
            missionGameState.player.y = 350;
            missionGameState.mission.currentWave = 0;
            missionGameState.mission.isBossWave = config.hasBoss;
            
            // Limpar inimigos
            missionGameState.enemies.forEach(e => {
                const element = document.getElementById('game-world');
                if (element && element.contains(e.element)) {
                    element.removeChild(e.element);
                }
            });
            missionGameState.enemies = [];
            
            // Esconder telas
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'none';
            
            // Iniciar jogo
            missionGameState.mission.status = 'playing';
            startNextWave();
            if (missionGameState.gameLoopId) cancelAnimationFrame(missionGameState.gameLoopId);
            updateMissionGame();
        }
        
        function backToMissionsList() {
            document.getElementById('missionGameContainer').style.display = 'none';
            document.getElementById('missionsMenu').style.display = 'block';
            missionGameState.mission.status = 'pending';
            if (missionGameState.gameLoopId) cancelAnimationFrame(missionGameState.gameLoopId);
        }
        
        function startNextWave() {
            const config = missionConfigs[missionGameState.mission.currentMission];
            missionGameState.mission.currentWave++;
            
            if (missionGameState.mission.currentWave > missionGameState.mission.totalWaves) {
                if (config.hasBoss) {
                    document.getElementById('mission-status').innerText = "CHEFE FINAL!";
                    spawnEnemy('boss');
                } else {
                    winMission();
                }
            } else {
                document.getElementById('mission-status').innerText = `Onda ${missionGameState.mission.currentWave}/${missionGameState.mission.totalWaves}`;
                for(let i = 0; i < config.enemiesPerWave; i++) {
                    spawnEnemy();
                }
            }
        }
        
        function spawnEnemy(type = 'normal') {
            const enemy = {
                x: Math.random() > 0.5 ? 950 : 0,
                y: 360,
                vx: 0.5, // Velocidade fixa de 0.5 para todos os inimigos
                element: document.createElement('div'),
            };

            if (type === 'boss') {
                enemy.hp = 300;
                enemy.maxHp = 300;
                enemy.width = 80;
                enemy.height = 80;
                enemy.className = 'boss';
                enemy.y = 320;
            } else {
                enemy.hp = 50;
                enemy.maxHp = 50;
                enemy.width = 40;
                enemy.height = 40;
                enemy.className = 'enemy';
            }

            enemy.element.className = enemy.className;
            enemy.element.style.width = `${enemy.width}px`;
            enemy.element.style.height = `${enemy.height}px`;

            const enemyHealthBar = document.createElement('div');
            enemyHealthBar.className = 'enemy-health-bar';
            enemyHealthBar.style.width = '100%';
            enemyHealthBar.style.top = '-10px';
            enemy.element.appendChild(enemyHealthBar);
            
            document.getElementById('game-world').appendChild(enemy.element);
            missionGameState.enemies.push(enemy);
        }
        
        function playerAttack() {
            if(missionGameState.mission.status !== 'playing') return;
            
            missionGameState.player.isAttacking = true;
            missionGameState.player.attackCooldown = true;
            
            const hitbox = document.createElement('div');
            hitbox.className = 'attack-hitbox';
            const hitboxWidth = 60;
            const hitboxHeight = missionGameState.player.height;
            
            const direction = missionGameState.player.lastMoveDirection === 'right' ? 1 : -1;
            const hitboxX = direction === 1 
                ? missionGameState.player.x + missionGameState.player.width 
                : missionGameState.player.x - hitboxWidth;
            const hitboxY = missionGameState.player.y;

            hitbox.style.width = `${hitboxWidth}px`;
            hitbox.style.height = `${hitboxHeight}px`;
            hitbox.style.left = `${hitboxX}px`;
            hitbox.style.top = `${hitboxY}px`;
            
            document.getElementById('game-world').appendChild(hitbox);

            missionGameState.enemies.forEach(enemy => {
                if (checkCollision({x: hitboxX, y: hitboxY, width: hitboxWidth, height: hitboxHeight}, enemy)) {
                    takeDamage(enemy, 25);
                }
            });

            setTimeout(() => {
                const gameWorld = document.getElementById('game-world');
                if(gameWorld && gameWorld.contains(hitbox)) gameWorld.removeChild(hitbox);
                missionGameState.player.isAttacking = false;
            }, 150);

            setTimeout(() => {
                missionGameState.player.attackCooldown = false;
            }, 500);
        }
        
        function playerSpecialAttack() {
            if (missionGameState.mission.status !== 'playing') return;
            const skillCost = 30;

            if (missionGameState.player.mp < skillCost) return;
            
            missionGameState.player.mp -= skillCost;
            missionGameState.player.skillCooldown = true;

            const hitbox = document.createElement('div');
            hitbox.className = 'special-attack-hitbox';
            const hitboxWidth = 120;
            const hitboxHeight = 70;
            
            const direction = missionGameState.player.lastMoveDirection === 'right' ? 1 : -1;
            const hitboxX = direction === 1 
                ? missionGameState.player.x + missionGameState.player.width 
                : missionGameState.player.x - hitboxWidth;
            const hitboxY = missionGameState.player.y + (missionGameState.player.height - hitboxHeight) / 2;

            hitbox.style.width = `${hitboxWidth}px`;
            hitbox.style.height = `${hitboxHeight}px`;
            hitbox.style.left = `${hitboxX}px`;
            hitbox.style.top = `${hitboxY}px`;
            
            document.getElementById('game-world').appendChild(hitbox);

            missionGameState.enemies.forEach(enemy => {
                if (checkCollision({x: hitboxX, y: hitboxY, width: hitboxWidth, height: hitboxHeight}, enemy)) {
                    takeDamage(enemy, 75);
                }
            });

            setTimeout(() => {
                const gameWorld = document.getElementById('game-world');
                if(gameWorld && gameWorld.contains(hitbox)) gameWorld.removeChild(hitbox);
            }, 300);

            setTimeout(() => {
                missionGameState.player.skillCooldown = false;
            }, 1500);
        }
        
        function playerDash() {
            if (missionGameState.mission.status !== 'playing' || missionGameState.player.isDashing) return;

            missionGameState.player.isDashing = true;
            missionGameState.player.dashCooldown = true;
            document.getElementById('player').style.opacity = '0.5';

            const dashSpeed = 200;
            const dashDirection = missionGameState.player.lastMoveDirection === 'right' ? 1 : -1;
            
            missionGameState.player.x += dashSpeed * dashDirection;

            setTimeout(() => {
                missionGameState.player.isDashing = false;
                document.getElementById('player').style.opacity = '1';
            }, 150);

            setTimeout(() => {
                missionGameState.player.dashCooldown = false;
            }, 800);
        }
        
        function takeDamage(target, amount) {
            target.hp -= amount;
            if (target.element.querySelector('.enemy-health-bar')) {
                const healthPercentage = Math.max(0, (target.hp / target.maxHp) * 100);
                target.element.querySelector('.enemy-health-bar').style.width = `${healthPercentage}%`;
            }
        }
        
        function damagePlayer(amount) {
            if (missionGameState.player.isInvincible || missionGameState.player.isDashing) return;
            
            missionGameState.player.hp -= amount;
            missionGameState.player.isInvincible = true;
            document.getElementById('player').style.opacity = '0.5';
            
            setTimeout(() => {
                missionGameState.player.isInvincible = false;
                document.getElementById('player').style.opacity = '1';
            }, 1000);
        }
        
        function checkCollision(rect1, rect2) {
            return (
                rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y
            );
        }
        
        function updateMissionGame() {
            if (missionGameState.mission.status !== 'playing') return;

            // Lógica do Jogador
            if (!missionGameState.player.isDashing) {
                if (missionGameState.keys['arrowleft']) {
                    missionGameState.player.x -= missionGameState.player.speed;
                    missionGameState.player.lastMoveDirection = 'left';
                }
                if (missionGameState.keys['arrowright']) {
                    missionGameState.player.x += missionGameState.player.speed;
                    missionGameState.player.lastMoveDirection = 'right';
                }
            }
            
            // Regeneração de Mana
            if (missionGameState.player.mp < missionGameState.player.maxMp) {
                missionGameState.player.mp += 0.1;
            }

            missionGameState.player.vy += missionGameState.gravity;
            missionGameState.player.y += missionGameState.player.vy;
            
            const groundLevel = 400 - missionGameState.player.height;
            if (missionGameState.player.y >= groundLevel) {
                missionGameState.player.y = groundLevel;
                missionGameState.player.vy = 0;
                missionGameState.player.isJumping = false;
            }
            
            if (missionGameState.player.x < 0) missionGameState.player.x = 0;
            if (missionGameState.player.x > 1000 - missionGameState.player.width) missionGameState.player.x = 1000 - missionGameState.player.width;

            // Lógica dos Inimigos
            missionGameState.enemies.forEach(enemy => {
                if(enemy.x < missionGameState.player.x) {
                    enemy.x += enemy.vx;
                } else {
                    enemy.x -= enemy.vx;
                }
                if (checkCollision(missionGameState.player, enemy)) {
                    damagePlayer(10);
                }
            });

            const aliveEnemies = [];
            missionGameState.enemies.forEach(enemy => {
                if (enemy.hp > 0) {
                    aliveEnemies.push(enemy);
                } else {
                    const gameWorld = document.getElementById('game-world');
                    if(gameWorld && gameWorld.contains(enemy.element)) gameWorld.removeChild(enemy.element);
                }
            });
            missionGameState.enemies = aliveEnemies;

            if (missionGameState.enemies.length === 0) {
                const config = missionConfigs[missionGameState.mission.currentMission];
                if (missionGameState.mission.isBossWave || !config.hasBoss) {
                    winMission();
                } else {
                    startNextWave();
                }
            }

            if(missionGameState.player.hp <= 0) {
                gameOverMission();
            }

            // Atualizações Visuais
            document.getElementById('player').style.left = `${missionGameState.player.x}px`;
            document.getElementById('player').style.top = `${missionGameState.player.y}px`;
            missionGameState.enemies.forEach(enemy => {
                enemy.element.style.left = `${enemy.x}px`;
                enemy.element.style.top = `${enemy.y}px`;
            });
            
            const healthPercentage = Math.max(0, (missionGameState.player.hp / missionGameState.player.maxHp) * 100);
            document.getElementById('player-health-bar').style.width = `${healthPercentage}%`;
            
            const manaPercentage = Math.max(0, (missionGameState.player.mp / missionGameState.player.maxMp) * 100);
            document.getElementById('player-mana-bar').style.width = `${manaPercentage}%`;

            missionGameState.gameLoopId = requestAnimationFrame(updateMissionGame);
        }
        
        function gameOverMission() {
            missionGameState.mission.status = 'gameover';
            cancelAnimationFrame(missionGameState.gameLoopId);
            document.getElementById('end-game-title').innerText = "Game Over";
            document.getElementById('end-game-subtitle').innerText = "Os monstros venceram desta vez...";
            document.getElementById('game-over-screen').style.display = 'flex';
        }
        
        function winMission() {
            missionGameState.mission.status = 'win';
            cancelAnimationFrame(missionGameState.gameLoopId);
            document.getElementById('end-game-title').innerText = "Vitória!";
            document.getElementById('end-game-subtitle').innerText = "Você completou a missão!";
            document.getElementById('game-over-screen').style.display = 'flex';
            
            // Dar recompensas
            const config = missionConfigs[missionGameState.mission.currentMission];
            if (config && config.rewards) {
                setTimeout(() => {
                    alert(`Recompensas recebidas:\n💰 ${config.rewards.gold} Ouro\n⭐ ${config.rewards.exp} EXP${config.rewards.item ? '\n🏆 ' + config.rewards.item : ''}`);
                }, 1000);
            }
        }
        
        // Alternar entre interfaces
        function toggleInterface() {
            const mainMenu = document.getElementById('mainMenu');
            const modernInterface = document.getElementById('modernInterface');
            
            if (mainMenu.style.display === 'block') {
                mainMenu.style.display = 'none';
                modernInterface.style.display = 'flex';
            } else {
                mainMenu.style.display = 'block';
                modernInterface.style.display = 'none';
            }
        }
        
        // Teclas de atalho - Event listener com alta prioridade
        document.addEventListener('keydown', (e) => {
            // ESC desabilitado para evitar conflitos
            if (e.key === 'Escape') {
                console.log('🚫 ESC desabilitado para evitar conflitos');
                // Não fazer nada com ESC
                return;
            }
            
            // Ctrl + M para alternar interface
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                toggleInterface();
            }
        });
        
        // Adicionar botão para alternar interface no menu principal
        document.addEventListener('DOMContentLoaded', function() {
            const menuContent = document.querySelector('.menu-content .menu-section');
            if (menuContent) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'menu-btn';
                toggleBtn.innerHTML = '🎨 Interface Moderna';
                toggleBtn.onclick = toggleInterface;
                menuContent.appendChild(toggleBtn);
            }
        });

        // ========================================
        // EVENT LISTENERS PARA HEADER DO MAPA DO MUNDO
        // ========================================
        
        // Configurar botões do header do mapa do mundo
        function setupWorldMapHeaderButtons() {
            // Botão de inventário
            const inventoryBtn = document.getElementById('inventoryFromWorldMapBtn');
            if (inventoryBtn) {
                inventoryBtn.addEventListener('click', () => {
                    showSubmenu('inventoryMenu');
                });
            }
            
            // Botão de loja
            const shopBtn = document.getElementById('shopFromWorldMapBtn');
            if (shopBtn) {
                shopBtn.addEventListener('click', () => {
                    showSubmenu('shopMenu');
                });
            }
            
            // Botão de missões
            const missionsBtn = document.getElementById('missionsFromWorldMapBtn');
            if (missionsBtn) {
                missionsBtn.addEventListener('click', () => {
                    showSubmenu('missionsMenu');
                });
            }
            
            // Botão de heróis
            const characterBtn = document.getElementById('characterFromWorldMapBtn');
            if (characterBtn) {
                characterBtn.addEventListener('click', () => {
                    showSubmenu('characterMenu');
                });
            }
            
            // Botão de habilidades
            const skillsBtn = document.getElementById('skillsFromWorldMapBtn');
            if (skillsBtn) {
                skillsBtn.addEventListener('click', () => {
                    showSubmenu('skillsMenu');
                });
            }
            
            // Botão de configurações
            const settingsBtn = document.getElementById('settingsFromWorldMapBtn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    showSubmenu('settingsMenu');
                });
            }
        }
        
        // Função para mostrar submenu (se não existir)
        function showSubmenu(menuId) {
            console.log('Mostrando submenu:', menuId);
            hideAllMenus();
            const menu = document.getElementById(menuId);
            if (menu) {
                menu.style.display = 'block';
                console.log('Submenu exibido:', menuId);
            } else {
                console.error('Submenu não encontrado:', menuId);
            }
        }
        
        // Função para esconder todos os menus
        function hideAllMenus() {
            const menus = [
                'characterMenu', 'skillsMenu', 'inventoryMenu', 
                'shopMenu', 'missionsMenu', 'worldMap', 'settingsMenu'
            ];
            
            menus.forEach(menuId => {
                const menu = document.getElementById(menuId);
                if (menu) {
                    menu.style.display = 'none';
                }
            });
        }
        
        // Função para mostrar menu principal
        function showMainMenu() {
            hideAllMenus();
            const mainMenu = document.getElementById('mainMenu');
            if (mainMenu) {
                mainMenu.style.display = 'block';
            }
        }
        
        // Configurar botões de voltar para todos os menus
        function setupBackButtons() {
            // Botão voltar do mapa do mundo
            const backFromWorldMapBtn = document.getElementById('backFromWorldMapBtn');
            if (backFromWorldMapBtn) {
                backFromWorldMapBtn.addEventListener('click', () => {
                    showMainMenu();
                });
            }
            
            // Botão voltar do inventário
            const backFromInventoryBtn = document.getElementById('backFromInventoryBtn');
            if (backFromInventoryBtn) {
                backFromInventoryBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
            
            // Botão voltar da loja
            const backFromShopBtn = document.getElementById('backFromShopBtn');
            if (backFromShopBtn) {
                backFromShopBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
            
            // Botão voltar das missões
            const backFromMissionsBtn = document.getElementById('backFromMissionsBtn');
            if (backFromMissionsBtn) {
                backFromMissionsBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
            
            // Botão voltar dos heróis
            const backFromCharacterBtn = document.getElementById('backFromCharacterBtn');
            if (backFromCharacterBtn) {
                backFromCharacterBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
            
            // Botão voltar das habilidades
            const backFromSkillsBtn = document.getElementById('backFromSkillsBtn');
            if (backFromSkillsBtn) {
                backFromSkillsBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
            
            // Botão voltar das configurações
            const backFromSettingsBtn = document.getElementById('backFromSettingsBtn');
            if (backFromSettingsBtn) {
                backFromSettingsBtn.addEventListener('click', () => {
                    showSubmenu('worldMap');
                });
            }
        }
        
        // Inicializar botões do header do mapa quando a página carregar
        document.addEventListener('DOMContentLoaded', () => {
            setupWorldMapHeaderButtons();
            setupBackButtons();
            setupInventoryInteractions();
            setupShopInteractions();
        });
        
        // Configurar interações do inventário
        function setupInventoryInteractions() {
            // Clique nos slots do inventário
            document.querySelectorAll('.inventory-slot').forEach(slot => {
                slot.addEventListener('click', () => {
                    if (!slot.classList.contains('empty')) {
                        // Mostrar detalhes do item
                        console.log('Item clicado:', slot.querySelector('.item-name').textContent);
                    }
                });
            });
            
            // Clique nos equipamentos
            document.querySelectorAll('.equipment-slot').forEach(slot => {
                slot.addEventListener('click', () => {
                    console.log('Equipamento clicado:', slot.dataset.type);
                });
            });
        }
        
        // Configurar interações da loja
        function setupShopInteractions() {
            // Filtros de categoria
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remover active de todos
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    // Adicionar active no clicado
                    btn.classList.add('active');
                    
                    // Filtrar itens
                    const category = btn.dataset.category;
                    document.querySelectorAll('.shop-item').forEach(item => {
                        if (category === 'all' || item.dataset.category === category) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
            
            // Clique nos itens da loja
            document.querySelectorAll('.shop-item').forEach(item => {
                item.addEventListener('click', () => {
                    console.log('Item da loja clicado:', item.querySelector('.item-name').textContent);
                });
            });
            
            // Botões de compra
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const item = btn.closest('.shop-item');
                    const itemName = item.querySelector('.item-name').textContent;
                    const price = item.dataset.price;
                    
                    if (confirm(`Comprar ${itemName} por ${price} moedas?`)) {
                        alert(`${itemName} comprado com sucesso!`);
                        // Aqui você implementaria a lógica de compra
                    }
                });
            });
        }
        
        // ========================================
        // SISTEMA DE MISSÕES DO MAPA DO MUNDO (GRAND CHASE STYLE)
        // ========================================
        
        function initializeMissionIcons() {
            const missionIcons = document.querySelectorAll('.mission-icon');
            
            missionIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    const missionId = this.dataset.mission;
                    
                    if (this.classList.contains('locked')) {
                        alert(`Esta missão está bloqueada. Complete as missões anteriores para desbloqueá-la.`);
                        return;
                    }
                    
                    if (this.classList.contains('available')) {
                        startMission(missionId);
                    }
                });
            });
        }
        
        // Variável global para personagem selecionado
        let selectedCharacter = 'juno';
        
        function startMission(missionId) {
            console.log('🎮 Iniciando missão:', missionId);
            
            // Obter personagem selecionado
            const characterSelect = document.getElementById('characterSelect');
            if (characterSelect) {
                selectedCharacter = characterSelect.value || 'juno';
                console.log('👤 Personagem selecionado:', selectedCharacter);
            }
            
            const missions = {
                'tutorial': {
                    name: 'Tutorial Inicial',
                    description: 'Aprenda os controles básicos do Grand Chase',
                    level: 1,
                    enemies: 3,
                    enemyTypes: ['goblin'],
                    rewards: { gold: 100, exp: 50 }
                },
                'sanctuary': {
                    name: 'Santuário das Estrelas',
                    description: 'Explore o antigo santuário e encontre os fragmentos perdidos',
                    level: 5,
                    enemies: 5,
                    enemyTypes: ['goblin', 'skeleton'],
                    rewards: { gold: 300, exp: 150 }
                },
                'void': {
                    name: 'Vazio Cósmico',
                    description: 'Navegue pelo perigoso vazio cósmico',
                    level: 10,
                    enemies: 8,
                    enemyTypes: ['skeleton', 'orc'],
                    rewards: { gold: 500, exp: 250 }
                },
                'ruins': {
                    name: 'Ruínas Celestiais',
                    description: 'Desvende os segredos das ruínas antigas',
                    level: 15,
                    enemies: 12,
                    enemyTypes: ['orc', 'boss'],
                    rewards: { gold: 750, exp: 375 }
                },
                'temple': {
                    name: 'Templo dos Fragmentos',
                    description: 'Recupere os fragmentos sagrados no templo',
                    level: 20,
                    enemies: 15,
                    enemyTypes: ['boss'],
                    rewards: { gold: 1000, exp: 500 }
                },
                'comet': {
                    name: 'Núcleo do Cometa',
                    description: 'Missão final: Destrua o núcleo do cometa maligno',
                    level: 25,
                    enemies: 20,
                    enemyTypes: ['boss'],
                    rewards: { gold: 2000, exp: 1000 }
                }
            };
            
            const mission = missions[missionId];
            if (mission) {
                showMissionCombat(mission, selectedCharacter);
            }
        }
        
        function showMissionCombat(mission, character) {
            console.log('⚔️ Mostrando combate da missão:', mission.name, 'com personagem:', character);
            
            const combatContainer = document.createElement('div');
            combatContainer.className = 'mission-combat-container';
            combatContainer.innerHTML = `
                <div class="mission-combat-ui">
                    <div class="mission-info">
                        🎯 ${mission.name} - ${mission.description}
                    </div>
                    <div class="mission-progress">
                        Inimigos: 0/${mission.enemies} | Ouro: 0 | EXP: 0 | HP: 100/100 | MP: 50/50
                    </div>
                    <div class="mission-controls">
                        <button class="mission-btn" onclick="pauseMission()">⏸️ Pausar</button>
                        <button class="mission-btn" onclick="exitMission()">🚪 Sair</button>
                    </div>
                </div>
                <canvas class="mission-canvas" width="1200" height="600" id="missionCanvas"></canvas>
            `;
            
            const gameWindow = document.querySelector('.game-window');
            gameWindow.appendChild(combatContainer);
            combatContainer.style.display = 'block';
            
            initializeMissionCombat(mission, character);
        }
        
        function initializeMissionCombat(mission, character) {
            console.log('🔧 Inicializando combate da missão:', mission.name, 'com personagem:', character);
            
            const canvas = document.getElementById('missionCanvas');
            const ctx = canvas.getContext('2d');
            
            // CRIAR MAPA DA MISSÃO
            if (window.levelDesignSystem) {
                try {
                    window.levelDesignSystem.createMissionMap(mission);
                    console.log('✅ Mapa da missão criado');
                } catch (error) {
                    console.error('❌ Erro ao criar mapa da missão:', error);
                }
            } else {
                console.error('❌ Level Design System não encontrado');
            }
            
            // Sistema de Sprites e Animações
            const spriteSystem = {
                player: {
                    sprites: {
                        idle: { frames: 4, currentFrame: 0, timer: 0, speed: 150 },
                        walk: { frames: 6, currentFrame: 0, timer: 0, speed: 100 },
                        jump: { frames: 3, currentFrame: 0, timer: 0, speed: 200 },
                        attack: { frames: 4, currentFrame: 0, timer: 0, speed: 120 },
                        defend: { frames: 2, currentFrame: 0, timer: 0, speed: 200 },
                        grab: { frames: 3, currentFrame: 0, timer: 0, speed: 150 }
                    },
                    currentAnimation: 'idle',
                    facingRight: true
                },
                enemies: {
                    goblin: {
                        sprites: {
                            walk: { frames: 4, currentFrame: 0, timer: 0, speed: 180 },
                            attack: { frames: 3, currentFrame: 0, timer: 0, speed: 150 },
                            death: { frames: 4, currentFrame: 0, timer: 0, speed: 200 }
                        },
                        currentAnimation: 'walk'
                    },
                    skeleton: {
                        sprites: {
                            walk: { frames: 4, currentFrame: 0, timer: 0, speed: 160 },
                            attack: { frames: 3, currentFrame: 0, timer: 0, speed: 140 },
                            death: { frames: 4, currentFrame: 0, timer: 0, speed: 180 }
                        },
                        currentAnimation: 'walk'
                    },
                    orc: {
                        sprites: {
                            walk: { frames: 4, currentFrame: 0, timer: 0, speed: 140 },
                            attack: { frames: 4, currentFrame: 0, timer: 0, speed: 130 },
                            death: { frames: 5, currentFrame: 0, timer: 0, speed: 160 }
                        },
                        currentAnimation: 'walk'
                    },
                    boss: {
                        sprites: {
                            walk: { frames: 6, currentFrame: 0, timer: 0, speed: 120 },
                            attack: { frames: 5, currentFrame: 0, timer: 0, speed: 100 },
                            special: { frames: 8, currentFrame: 0, timer: 0, speed: 80 },
                            death: { frames: 6, currentFrame: 0, timer: 0, speed: 150 }
                        },
                        currentAnimation: 'walk'
                    }
                }
            };
            
            // Sistema de Mapa de Fundo para mapa grande
            const backgroundSystem = {
                layers: [
                    { // Camada de fundo - céu
                        type: 'gradient',
                        color1: '#1a1a2e',
                        color2: '#16213e',
                        y: 0,
                        height: 300
                    },
                    { // Camada de montanhas distantes
                        type: 'mountains',
                        color: '#2d3748',
                        y: 200,
                        height: 150,
                        peaks: [30, 80, 150, 220, 300, 380, 450, 520, 600, 680, 750, 820, 900, 980, 1050, 1120, 1200, 1280, 1360, 1440, 1520, 1600, 1680, 1760, 1840, 1920, 2000, 2080, 2160, 2240, 2320, 2400, 2480, 2560, 2640, 2720, 2800, 2880, 2960, 3000]
                    },
                    { // Camada de árvores
                        type: 'trees',
                        color: '#2d5016',
                        y: 350,
                        height: 100,
                        trees: [50, 120, 200, 280, 360, 440, 520, 600, 680, 760, 840, 920, 1000, 1080, 1160, 1240, 1320, 1400, 1480, 1560, 1640, 1720, 1800, 1880, 1960, 2040, 2120, 2200, 2280, 2360, 2440, 2520, 2600, 2680, 2760, 2840, 2920, 3000]
                    },
                    { // Camada de chão
                        type: 'ground',
                        color: '#4a5568',
                        y: 450,
                        height: 150
                    }
                ]
            };
            
            // Mapa muito maior para scroll horizontal
            const MAP_WIDTH = 3000; // Largura total do mapa
            const MAP_HEIGHT = 600; // Altura do mapa
            
            // Inicializar sistemas aprimorados
            const enhancedPlatformSystem = new EnhancedPlatformSystem();
            const enhancedPhysicsSystem = new EnhancedPhysicsSystem();
            
            const missionState = {
                player: {
                    x: 200, y: 440, width: 40, height: 60,
                    vx: 0, vy: 0, speed: 2.0, jumpPower: 20,
                    health: 100, maxHealth: 100, mana: 50, maxMana: 50,
                    onGround: true, facingRight: true,
                    attacking: false, defending: false, grabbing: false,
                    grabbedEnemy: null, attackCooldown: 0, defendCooldown: 0,
                    grabCooldown: 0, invulnerable: false, invulnerabilityTime: 0,
                    color: '#3b82f6',
                    animationState: 'idle',
                    spriteTimer: 0,
                    currentFrame: 0,
                    // Sistema de pulo melhorado
                    canDoubleJump: true, // Alguns personagens terão pulo duplo
                    hasDoubleJumped: false,
                    jumpCount: 0,
                    maxJumps: 2, // Pulo duplo para alguns personagens
                    // Detecção de plataforma
                    platformStanding: null
                },
                
                // APLICAR STATS DO PERSONAGEM SELECIONADO
                character: character || 'juno',
                enemies: [], projectiles: [], particles: [], effects: [],
                
                // Sistemas aprimorados
                enhancedPlatformSystem: enhancedPlatformSystem,
                enhancedPhysicsSystem: enhancedPhysicsSystem,
                platforms: [], // Será preenchido pelo sistema aprimorado
                score: 0, enemiesDefeated: 0, totalEnemies: mission.enemies,
                gameRunning: true, gravity: 0.9, friction: 0.85,
                camera: { x: 0, y: 0, targetX: 0, targetY: 0 },
                time: 0,
                enemySpawnTimer: 0,
                enemySpawnDelay: 2500, // 2.5 segundos entre spawns
                mapWidth: MAP_WIDTH,
                mapHeight: MAP_HEIGHT
            };
            
            for (let i = 0; i < Math.min(2, mission.enemies); i++) {
                createEnemy(missionState, mission.enemyTypes);
            }
            
            // Inicializar mapa gerado dinamicamente
            const generatedPlatforms = enhancedPlatformSystem.generateHorizontalMap(0, MAP_WIDTH, 0.4);
            missionState.platforms = generatedPlatforms;
            enhancedPlatformSystem.platforms = generatedPlatforms;
            
            // Configurar física do personagem
            enhancedPhysicsSystem.setCharacterPhysics(missionState.player, missionState.character);
            
            // APLICAR STATS DO PERSONAGEM SELECIONADO
            if (window.simpleCombatSystem) {
                window.simpleCombatSystem.applyCharacterStats(missionState.player, missionState.character);
                console.log('👤 Stats aplicadas:', missionState.player.speed, 'jumpPower:', missionState.player.jumpPower);
            }
            
            const keys = {};
            const keyStates = {
                z: { pressed: false, holdTime: 0, charging: false },
                arrowUp: { pressed: false, justPressed: false },
                arrowDown: { pressed: false, justPressed: false },
                arrowLeft: { pressed: false },
                arrowRight: { pressed: false }
            };
            
            document.addEventListener('keydown', (e) => { 
                keys[e.key] = true;
                
                // Detectar teclas específicas
                if (e.key === 'z' || e.key === 'Z') {
                    keyStates.z.pressed = true;
                    keyStates.z.charging = true;
                }
                if (e.key === 'ArrowUp' && !keyStates.arrowUp.pressed) {
                    keyStates.arrowUp.justPressed = true;
                    keyStates.arrowUp.pressed = true;
                }
                if (e.key === 'ArrowDown' && !keyStates.arrowDown.pressed) {
                    keyStates.arrowDown.justPressed = true;
                    keyStates.arrowDown.pressed = true;
                }
                if (e.key === 'ArrowLeft') keyStates.arrowLeft.pressed = true;
                if (e.key === 'ArrowRight') keyStates.arrowRight.pressed = true;
            });
            
            document.addEventListener('keyup', (e) => { 
                keys[e.key] = false;
                
                // Liberar teclas específicas
                if (e.key === 'z' || e.key === 'Z') {
                    keyStates.z.pressed = false;
                    keyStates.z.charging = false;
                    keyStates.z.holdTime = 0;
                }
                if (e.key === 'ArrowUp') {
                    keyStates.arrowUp.pressed = false;
                    keyStates.arrowUp.justPressed = false;
                }
                if (e.key === 'ArrowDown') keyStates.arrowDown.pressed = false;
                if (e.key === 'ArrowLeft') keyStates.arrowLeft.pressed = false;
                if (e.key === 'ArrowRight') keyStates.arrowRight.pressed = false;
            });
            
            function gameLoop() {
                if (!missionState.gameRunning) return;
                
                ctx.fillStyle = 'rgba(15, 15, 35, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                updateGame(missionState, keys);
                renderGame(ctx, missionState);
                
                requestAnimationFrame(gameLoop);
            }
            
            function updateGame(state, keys) {
                state.time += 16;
                
                // ATUALIZAR SISTEMA DE LEVEL DESIGN
                window.levelDesignSystem.update(state, keys, 16);
                
                // Atualizar cooldowns do jogador
                if (state.player.attackCooldown > 0) state.player.attackCooldown -= 16;
                if (state.player.defendCooldown > 0) state.player.defendCooldown -= 16;
                if (state.player.grabCooldown > 0) state.player.grabCooldown -= 16;
                if (state.player.invulnerabilityTime > 0) state.player.invulnerabilityTime -= 16;
                
                // Atualizar sistema de carregamento de habilidades
                if (keyStates.z.charging) {
                    keyStates.z.holdTime += 16;
                    
                    // Carregar habilidades progressivamente (3 níveis)
                    if (keyStates.z.holdTime >= 1000 && !state.player.skillLevel1) {
                        state.player.skillLevel1 = true;
                        state.player.mana = Math.min(state.player.maxMana, state.player.mana + 10);
                    }
                    if (keyStates.z.holdTime >= 2000 && !state.player.skillLevel2) {
                        state.player.skillLevel2 = true;
                        state.player.mana = Math.min(state.player.maxMana, state.player.mana + 10);
                    }
                    if (keyStates.z.holdTime >= 3000 && !state.player.skillLevel3) {
                        state.player.skillLevel3 = true;
                        state.player.mana = Math.min(state.player.maxMana, state.player.mana + 10);
                    }
                }
                
                // Controles de movimento do jogador (setas direcionais)
                if (keyStates.arrowLeft.pressed) {
                    state.player.vx = -state.player.speed;
                    state.player.facingRight = false;
                    if (state.player.onGround && !state.player.attacking && !state.player.defending) {
                        state.player.animationState = 'walk';
                    }
                } else if (keyStates.arrowRight.pressed) {
                    state.player.vx = state.player.speed;
                    state.player.facingRight = true;
                    if (state.player.onGround && !state.player.attacking && !state.player.defending) {
                        state.player.animationState = 'walk';
                    }
                } else {
                    state.player.vx *= state.friction;
                    if (state.player.onGround && !state.player.attacking && !state.player.defending && !state.player.grabbing) {
                        state.player.animationState = 'idle';
                    }
                }
                
                // ========================================
                // SISTEMA DE FÍSICA APRIMORADO
                // ========================================
                
                // Aplicar física aprimorada
                const input = {
                    left: keyStates.arrowLeft.pressed,
                    right: keyStates.arrowRight.pressed,
                    jumpPressed: keyStates.arrowUp.justPressed
                };
                
                state.enhancedPhysicsSystem.updatePlayer(state.player, deltaTime, input);
                
                // Verificar colisões com plataformas aprimoradas
                const collisionResult = state.enhancedPlatformSystem.update(deltaTime, state.player);
                
                // Aplicar resultado da colisão
                state.player.onGround = collisionResult.onGround;
                state.player.platformStanding = collisionResult.platformStanding;
                
                // Sistema de pulo agora é gerenciado pelo EnhancedPhysicsSystem
                
                // Reset do justPressed após uso do pulo
                keyStates.arrowUp.justPressed = false;
                
                // Descer de plataforma (seta para baixo)
                if (keyStates.arrowDown.justPressed && state.player.onGround && state.player.platformStanding) {
                    // Permitir descer através da plataforma
                    state.player.y += 5; // Pequeno movimento para baixo
                    state.player.onGround = false;
                    state.player.platformStanding = null;
                    keyStates.arrowDown.justPressed = false; // Reset após uso
                }
                
                // Controles de combate - Z para ataque e habilidades
                if (keyStates.z.pressed && state.player.attackCooldown <= 0 && !state.player.grabbing) {
                    // Ataque básico se não estiver carregando
                    if (keyStates.z.holdTime < 500) {
                        attack(state);
                    }
                }
                
                // Liberar habilidade carregada
                if (!keyStates.z.pressed && (state.player.skillLevel1 || state.player.skillLevel2 || state.player.skillLevel3)) {
                    castSpecialSkill(state);
                    // Reset dos níveis de habilidade
                    state.player.skillLevel1 = false;
                    state.player.skillLevel2 = false;
                    state.player.skillLevel3 = false;
                }
                
                // Reset do justPressed será feito após o uso específico
                
                // Atualizar animações do jogador
                updatePlayerAnimation(state.player);
                
                // Física do jogador
                state.player.vy += state.gravity;
                state.player.x += state.player.vx;
                state.player.y += state.player.vy;
                
                // Limitar movimento horizontal dentro do mapa
                state.player.x = Math.max(50, Math.min(state.mapWidth - state.player.width - 50, state.player.x));
                
                // Atualizar plataformas móveis
                state.platforms.forEach(platform => {
                    if (platform.moving) {
                        if (!platform.originalX) platform.originalX = platform.x;
                        platform.x = platform.originalX + Math.sin(state.time * 0.001 * platform.moveSpeed) * platform.moveRange;
                    }
                });
                
                // Verificar se o jogador não está mais em uma plataforma
                if (state.player.onGround && state.player.platformStanding) {
                    const platform = state.player.platformStanding;
                    const isStillOnPlatform = (
                        state.player.x + state.player.width > platform.x &&
                        state.player.x < platform.x + platform.width &&
                        state.player.y + state.player.height >= platform.y &&
                        state.player.y + state.player.height <= platform.y + 20
                    );
                    
                    if (!isStillOnPlatform) {
                        // console.log('🚀 Jogador saiu da plataforma!', 'playerY:', state.player.y, 'platformY:', platform.y);
                        state.player.onGround = false;
                        state.player.platformStanding = null;
                    }
                }
                        
                // Efeito de pouso
                if (state.player.vy > 5) {
                    for (let i = 0; i < 3; i++) {
                        state.particles.push({
                            x: state.player.x + Math.random() * state.player.width,
                            y: state.player.y + state.player.height,
                            vx: (Math.random() - 0.5) * 2,
                            vy: Math.random() * 2,
                            life: 10,
                            color: '#d1d5db',
                            size: Math.random() * 2 + 1
                        });
                    }
                }
                
                // Atualizar câmera para seguir o jogador
                updateCamera(state);
                
                // Atualizar inimigos
                state.enemies.forEach((enemy, index) => {
                    // IA do inimigo
                    updateEnemyAI(enemy, state);
                    
                    // Física do inimigo
                    enemy.x += enemy.vx;
                    enemy.y += enemy.vy;
                    enemy.vy += state.gravity;
                    
                    // Verificar colisão com plataformas (inimigo)
                    enemy.onGround = false;
                    state.platforms.forEach(platform => {
                        if (enemy.x < platform.x + platform.width &&
                            enemy.x + enemy.width > platform.x &&
                            enemy.y < platform.y + platform.height &&
                            enemy.y + enemy.height > platform.y) {
                            enemy.y = platform.y - enemy.height;
                            enemy.vy = 0;
                            enemy.onGround = true;
                        }
                    });
                    
                    // Atualizar animações do inimigo
                    updateEnemyAnimation(enemy);
                    
                    // Verificar morte do inimigo
                    if (enemy.health <= 0) {
                        enemy.animationState = 'death';
                        if (enemy.currentFrame >= spriteSystem.enemies[enemy.type].sprites.death.frames - 1) {
                            state.enemies.splice(index, 1);
                            state.enemiesDefeated++;
                            state.score += enemy.type === 'boss' ? 500 : enemy.type === 'orc' ? 200 : 100;
                            createDeathEffect(state, enemy.x, enemy.y);
                            updateMissionUI(state, mission);
                        }
                    }
                });
                
                // Atualizar projéteis
                state.projectiles.forEach((projectile, index) => {
                    projectile.x += projectile.vx;
                    projectile.y += projectile.vy;
                    projectile.life--;
                    
                    // Verificar colisão com inimigos
                    state.enemies.forEach(enemy => {
                        if (projectile.x < enemy.x + enemy.width &&
                            projectile.x + 8 > enemy.x &&
                            projectile.y < enemy.y + enemy.height &&
                            projectile.y + 8 > enemy.y) {
                            enemy.health -= projectile.damage;
                            createHitEffect(state, enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                            state.projectiles.splice(index, 1);
                        }
                    });
                    
                    if (projectile.life <= 0) {
                        state.projectiles.splice(index, 1);
                    }
                });
                
                // Atualizar partículas
                state.particles.forEach((particle, index) => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    
                    if (particle.life <= 0) {
                        state.particles.splice(index, 1);
                    }
                });
                
                // Atualizar efeitos especiais
                state.effects.forEach((effect, index) => {
                    effect.life--;
                    if (effect.type === 'explosion') {
                        effect.opacity -= 0.05;
                        effect.radius += 2;
                    }
                    
                    if (effect.life <= 0) {
                        state.effects.splice(index, 1);
                    }
                });
                
                // Spawnar novos inimigos
                state.enemySpawnTimer += 16;
                if (state.enemySpawnTimer >= state.enemySpawnDelay && 
                    state.enemies.length < 3 && 
                    state.enemiesDefeated < state.totalEnemies) {
                    createEnemy(state, mission.enemyTypes);
                    state.enemySpawnTimer = 0;
                }
                
                // Verificar fim da missão
                if (state.enemiesDefeated >= state.totalEnemies) {
                    completeMission(state, mission);
                }
                
                // Verificar morte do jogador
                if (state.player.health <= 0) {
                    gameOver(state, mission);
                }
            }
            
            // Função de atualização da câmera
            function updateCamera(state) {
                const player = state.player;
                const camera = state.camera;
                
                // Definir posição alvo da câmera (centrada no jogador)
                camera.targetX = player.x - canvas.width / 2;
                camera.targetY = Math.max(0, Math.min(100, player.y - canvas.height / 2)); // Limitar câmera Y para mostrar o chão
                
                // Limitar movimento da câmera aos limites do mapa
                camera.targetX = Math.max(0, Math.min(state.mapWidth - canvas.width, camera.targetX));
                camera.targetY = Math.max(0, Math.min(state.mapHeight - canvas.height, camera.targetY));
                
                // Interpolar suavemente a posição da câmera
                const lerpSpeed = 0.1;
                camera.x += (camera.targetX - camera.x) * lerpSpeed;
                camera.y += (camera.targetY - camera.y) * lerpSpeed;
                
                // Garantir que a câmera não saia dos limites
                camera.x = Math.max(0, Math.min(state.mapWidth - canvas.width, camera.x));
                camera.y = Math.max(0, Math.min(state.mapHeight - canvas.height, camera.y));
            }
            
            // Funções de animação
            function updatePlayerAnimation(player) {
                player.spriteTimer += 16;
                const animation = spriteSystem.player.sprites[player.animationState];
                
                if (player.spriteTimer >= animation.speed) {
                    player.currentFrame = (player.currentFrame + 1) % animation.frames;
                    player.spriteTimer = 0;
                }
            }
            
            function updateEnemyAnimation(enemy) {
                enemy.spriteTimer += 16;
                const animation = spriteSystem.enemies[enemy.type].sprites[enemy.animationState];
                
                if (enemy.spriteTimer >= animation.speed) {
                    enemy.currentFrame = (enemy.currentFrame + 1) % animation.frames;
                    enemy.spriteTimer = 0;
                }
            }
            
            // IA dos inimigos
            function updateEnemyAI(enemy, state) {
                const player = state.player;
                const distanceToPlayer = Math.abs(player.x - enemy.x);
                
                switch(enemy.ai.state) {
                    case 'patrol':
                        // Patrulha dentro dos limites do mapa
                        if (enemy.x <= 50 || enemy.x >= state.mapWidth - 50) {
                            enemy.ai.patrolDirection *= -1;
                        }
                        enemy.vx = enemy.ai.patrolDirection * (enemy.type === 'boss' ? 1.5 : 1);
                        enemy.facingRight = enemy.vx > 0;
                        
                        // Se o jogador estiver próximo, começar a perseguir
                        if (distanceToPlayer < 200) {
                            enemy.ai.state = 'chase';
                        }
                        break;
                        
                    case 'chase':
                        // Perseguir o jogador
                        if (player.x < enemy.x) {
                            enemy.vx = -(enemy.type === 'boss' ? 2.5 : 2);
                            enemy.facingRight = false;
                        } else {
                            enemy.vx = enemy.type === 'boss' ? 2.5 : 2;
                            enemy.facingRight = true;
                        }
                        
                        // Se estiver próximo o suficiente, atacar
                        if (distanceToPlayer < 80) {
                            enemy.ai.state = 'attack';
                        }
                        
                        // Se o jogador se afastar muito, voltar a patrulhar
                        if (distanceToPlayer > 300) {
                            enemy.ai.state = 'patrol';
                        }
                        break;
                        
                    case 'attack':
                        enemy.vx = 0;
                        enemy.animationState = 'attack';
                        
                        // Verificar se pode atacar
                        const currentTime = state.time;
                        if (currentTime - enemy.ai.lastAttackTime >= enemy.ai.attackCooldown) {
                            // Ataque ao jogador
                            if (distanceToPlayer < 90 && !player.invulnerable) {
                                player.health -= enemy.damage;
                                player.invulnerable = true;
                                player.invulnerabilityTime = 1000;
                                createHitEffect(state, player.x + player.width/2, player.y + player.height/2);
                            }
                            enemy.ai.lastAttackTime = currentTime;
                        }
                        
                        // Se o jogador se afastar, voltar a perseguir
                        if (distanceToPlayer > 100) {
                            enemy.ai.state = 'chase';
                            enemy.animationState = 'walk';
                        }
                        break;
                }
                
                // Limitar movimento dos inimigos dentro do mapa
                enemy.x = Math.max(50, Math.min(state.mapWidth - enemy.width - 50, enemy.x));
            }
            
            function createDeathEffect(state, x, y) {
                // Efeito de explosão
                state.effects.push({
                    type: 'explosion',
                    x: x,
                    y: y,
                    radius: 10,
                    opacity: 1,
                    life: 30
                });
                
                // Partículas de morte
                for (let i = 0; i < 15; i++) {
                    state.particles.push({
                        x: x + Math.random() * 40,
                        y: y + Math.random() * 40,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 40,
                        color: '#FFD700',
                        size: Math.random() * 4 + 2
                    });
                }
            }
            
            function attack(state) {
                state.player.attacking = true;
                state.player.animationState = 'attack';
                state.player.attackCooldown = 500;
                
                state.enemies.forEach(enemy => {
                    const distance = Math.abs(enemy.x - state.player.x);
                    if (distance < 60) {
                        enemy.health -= 25;
                        createHitEffect(state, enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                        
                        // Efeito de impacto
                        for (let i = 0; i < 8; i++) {
                            state.particles.push({
                                x: enemy.x + enemy.width/2,
                                y: enemy.y + enemy.height/2,
                                vx: (Math.random() - 0.5) * 6,
                                vy: (Math.random() - 0.5) * 6,
                                life: 25,
                                color: '#FFD700',
                                size: Math.random() * 3 + 2
                            });
                        }
                    }
                });
                
                setTimeout(() => {
                    state.player.attacking = false;
                    state.player.animationState = 'idle';
                }, 300);
            }
            
            function defend(state) {
                state.player.defending = true;
                state.player.animationState = 'defend';
                state.player.defendCooldown = 500;
                state.player.invulnerable = true;
                state.player.invulnerabilityTime = 300;
                
                for (let i = 0; i < 8; i++) {
                    state.particles.push({
                        x: state.player.x + Math.random() * 40,
                        y: state.player.y + Math.random() * 60,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: 30,
                        color: '#3b82f6',
                        size: Math.random() * 3 + 2
                    });
                }
                
                setTimeout(() => {
                    state.player.defending = false;
                    state.player.invulnerable = false;
                    state.player.animationState = 'idle';
                }, 300);
            }
            
            function grab(state) {
                state.player.grabbing = true;
                state.player.animationState = 'grab';
                state.player.grabCooldown = 2000;
                
                const grabRange = 50;
                for (let enemy of state.enemies) {
                    const distance = Math.abs(enemy.x - state.player.x);
                    if (distance < grabRange) {
                        state.player.grabbedEnemy = enemy;
                        enemy.grabbed = true;
                        enemy.vx = 0;
                        break;
                    }
                }
            }
            
            function throwEnemy(state) {
                if (state.player.grabbedEnemy) {
                    const enemy = state.player.grabbedEnemy;
                    enemy.grabbed = false;
                    enemy.vx = state.player.facingRight ? 10 : -10;
                    enemy.vy = -6;
                    
                    state.enemies.forEach(otherEnemy => {
                        if (otherEnemy !== enemy) {
                            const dx = enemy.x - otherEnemy.x;
                            const dy = enemy.y - otherEnemy.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 50) {
                                otherEnemy.health -= 20;
                                createHitEffect(state, otherEnemy.x + otherEnemy.width/2, otherEnemy.y + otherEnemy.height/2);
                            }
                        }
                    });
                    
                    state.player.grabbedEnemy = null;
                    state.player.grabbing = false;
                    state.player.animationState = 'idle';
                }
            }
            
            function castFireball(state) {
                state.player.mana -= 10;
                
                state.projectiles.push({
                    x: state.player.x + (state.player.facingRight ? 40 : -10),
                    y: state.player.y + 20,
                    vx: state.player.facingRight ? 8 : -8,
                    vy: 0,
                    life: 80,
                    damage: 30,
                    color: '#ff6b35',
                    size: 8
                });
                
                // Efeito de lançamento
                for (let i = 0; i < 6; i++) {
                    state.particles.push({
                        x: state.player.x + (state.player.facingRight ? 35 : 5),
                        y: state.player.y + 25,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4,
                        life: 20,
                        color: '#ff6b35',
                        size: Math.random() * 2 + 1
                    });
                }
            }
            
            function castSpecialSkill(state) {
                const skillLevel = state.player.skillLevel3 ? 3 : state.player.skillLevel2 ? 2 : 1;
                const manaCost = skillLevel * 15;
                
                if (state.player.mana >= manaCost) {
                    state.player.mana -= manaCost;
                    state.player.attacking = true;
                    state.player.animationState = 'attack';
                    state.player.attackCooldown = 800;
                    
                    // Habilidades especiais baseadas no personagem e nível
                    switch (state.player.character) {
                        case 'juno':
                            castJunoSkill(state, skillLevel);
                            break;
                        case 'atlas':
                            castAtlasSkill(state, skillLevel);
                            break;
                        case 'vega':
                            castVegaSkill(state, skillLevel);
                            break;
                        case 'kai':
                            castKaiSkill(state, skillLevel);
                            break;
                    }
                }
            }
            
            function castJunoSkill(state, level) {
                // Juno - Cavaleiro: Ataques de espada poderosos
                const damage = 40 + (level * 20);
                const range = 80 + (level * 20);
                
                state.enemies.forEach(enemy => {
                    const distance = Math.abs(enemy.x - state.player.x);
                    if (distance < range) {
                        enemy.health -= damage;
                        createHitEffect(state, enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                        
                        // Efeito especial baseado no nível
                        for (let i = 0; i < 8 + (level * 4); i++) {
                            state.particles.push({
                                x: enemy.x + Math.random() * enemy.width,
                                y: enemy.y + Math.random() * enemy.height,
                                vx: (Math.random() - 0.5) * 6,
                                vy: (Math.random() - 0.5) * 6,
                                life: 25,
                                color: level === 3 ? '#ffd700' : level === 2 ? '#ff6b35' : '#3b82f6',
                                size: Math.random() * 3 + 2
                            });
                        }
                    }
                });
            }
            
            function castAtlasSkill(state, level) {
                // Atlas - Caçador: Tiros múltiplos
                const projectileCount = 1 + level;
                const damage = 25 + (level * 15);
                
                for (let i = 0; i < projectileCount; i++) {
                    const angle = (i - (projectileCount - 1) / 2) * 0.3;
                    state.projectiles.push({
                        x: state.player.x + (state.player.facingRight ? 40 : -10),
                        y: state.player.y + 20,
                        vx: state.player.facingRight ? 10 * Math.cos(angle) : -10 * Math.cos(angle),
                        vy: 10 * Math.sin(angle),
                        life: 100,
                        damage: damage,
                        color: level === 3 ? '#00ff00' : level === 2 ? '#ffff00' : '#ff6b35',
                        size: 6 + level
                    });
                }
            }
            
            function castVegaSkill(state, level) {
                // Vega - Mago: Magia elemental
                const radius = 60 + (level * 20);
                const damage = 35 + (level * 25);
                
                // Criar área de efeito
                state.effects.push({
                    x: state.player.x - radius/2,
                    y: state.player.y - radius/2,
                    width: radius,
                    height: radius,
                    life: 30,
                    color: level === 3 ? '#ff00ff' : level === 2 ? '#00ffff' : '#ff6b35',
                    type: 'magic_circle'
                });
                
                state.enemies.forEach(enemy => {
                    const dx = enemy.x - state.player.x;
                    const dy = enemy.y - state.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < radius) {
                        enemy.health -= damage;
                        createHitEffect(state, enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                    }
                });
            }
            
            function castKaiSkill(state, level) {
                // Kai - Assassino: Ataque rápido e furtivo
                const speed = 12 + (level * 3);
                const damage = 30 + (level * 20);
                
                // Dash rápido
                state.player.x += state.player.facingRight ? speed * 3 : -speed * 3;
                
                // Ataque em área durante o dash
                state.enemies.forEach(enemy => {
                    const distance = Math.abs(enemy.x - state.player.x);
                    if (distance < 50) {
                        enemy.health -= damage;
                        createHitEffect(state, enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                    }
                });
                
                // Efeito de dash
                for (let i = 0; i < 10; i++) {
                    state.particles.push({
                        x: state.player.x + Math.random() * state.player.width,
                        y: state.player.y + Math.random() * state.player.height,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 20,
                        color: level === 3 ? '#ff0000' : level === 2 ? '#ff6600' : '#6600ff',
                        size: Math.random() * 2 + 1
                    });
                }
            }
            
            function castHeal(state) {
                state.player.mana -= 20;
                state.player.health = Math.min(state.player.maxHealth, state.player.health + 40);
                
                for (let i = 0; i < 12; i++) {
                    state.particles.push({
                        x: state.player.x + Math.random() * 40,
                        y: state.player.y + Math.random() * 60,
                        vx: (Math.random() - 0.5) * 2,
                        vy: -Math.random() * 4,
                        life: 50,
                        color: '#10b981',
                        size: Math.random() * 3 + 2
                    });
                }
                
                // Efeito de cura especial
                state.effects.push({
                    type: 'heal',
                    x: state.player.x + state.player.width/2,
                    y: state.player.y + state.player.height/2,
                    radius: 30,
                    opacity: 0.8,
                    life: 20
                });
            }
            
            function createEnemy(state, enemyTypes) {
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                
                // Spawnar inimigos em diferentes posições do mapa
                const spawnPositions = [
                    { x: state.player.x + 300, y: 450 },
                    { x: state.player.x + 500, y: 450 },
                    { x: state.player.x - 200, y: 450 },
                    { x: state.player.x + 800, y: 420 },
                    { x: state.player.x - 400, y: 420 }
                ];
                
                const spawnPos = spawnPositions[Math.floor(Math.random() * spawnPositions.length)];
                
                const enemy = {
                    x: Math.max(50, Math.min(state.mapWidth - 100, spawnPos.x)), 
                    y: spawnPos.y, 
                    width: type === 'boss' ? 60 : type === 'orc' ? 45 : 35, 
                    height: type === 'boss' ? 80 : type === 'orc' ? 65 : 50,
                    vx: -1.0, // Velocidade fixa de 1.0 para todos os inimigos
                    vy: 0,
                    health: type === 'boss' ? 150 : type === 'orc' ? 80 : type === 'skeleton' ? 50 : 40,
                    maxHealth: type === 'boss' ? 150 : type === 'orc' ? 80 : type === 'skeleton' ? 50 : 40,
                    damage: type === 'boss' ? 35 : type === 'orc' ? 25 : type === 'skeleton' ? 18 : 15,
                    onGround: false, 
                    grabbed: false,
                    facingRight: false,
                    type: type,
                    animationState: 'walk',
                    currentFrame: 0,
                    spriteTimer: 0,
                    attackTimer: 0,
                    ai: {
                        state: 'patrol', // patrol, chase, attack, dead
                        targetX: null,
                        patrolDirection: Math.random() > 0.5 ? 1 : -1,
                        lastAttackTime: 0,
                        attackCooldown: 2000 // 2 segundos
                    }
                };
                
                state.enemies.push(enemy);
            }
            
            function createHitEffect(state, x, y) {
                for (let i = 0; i < 6; i++) {
                    state.particles.push({
                        x: x + Math.random() * 20,
                        y: y + Math.random() * 20,
                        vx: (Math.random() - 0.5) * 6,
                        vy: (Math.random() - 0.5) * 6,
                        life: 20,
                        color: '#FFD700'
                    });
                }
            }
            
            // Função para renderizar o fundo com câmera
            function renderBackground(ctx, state) {
                const camera = state.camera;
                const layers = backgroundSystem.layers;
                
                layers.forEach(layer => {
                    switch(layer.type) {
                        case 'gradient':
                            const gradient = ctx.createLinearGradient(0, layer.y, 0, layer.y + layer.height);
                            gradient.addColorStop(0, layer.color1);
                            gradient.addColorStop(1, layer.color2);
                            ctx.fillStyle = gradient;
                            ctx.fillRect(-camera.x, layer.y - camera.y, canvas.width, layer.height);
                            break;
                            
                        case 'mountains':
                            ctx.fillStyle = layer.color;
                            ctx.beginPath();
                            ctx.moveTo(-camera.x, layer.y + layer.height - camera.y);
                            
                            // Renderizar montanhas com parallax (movimento mais lento)
                            const parallaxX = camera.x * 0.3;
                            layer.peaks.forEach((peak, index) => {
                                const x = (index * state.mapWidth) / (layer.peaks.length - 1) - parallaxX;
                                const y = layer.y + layer.height - (peak / 8) - camera.y;
                                
                                if (x > -camera.x - 50 && x < canvas.width - camera.x + 50) {
                                    ctx.lineTo(x, y);
                                }
                            });
                            ctx.lineTo(canvas.width - camera.x, layer.y + layer.height - camera.y);
                            ctx.closePath();
                            ctx.fill();
                            break;
                            
                        case 'trees':
                            ctx.fillStyle = layer.color;
                            layer.trees.forEach(x => {
                                const treeX = x - camera.x;
                                const treeY = layer.y + layer.height - 40 - camera.y;
                                
                                if (treeX > -50 && treeX < canvas.width + 50) {
                                    // Tronco
                                    ctx.fillRect(treeX, treeY, 8, 40);
                                    // Copa
                                    ctx.beginPath();
                                    ctx.arc(treeX + 4, treeY, 20, 0, Math.PI * 2);
                                    ctx.fill();
                                }
                            });
                            break;
                            
                        case 'ground':
                            ctx.fillStyle = layer.color;
                            ctx.fillRect(-camera.x, layer.y - camera.y, state.mapWidth, layer.height);
                            
                            // Adicionar textura ao chão
                            ctx.fillStyle = '#718096';
                            for(let i = Math.floor(-camera.x / 20) * 20; i < canvas.width - camera.x; i += 20) {
                                ctx.fillRect(i, layer.y - camera.y, 2, layer.height);
                            }
                            break;
                    }
                });
            }
            
            // Função para desenhar sprites animados
            function drawAnimatedSprite(ctx, x, y, width, height, type, animation, frame, facingRight = true) {
                ctx.save();
                
                if (!facingRight) {
                    ctx.scale(-1, 1);
                    ctx.translate(-2 * x - width, 0);
                }
                
                // Sistema de sprites baseado em formas geométricas coloridas
                switch(type) {
                    case 'player':
                        drawPlayerSprite(ctx, x, y, width, height, animation, frame);
                        break;
                    case 'goblin':
                        drawGoblinSprite(ctx, x, y, width, height, animation, frame);
                        break;
                    case 'skeleton':
                        drawSkeletonSprite(ctx, x, y, width, height, animation, frame);
                        break;
                    case 'orc':
                        drawOrcSprite(ctx, x, y, width, height, animation, frame);
                        break;
                    case 'boss':
                        drawBossSprite(ctx, x, y, width, height, animation, frame);
                        break;
                }
                
                ctx.restore();
            }
            
            function drawPlayerSprite(ctx, x, y, width, height, animation, frame) {
                const colors = {
                    idle: ['#3b82f6', '#1d4ed8', '#1e40af'],
                    walk: ['#3b82f6', '#2563eb', '#1d4ed8'],
                    jump: ['#1e40af', '#1e3a8a'],
                    attack: ['#ef4444', '#dc2626', '#b91c1c'],
                    defend: ['#6b7280', '#4b5563'],
                    grab: ['#f59e0b', '#d97706']
                };
                
                const color = colors[animation] ? colors[animation][frame % colors[animation].length] : '#3b82f6';
                
                // Corpo principal
                ctx.fillStyle = color;
                ctx.fillRect(x + 5, y + 15, width - 10, height - 25);
                
                // Cabeça
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x + 10, y + 5, width - 20, 15);
                
                // Braços (animação)
                ctx.fillStyle = '#fbbf24';
                const armOffset = animation === 'walk' ? Math.sin(frame * 0.5) * 3 : 0;
                ctx.fillRect(x - 5 + armOffset, y + 20, 8, 20);
                ctx.fillRect(x + width - 3 - armOffset, y + 20, 8, 20);
                
                // Pernas (animação)
                ctx.fillStyle = '#1f2937';
                const legOffset = animation === 'walk' ? Math.sin(frame * 0.5 + Math.PI) * 2 : 0;
                ctx.fillRect(x + 8 + legOffset, y + height - 15, 6, 15);
                ctx.fillRect(x + width - 14 - legOffset, y + height - 15, 6, 15);
                
                // Efeito de ataque
                if (animation === 'attack') {
                    ctx.fillStyle = 'rgba(255, 215, 0, 0.6)';
                    ctx.fillRect(x + width - 5, y + 10, 15, height - 20);
                }
                
                // Efeito de defesa
                if (animation === 'defend') {
                    ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
                    ctx.fillRect(x - 3, y - 3, width + 6, height + 6);
                }
            }
            
            function drawGoblinSprite(ctx, x, y, width, height, animation, frame) {
                const colors = {
                    walk: ['#22c55e', '#16a34a', '#15803d'],
                    attack: ['#dc2626', '#b91c1c', '#991b1b'],
                    death: ['#6b7280', '#4b5563', '#374151']
                };
                
                const color = colors[animation] ? colors[animation][frame % colors[animation].length] : '#22c55e';
                
                // Corpo
                ctx.fillStyle = color;
                ctx.fillRect(x + 3, y + 12, width - 6, height - 20);
                
                // Cabeça
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x + 8, y + 2, width - 16, 12);
                
                // Orelhas pontudas
                ctx.fillStyle = color;
                ctx.fillRect(x + 5, y + 1, 4, 6);
                ctx.fillRect(x + width - 9, y + 1, 4, 6);
                
                // Olhos vermelhos
                ctx.fillStyle = '#dc2626';
                ctx.fillRect(x + 10, y + 5, 2, 2);
                ctx.fillRect(x + width - 12, y + 5, 2, 2);
                
                // Pernas
                ctx.fillStyle = '#1f2937';
                ctx.fillRect(x + 5, y + height - 12, 6, 12);
                ctx.fillRect(x + width - 11, y + height - 12, 6, 12);
            }
            
            function drawSkeletonSprite(ctx, x, y, width, height, animation, frame) {
                const colors = {
                    walk: ['#f3f4f6', '#e5e7eb', '#d1d5db'],
                    attack: ['#dc2626', '#b91c1c'],
                    death: ['#6b7280', '#4b5563']
                };
                
                const color = colors[animation] ? colors[animation][frame % colors[animation].length] : '#f3f4f6';
                
                // Crânio
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x + width/2, y + 8, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos vazios
                ctx.fillStyle = '#000000';
                ctx.fillRect(x + width/2 - 4, y + 6, 2, 2);
                ctx.fillRect(x + width/2 + 2, y + 6, 2, 2);
                
                // Costelas
                ctx.fillStyle = color;
                for(let i = 0; i < 4; i++) {
                    ctx.fillRect(x + 5 + i * 8, y + 15, 4, 15);
                }
                
                // Braços
                ctx.fillStyle = color;
                ctx.fillRect(x - 3, y + 18, 6, 20);
                ctx.fillRect(x + width - 3, y + 18, 6, 20);
                
                // Pernas
                ctx.fillStyle = color;
                ctx.fillRect(x + 3, y + height - 15, 6, 15);
                ctx.fillRect(x + width - 9, y + height - 15, 6, 15);
            }
            
            function drawOrcSprite(ctx, x, y, width, height, animation, frame) {
                const colors = {
                    walk: ['#ea580c', '#dc2626', '#b91c1c'],
                    attack: ['#dc2626', '#b91c1c', '#991b1b'],
                    death: ['#6b7280', '#4b5563']
                };
                
                const color = colors[animation] ? colors[animation][frame % colors[animation].length] : '#ea580c';
                
                // Corpo musculoso
                ctx.fillStyle = color;
                ctx.fillRect(x + 2, y + 10, width - 4, height - 15);
                
                // Cabeça grande
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x + 5, y + 2, width - 10, 12);
                
                // Presas
                ctx.fillStyle = '#f3f4f6';
                ctx.fillRect(x + 8, y + 8, 2, 4);
                ctx.fillRect(x + width - 10, y + 8, 2, 4);
                
                // Olhos amarelos
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x + 8, y + 5, 2, 2);
                ctx.fillRect(x + width - 10, y + 5, 2, 2);
                
                // Pernas grossas
                ctx.fillStyle = '#1f2937';
                ctx.fillRect(x + 3, y + height - 12, 8, 12);
                ctx.fillRect(x + width - 11, y + height - 12, 8, 12);
            }
            
            function drawBossSprite(ctx, x, y, width, height, animation, frame) {
                const colors = {
                    walk: ['#dc2626', '#b91c1c', '#991b1b'],
                    attack: ['#7c2d12', '#dc2626', '#b91c1c'],
                    special: ['#7c3aed', '#6d28d9', '#5b21b6'],
                    death: ['#6b7280', '#4b5563']
                };
                
                const color = colors[animation] ? colors[animation][frame % colors[animation].length] : '#dc2626';
                
                // Corpo gigante
                ctx.fillStyle = color;
                ctx.fillRect(x, y + 15, width, height - 20);
                
                // Cabeça com chifres
                ctx.fillStyle = '#1f2937';
                ctx.fillRect(x + 5, y + 5, width - 10, 15);
                ctx.fillRect(x + 3, y + 2, 4, 8);
                ctx.fillRect(x + width - 7, y + 2, 4, 8);
                
                // Olhos brilhantes
                ctx.fillStyle = '#fbbf24';
                ctx.fillRect(x + 8, y + 8, 3, 3);
                ctx.fillRect(x + width - 11, y + 8, 3, 3);
                
                // Armadura
                ctx.fillStyle = '#374151';
                ctx.fillRect(x + 2, y + 12, width - 4, 8);
                
                // Pernas enormes
                ctx.fillStyle = '#1f2937';
                ctx.fillRect(x + 2, y + height - 15, 10, 15);
                ctx.fillRect(x + width - 12, y + height - 15, 10, 15);
                
                // Efeito especial
                if (animation === 'special') {
                    ctx.fillStyle = 'rgba(124, 58, 237, 0.5)';
                    ctx.fillRect(x - 5, y - 5, width + 10, height + 10);
                }
            }
            
            function renderGame(ctx, state) {
                // Limpar canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Renderizar fundo
                renderBackground(ctx, state);
                
                // RENDERIZAR ASSETS DO MAPA (PARALLAX)
                if (window.mapAssetsSystem) {
                    window.mapAssetsSystem.renderParallax(ctx, state.camera, canvas);
                    window.mapAssetsSystem.renderDecorations(ctx, state.camera, canvas);
                }
                
                // RENDERIZAR SISTEMA DE LEVEL DESIGN
                window.levelDesignSystem.render(ctx, state.camera);
                
                // Renderizar plataformas com sistema aprimorado
                if (state.enhancedPlatformSystem) {
                    state.enhancedPlatformSystem.render(ctx, state.camera);
                }
                
                // Renderizar jogador
                const playerX = state.player.x - state.camera.x;
                const playerY = state.player.y - state.camera.y;
                const playerAnim = state.player.animationState;
                const playerFrame = state.player.currentFrame;
                drawAnimatedSprite(ctx, playerX, playerY, state.player.width, state.player.height, 
                    'player', playerAnim, playerFrame, state.player.facingRight);
                
                // Renderizar inimigos
                state.enemies.forEach(enemy => {
                    const enemyX = enemy.x - state.camera.x;
                    const enemyY = enemy.y - state.camera.y;
                    
                    // Só renderizar se estiver visível na tela
                    if (enemyX + enemy.width > -50 && enemyX < canvas.width + 50) {
                        const enemyAnim = enemy.animationState || 'walk';
                        const enemyFrame = enemy.currentFrame || 0;
                        drawAnimatedSprite(ctx, enemyX, enemyY, enemy.width, enemy.height, 
                            enemy.type, enemyAnim, enemyFrame, enemy.facingRight);
                        
                        // Barra de vida do inimigo
                        if (enemy.health < enemy.maxHealth) {
                            ctx.fillStyle = '#ef4444';
                            ctx.fillRect(enemyX, enemyY - 10, enemy.width, 4);
                            ctx.fillStyle = '#10b981';
                            ctx.fillRect(enemyX, enemyY - 10, (enemy.health / enemy.maxHealth) * enemy.width, 4);
                        }
                    }
                });
                
                // Renderizar projéteis
                state.projectiles.forEach(projectile => {
                    const projectileX = projectile.x - state.camera.x;
                    const projectileY = projectile.y - state.camera.y;
                    
                    if (projectileX + 8 > -50 && projectileX < canvas.width + 50) {
                        ctx.fillStyle = projectile.color;
                        ctx.beginPath();
                        ctx.arc(projectileX, projectileY, 8, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Efeito de rastro
                        ctx.fillStyle = 'rgba(255, 107, 53, 0.3)';
                        ctx.beginPath();
                        ctx.arc(projectileX - projectile.vx * 2, projectileY - projectile.vy * 2, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                // Renderizar partículas
                state.particles.forEach(particle => {
                    const particleX = particle.x - state.camera.x;
                    const particleY = particle.y - state.camera.y;
                    
                    if (particleX + 5 > -10 && particleX < canvas.width + 10) {
                        ctx.fillStyle = particle.color;
                        ctx.beginPath();
                        ctx.arc(particleX, particleY, particle.size || 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                // Renderizar efeitos especiais
                state.effects.forEach(effect => {
                    const effectX = effect.x - state.camera.x;
                    const effectY = effect.y - state.camera.y;
                    
                    if (effectX + effect.radius > -50 && effectX < canvas.width + 50) {
                        if (effect.type === 'explosion') {
                            ctx.fillStyle = `rgba(255, 215, 0, ${effect.opacity})`;
                            ctx.beginPath();
                            ctx.arc(effectX, effectY, effect.radius, 0, Math.PI * 2);
                            ctx.fill();
                        } else if (effect.type === 'heal') {
                            ctx.fillStyle = `rgba(16, 185, 129, ${effect.opacity})`;
                            ctx.beginPath();
                            ctx.arc(effectX, effectY, effect.radius, 0, Math.PI * 2);
                            ctx.fill();
                            
                            // Efeito de cura com círculos concêntricos
                            ctx.strokeStyle = `rgba(16, 185, 129, ${effect.opacity * 0.5})`;
                            ctx.lineWidth = 3;
                            ctx.beginPath();
                            ctx.arc(effectX, effectY, effect.radius * 0.7, 0, Math.PI * 2);
                            ctx.stroke();
                        }
                    }
                });
                
                // Renderizar UI (sempre visível)
                renderUI(ctx, state);
            }
            
            function renderUI(ctx, state) {
                // Barra de vida do jogador
                ctx.fillStyle = '#ef4444';
                ctx.fillRect(20, 20, 200, 12);
                ctx.fillStyle = '#10b981';
                ctx.fillRect(20, 20, (state.player.health / state.player.maxHealth) * 200, 12);
                
                // Barra de mana do jogador
                ctx.fillStyle = '#6b7280';
                ctx.fillRect(20, 37, 200, 12);
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(20, 37, (state.player.mana / state.player.maxMana) * 200, 12);
                
                // Bordas das barras
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(20, 20, 200, 12);
                ctx.strokeRect(20, 37, 200, 12);
                
                // Barras de habilidade (3 níveis)
                const skillBarY = 54;
                const skillBarWidth = 60;
                const skillBarHeight = 8;
                const skillBarSpacing = 5;
                
                for (let i = 0; i < 3; i++) {
                    const barX = 20 + i * (skillBarWidth + skillBarSpacing);
                    
                    // Fundo da barra
                    ctx.fillStyle = '#374151';
                    ctx.fillRect(barX, skillBarY, skillBarWidth, skillBarHeight);
                    
                    // Barra carregada
                    if (keyStates.z.charging && keyStates.z.holdTime >= (i + 1) * 1000) {
                        const colors = ['#3b82f6', '#ff6b35', '#ffd700']; // Azul, Laranja, Dourado
                        ctx.fillStyle = colors[i];
                        ctx.fillRect(barX, skillBarY, skillBarWidth, skillBarHeight);
                    }
                    
                    // Borda da barra
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(barX, skillBarY, skillBarWidth, skillBarHeight);
                }
                
                // Indicador de carregamento
                if (keyStates.z.charging) {
                    const progress = Math.min(keyStates.z.holdTime / 3000, 1);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fillRect(20, skillBarY + skillBarHeight + 5, progress * 200, 4);
                }
                
                // Texto das barras
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.fillText('HP', 5, 30);
                ctx.fillText('MP', 5, 47);
                
                // Indicador de pulos disponíveis
                if (state.player.canDoubleJump) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px Arial';
                    ctx.fillText('Pulos:', canvas.width - 80, 30);
                    
                    // Mostrar pulos disponíveis
                    const jumpsLeft = state.player.maxJumps - state.player.jumpCount;
                    for (let i = 0; i < state.player.maxJumps; i++) {
                        ctx.fillStyle = i < jumpsLeft ? '#3b82f6' : '#6b7280';
                        ctx.fillRect(canvas.width - 60 + i * 15, 35, 10, 10);
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(canvas.width - 60 + i * 15, 35, 10, 10);
                    }
                }
                
                // Indicador de plataforma atual
                if (state.player.platformStanding) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.font = '10px Arial';
                    ctx.fillText('Plataforma', canvas.width - 80, canvas.height - 20);
                }
            }
            
            function updateMissionUI(state, mission) {
                const progressElement = document.querySelector('.mission-progress');
                if (progressElement) {
                    progressElement.textContent = `Inimigos: ${state.enemiesDefeated}/${mission.enemies} | Ouro: ${state.score} | EXP: ${state.score * 2} | HP: ${state.player.health}/${state.player.maxHealth} | MP: ${state.player.mana}/${state.player.maxMana}`;
                }
            }
            
            function completeMission(state, mission) {
                state.gameRunning = false;
                
                const totalGold = mission.rewards.gold + state.score;
                const totalExp = mission.rewards.exp + (state.score * 2);
                
                alert(`🎉 Missão Concluída!\n\n${mission.name}\n\nRecompensas:\n💰 ${totalGold} Ouro\n⭐ ${totalExp} EXP\n\nScore: ${state.score}`);
                
                const combatContainer = document.querySelector('.mission-combat-container');
                if (combatContainer) {
                    combatContainer.remove();
                }
                
                console.log(`Missão ${mission.name} concluída! Recompensas: ${totalGold} ouro, ${totalExp} EXP`);
            }
            
            function gameOver(state, mission) {
                state.gameRunning = false;
                
                alert(`💀 Game Over!\n\n${mission.name}\n\nVocê foi derrotado!\n\nTente novamente!`);
                
                const combatContainer = document.querySelector('.mission-combat-container');
                if (combatContainer) {
                    combatContainer.remove();
                }
            }
            
            gameLoop();
        }
        

        // Função para forçar re-inicialização do overlay system
        function ensureOverlaySystemReady() {
            // Não criar nova instância, apenas re-inicializar se necessário
            if (window.gameOverlaySystem && !window.gameOverlaySystem.gameWindow) {
                console.log('🔄 Re-inicializando gameOverlaySystem...');
                window.gameOverlaySystem.initialize();
                
                // Se ainda não funcionar, tentar encontrar o game-window manualmente
                if (!window.gameOverlaySystem.gameWindow) {
                    console.log('🔍 Procurando game-window manualmente...');
                    const gameWindow = document.querySelector('.game-window');
                    if (gameWindow) {
                        window.gameOverlaySystem.gameWindow = gameWindow;
                        console.log('✅ gameWindow encontrado e atribuído!');
                    } else {
                        console.error('❌ game-window não encontrado!');
                    }
                }
            }
        }
        // Função de pausa desabilitada para evitar conflitos
        /*
        function pauseMission() {
            console.log('⏸️ pauseMission() chamada');
            console.log('🔍 window.gameOverlaySystem:', window.gameOverlaySystem);
            
            // Garantir que o overlay system está pronto
            ensureOverlaySystemReady();
            
            if (window.gameOverlaySystem && window.gameOverlaySystem.showPauseMenu) {
                console.log('📱 Usando gameOverlaySystem.showPauseMenu()');
                window.gameOverlaySystem.showPauseMenu();
            } else {
                console.log('🔄 Usando fallback showPauseModal()');
                // Fallback com modal customizado
                showPauseModal();
            }
        }
        */
        
        // Funções de pausa desabilitadas para evitar conflitos
        /*
        function showPauseModal() {
            console.log('🔄 showPauseModal() chamada');
            
            // Criar overlay de pausa
            const pauseOverlay = document.createElement('div');
            pauseOverlay.className = 'game-overlay pause-overlay active';
            pauseOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(5px);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 1;
                visibility: visible;
            `;
            pauseOverlay.innerHTML = `
                <div class="overlay-content">
                    <div class="overlay-title">⏸️ Jogo Pausado</div>
                    <div class="overlay-message">O que você gostaria de fazer?</div>
                    <div class="overlay-buttons">
                        <button class="overlay-btn secondary" onclick="resumeMission()">▶️ Continuar</button>
                        <button class="overlay-btn danger" onclick="confirmExitMission()">🚪 Sair da Missão</button>
                    </div>
                </div>
            `;
            
            // Adicionar ao game-window
            const gameWindow = document.querySelector('.game-window');
            console.log('🔍 Game window encontrado:', gameWindow);
            
            if (gameWindow) {
                gameWindow.appendChild(pauseOverlay);
                console.log('✅ Modal de pausa adicionado ao game-window');
            } else {
                console.error('❌ Game window não encontrado!');
                // Fallback: adicionar ao body
                document.body.appendChild(pauseOverlay);
                console.log('🔄 Modal adicionado ao body como fallback');
            }
            
            // Pausar o jogo
            if (window.missionState) {
                window.missionState.gameRunning = false;
                console.log('⏸️ Jogo pausado via missionState');
            }
        }
        
        function resumeMission() {
            // Remover overlay de pausa
            const pauseOverlay = document.querySelector('.pause-overlay');
            if (pauseOverlay) {
                pauseOverlay.remove();
            }
            
            // Retomar o jogo
            if (window.missionState) {
                window.missionState.gameRunning = true;
            }
        }
        
        function confirmExitMission() {
            // Remover overlay de pausa
            const pauseOverlay = document.querySelector('.pause-overlay');
            if (pauseOverlay) {
                pauseOverlay.remove();
            }
            
            // Chamar função de sair da missão
            exitMission();
        }
        */
        
        function exitMission() {
            console.log('🚪 exitMission() chamada');
            console.log('🔍 window.gameOverlaySystem:', window.gameOverlaySystem);
            
            if (window.gameOverlaySystem && window.gameOverlaySystem.showExitConfirmation) {
                console.log('📱 Usando gameOverlaySystem.showExitConfirmation()');
                window.gameOverlaySystem.showExitConfirmation();
            } else {
                console.log('🔄 Usando fallback com confirm()');
                // Fallback simples
                if (confirm('Tem certeza que deseja sair da missão? Todo o progresso será perdido.')) {
                    console.log('✅ Usuário confirmou saída da missão');
                    const combatContainer = document.querySelector('.mission-combat-container');
                    if (combatContainer) {
                        combatContainer.remove();
                        console.log('🗑️ Container de missão removido');
                    }
                } else {
                    console.log('❌ Usuário cancelou saída da missão');
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeMissionIcons();
            
            // INICIALIZAR SISTEMAS DE LEVEL DESIGN E OVERLAYS
            try {
                window.levelDesignSystem = new LevelDesignSystem();
                console.log('✅ Level Design System inicializado');
            } catch (error) {
                console.error('❌ Erro ao inicializar Level Design System:', error);
            }
            
            try {
                window.mapAssetsSystem = new MapAssetsSystem();
                console.log('✅ Map Assets System inicializado');
            } catch (error) {
                console.error('❌ Erro ao inicializar Map Assets System:', error);
            }
            
            // Overlay System desabilitado temporariamente para evitar conflitos
            /*
            try {
                window.gameOverlaySystem = new GameOverlaySystem();
                window.gameOverlaySystem.initialize();
                console.log('✅ Overlay System inicializado');
            } catch (error) {
                console.error('❌ Erro ao inicializar Overlay System:', error);
            }
            */
            
            console.log('✅ Sistemas inicializados');
        });
    </script>
</body>
</html>

